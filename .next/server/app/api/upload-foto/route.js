"use strict";(()=>{var e={};e.id=5101,e.ids=[5101],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},80381:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var t={};o.r(t),o.d(t,{POST:()=>n});var s=o(73278),a=o(45002),u=o(54877),i=o(71309),l=o(39360);async function n(e){try{console.log("\uD83D\uDCE4 API Upload foto - Start");let{foto:r,lavorazioneId:o}=await e.json();if(!r||!o)return i.NextResponse.json({success:!1,error:"Foto e lavorazioneId sono obbligatori"},{status:400});if(!Array.isArray(r))return i.NextResponse.json({success:!1,error:"Foto deve essere un array"},{status:400});console.log(`ðŸ“· Uploading ${r.length} foto per lavorazione ${o}`);let t=r.map(async(e,r)=>{try{let t=await (0,l.tJ)(e,o,r);return{index:r,success:!0,url:t.url,publicId:t.publicId}}catch(e){return console.error(`âŒ Errore upload foto ${r}:`,e),{index:r,success:!1,error:e instanceof Error?e.message:"Errore upload"}}}),s=await Promise.all(t),a=s.filter(e=>e.success),u=s.filter(e=>!e.success);return console.log(`âœ… Upload completato: ${a.length} successi, ${u.length} errori`),i.NextResponse.json({success:!0,data:{foto:a.map(e=>({url:e.url,publicId:e.publicId})),errori:u.length>0?u:void 0}})}catch(e){return console.error("âŒ Errore generale upload foto:",e),i.NextResponse.json({success:!1,error:"Errore interno del server durante upload foto"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/upload-foto/route",pathname:"/api/upload-foto",filename:"route",bundlePath:"app/api/upload-foto/route"},resolvedPagePath:"/Users/akirayouky/Desktop/Siti/Condomini/src/app/api/upload-foto/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:f}=p,h="/api/upload-foto/route";function g(){return(0,u.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},39360:(e,r,o)=>{o.d(r,{tJ:()=>s});var t=o(5482);t.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let s=async(e,r,o)=>{try{let s=Date.now(),a=`lavorazioni/${r}/foto-${o}-${s}`;console.log("\uD83D\uDCE4 Uploading foto to Cloudinary:",{lavorazioneId:r,fotoIndex:o,publicId:a});let u=await t.v2.uploader.upload(e,{public_id:a,folder:"condomini-app/lavorazioni",resource_type:"image",transformation:[{quality:"auto",fetch_format:"auto"},{width:1920,height:1920,crop:"limit"}],eager:[{width:300,height:300,crop:"fill",quality:"auto"},{width:150,height:150,crop:"thumb",gravity:"face"}]});return console.log("âœ… Foto uploaded successfully:",u.secure_url),{url:u.secure_url,publicId:u.public_id}}catch(e){throw console.error("âŒ Errore upload Cloudinary:",e),Error("Errore durante l'upload della foto")}}}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[9379,4833,5482],()=>o(80381));module.exports=t})();