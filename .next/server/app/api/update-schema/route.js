"use strict";(()=>{var e={};e.id=511,e.ids=[511],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},83818:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>p,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>u});var o={};t.r(o),t.d(o,{POST:()=>d});var i=t(73278),s=t(45002),a=t(54877),n=t(71309),l=t(52557);async function d(){try{for(let e of(console.log("\uD83D\uDD27 Aggiornamento schema database..."),["ALTER TABLE users ADD COLUMN IF NOT EXISTS nome VARCHAR(100)","ALTER TABLE users ADD COLUMN IF NOT EXISTS cognome VARCHAR(100)","ALTER TABLE users ADD COLUMN IF NOT EXISTS telefono VARCHAR(20)","ALTER TABLE users ADD COLUMN IF NOT EXISTS attivo BOOLEAN DEFAULT true","ALTER TABLE users ADD COLUMN IF NOT EXISTS approved_at TIMESTAMPTZ","ALTER TABLE users ADD COLUMN IF NOT EXISTS last_login TIMESTAMPTZ"])){console.log(`Eseguendo: ${e}`);let{error:r}=await l.O.rpc("exec_sql",{sql_query:e});r?console.error(`Errore query "${e}":`,r):console.log(`✅ Query eseguita: ${e}`)}let{data:e,error:r}=await l.O.from("users").update({nome:"Admin",cognome:"Sistema",attivo:!0,approved_at:new Date().toISOString()}).eq("username","admin").eq("role","admin").select();return r?console.error("Errore aggiornamento admin:",r):console.log("✅ Admin aggiornato:",e),n.NextResponse.json({success:!0,message:"Database schema aggiornato con successo",adminUpdate:e})}catch(e){return console.error("❌ Errore aggiornamento schema:",e),n.NextResponse.json({success:!1,message:"Errore interno del server",error:e.message},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/update-schema/route",pathname:"/api/update-schema",filename:"route",bundlePath:"app/api/update-schema/route"},resolvedPagePath:"/Users/akirayouky/Desktop/Siti/Condomini/src/app/api/update-schema/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:u,serverHooks:g}=c,p="/api/update-schema/route";function f(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:u})}},52557:(e,r,t)=>{t.d(r,{$:()=>i,O:()=>o});let o=(0,t(75932).eI)("https://ygvlcikgzkoaxlrmwsnv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlndmxjaWtnemtvYXhscm13c252Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTgzMzgsImV4cCI6MjA3NDk3NDMzOH0.Zc6eihyJiTZy6WicV6MyIgZ1Oq7GwzRYR01zovQHFPs"),i={condomini:{getAll:()=>o.from("condomini").select("*").order("data_inserimento",{ascending:!1}),create:e=>o.from("condomini").insert([e]).select().single(),getById:e=>o.from("condomini").select("*").eq("id",e).single(),update:(e,r)=>o.from("condomini").update(r).eq("id",e).select().single(),delete:e=>o.from("condomini").delete().eq("id",e)},tipologie:{getAll:()=>o.from("tipologie_verifiche").select("*").order("data_creazione",{ascending:!1}),create:e=>o.from("tipologie_verifiche").insert([e]).select().single(),getById:e=>o.from("tipologie_verifiche").select("*").eq("id",e).single(),update:(e,r)=>o.from("tipologie_verifiche").update(r).eq("id",e).select().single(),delete:e=>o.from("tipologie_verifiche").delete().eq("id",e)},verifiche:{getAll:()=>o.from("verifiche").select("*").order("data_creazione",{ascending:!1}),create:e=>o.from("verifiche").insert([e]).select().single(),getById:e=>o.from("verifiche").select("*").eq("id",e).single(),update:(e,r)=>o.from("verifiche").update(r).eq("id",e).select().single(),delete:e=>o.from("verifiche").delete().eq("id",e)},lavorazioni:{getAll:()=>o.from("lavorazioni").select("*").order("data_apertura",{ascending:!1}),create:e=>o.from("lavorazioni").insert([e]).select().single(),getById:e=>o.from("lavorazioni").select("*").eq("id",e).single(),update:(e,r)=>o.from("lavorazioni").update(r).eq("id",e).select().single(),delete:e=>o.from("lavorazioni").delete().eq("id",e)},users:{getAll:()=>o.from("users").select("id, username, email, role, nome, cognome, telefono, attivo, created_at, last_login, approved_at").order("created_at",{ascending:!1}),create:e=>o.from("users").insert([e]).select("id, username, email, role, nome, cognome, telefono, attivo, created_at").single(),getById:e=>o.from("users").select("id, username, email, role, nome, cognome, telefono, attivo, created_at, last_login, approved_at").eq("id",e).single(),getByIdFull:e=>o.from("users").select("*").eq("id",e).single(),getByUsername:e=>o.from("users").select("*").eq("username",e).single(),getByEmail:e=>o.from("users").select("*").eq("email",e).single(),update:(e,r)=>o.from("users").update(r).eq("id",e).select("id, username, email, role, nome, cognome, telefono, attivo, created_at, last_login, approved_at").single(),updateLastLogin:e=>o.from("users").update({last_login:new Date().toISOString()}).eq("id",e),delete:e=>o.from("users").delete().eq("id",e)},note_personali:{getAll:()=>o.from("note_personali").select("*").order("data_creazione",{ascending:!1}),getAllByUser:e=>o.from("note_personali").select("*").eq("utente_id",e).order("data_creazione",{ascending:!1}),create:e=>o.from("note_personali").insert([e]).select().single(),getById:e=>o.from("note_personali").select("*").eq("id",e).single(),update:(e,r)=>o.from("note_personali").update(r).eq("id",e).select().single(),delete:e=>o.from("note_personali").delete().eq("id",e)}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[379,833,932],()=>t(83818));module.exports=o})();