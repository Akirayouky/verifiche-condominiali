"use strict";(()=>{var e={};e.id=6980,e.ids=[6980],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},93977:e=>{e.exports=require("node:fs/promises")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},58699:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var t={};o.r(t),o.d(t,{GET:()=>u});var s=o(73278),n=o(45002),i=o(54877),a=o(71309),p=o(28313);async function u(){try{console.log("\uD83E\uDDEA Testing OneDrive connection...");let e=process.env.MICROSOFT_TENANT_ID,r=process.env.MICROSOFT_CLIENT_ID,o=process.env.MICROSOFT_CLIENT_SECRET;if(!e||!r||!o)return console.error("❌ Microsoft credentials non configurate"),a.NextResponse.json({success:!1,error:"Credenziali Microsoft mancanti",details:{hasTenantId:!!e,hasClientId:!!r,hasClientSecret:!!o},message:"Configura MICROSOFT_TENANT_ID, MICROSOFT_CLIENT_ID, MICROSOFT_CLIENT_SECRET in .env.local"},{status:500});let t=await (0,p.wm)();if(t.success)return console.log("✅ OneDrive connection OK:",t.user),a.NextResponse.json({success:!0,message:"✅ OneDrive configurato correttamente!",user:t.user,timestamp:new Date().toISOString()});return console.error("❌ OneDrive connection failed:",t.error),a.NextResponse.json({success:!1,error:t.error,message:"❌ Errore connessione OneDrive. Verifica le credenziali in .env.local"},{status:500})}catch(e){return console.error("❌ Test OneDrive failed:",e),a.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error",message:"❌ Errore imprevisto. Controlla i log del server."},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/test-onedrive/route",pathname:"/api/test-onedrive",filename:"route",bundlePath:"app/api/test-onedrive/route"},resolvedPagePath:"/Users/akirayouky/Desktop/Siti/Condomini/src/app/api/test-onedrive/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=c,v="/api/test-onedrive/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},28313:(e,r,o)=>{o.d(r,{CS:()=>u,wm:()=>c}),o(80246);var t=o(80995),s=o(99008);let n=process.env.MICROSOFT_TENANT_ID||"",i=process.env.MICROSOFT_CLIENT_ID||"",a=process.env.MICROSOFT_CLIENT_SECRET||"";function p(){let e=new s.Rp(n,i,a);return t.KU.initWithMiddleware({authProvider:{getAccessToken:async()=>(await e.getToken("https://graph.microsoft.com/.default")).token}})}async function u(e,r,o){try{let t=p(),s=Date.now(),n=`foto-${o}-${s}.jpg`,i=`/me/drive/root:/Apps/CondominieApp/lavorazioni/${r}`,a=`${i}/${n}:`;console.log("\uD83D\uDCE4 Uploading foto to OneDrive:",{lavorazioneId:r,fotoIndex:o,fileName:n});let u=e.replace(/^data:image\/\w+;base64,/,""),c=Buffer.from(u,"base64");try{await t.api(`${i}`).get()}catch(e){console.log("\uD83D\uDCC1 Creando cartella lavorazione su OneDrive..."),await t.api("/me/drive/root:/Apps/CondominieApp/lavorazioni:/children").post({name:r,folder:{},"@microsoft.graph.conflictBehavior":"rename"})}let l=await t.api(a).putStream(c);console.log("✅ Foto uploaded to OneDrive:",l.id);let d=await t.api(`/me/drive/items/${l.id}/createLink`).post({type:"view",scope:"anonymous"});return{id:l.id,url:d.link.webUrl,webUrl:l.webUrl}}catch(e){throw console.error("❌ Errore upload OneDrive:",e),Error("Errore durante upload su OneDrive")}}async function c(){try{let e=p(),r=await e.api("/me").get();return console.log("✅ OneDrive connesso per utente:",r.displayName),{success:!0,user:{displayName:r.displayName,email:r.mail||r.userPrincipalName,id:r.id}}}catch(e){return console.error("❌ OneDrive non configurato correttamente:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[9379,4833,4640,982],()=>o(58699));module.exports=t})();