(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{7639:function(e,a,t){Promise.resolve().then(t.bind(t,4180))},4180:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return o}});var s=t(7437),i=t(2265);function o(){let[e,a]=(0,i.useState)(!1),[t,o]=(0,i.useState)([]),[r,n]=(0,i.useState)({condominio_id:"00000000-1111-2222-3333-444444444444",tipologia_id:crypto.randomUUID(),descrizione:"Test lavorazione per notifica sopralluoghista",sopralluoghista_id:"0a534c3a-daf0-41a2-8821-9aa003c9e423",data_scadenza:"2025-10-15",note:"Test automatico per verificare notifiche"}),c=async()=>{a(!0);try{let e=await fetch("/api/test-lavorazioni",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await e.json();if(e.ok){let e="0a534c3a-daf0-41a2-8821-9aa003c9e423"===r.sopralluoghista_id?"Monica Canavese":"e1017f5d-83e1-4da3-ac81-4924a0dfd010"===r.sopralluoghista_id?"Diego Marruchi":"Utente Test";o(t=>[{success:!0,message:"✅ Lavorazione creata! Notifica inviata a: ".concat(e,". Verifica nel NotificationCenter dell'app."),data:a,timestamp:new Date().toISOString()},...t])}else o(e=>[{success:!1,message:"❌ Errore creazione lavorazione: ".concat(a.error||"Errore sconosciuto"),data:a,timestamp:new Date().toISOString()},...e])}catch(e){o(a=>[{success:!1,message:"❌ Errore rete: ".concat(e instanceof Error?e.message:"Sconosciuto"),timestamp:new Date().toISOString()},...a])}a(!1)},l=async()=>{a(!0);try{let e={tipo:"nuova_assegnazione",titolo:"Test API Notifica",messaggio:"Test diretto API notifiche",utente_id:r.sopralluoghista_id,priorita:"alta"},a=await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();a.ok?o(e=>[{success:!0,message:"✅ Notifica creata direttamente tramite API",data:t,timestamp:new Date().toISOString()},...e]):o(e=>[{success:!1,message:"❌ Errore API notifica: ".concat(t.error||"Errore sconosciuto"),data:t,timestamp:new Date().toISOString()},...e])}catch(e){o(a=>[{success:!1,message:"❌ Errore API: ".concat(e instanceof Error?e.message:"Sconosciuto"),timestamp:new Date().toISOString()},...a])}a(!1)};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"\uD83D\uDD04 Test Integrazione Lavorazioni → Notifiche"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCCB Dati Test Lavorazione"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sopralluoghista (ricever\xe0 la notifica)"}),(0,s.jsxs)("select",{value:r.sopralluoghista_id,onChange:e=>n(a=>({...a,sopralluoghista_id:e.target.value})),title:"Seleziona sopralluoghista per il test",className:"w-full p-2 border border-gray-300 rounded text-sm",children:[(0,s.jsx)("option",{value:"0a534c3a-daf0-41a2-8821-9aa003c9e423",children:"Monica Canavese"}),(0,s.jsx)("option",{value:"e1017f5d-83e1-4da3-ac81-4924a0dfd010",children:"Diego Marruchi"}),(0,s.jsx)("option",{value:crypto.randomUUID(),children:"UUID Casuale (per test)"})]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["ID selezionato: ",r.sopralluoghista_id]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrizione"}),(0,s.jsx)("input",{type:"text",value:r.descrizione,onChange:e=>n(a=>({...a,descrizione:e.target.value})),placeholder:"Descrizione della lavorazione",className:"w-full p-2 border border-gray-300 rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Scadenza"}),(0,s.jsx)("input",{type:"date",value:r.data_scadenza,onChange:e=>n(a=>({...a,data_scadenza:e.target.value})),title:"Data di scadenza della lavorazione",className:"w-full p-2 border border-gray-300 rounded"})]}),(0,s.jsx)("button",{onClick:()=>{n(e=>({...e,condominio_id:crypto.randomUUID(),tipologia_id:crypto.randomUUID(),sopralluoghista_id:crypto.randomUUID()}))},className:"w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded text-sm",children:"\uD83C\uDFB2 Genera Nuovi ID"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"\uD83D\uDE80 Test Operazioni"}),(0,s.jsx)("button",{onClick:c,disabled:e,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded font-medium disabled:opacity-50",children:"\uD83D\uDCDD Test Lavorazione (API semplificata)"}),(0,s.jsx)("button",{onClick:async()=>{a(!0);try{let e=await fetch("/api/lavorazioni",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await e.json();o(t=>[{success:e.ok,message:e.ok?"✅ Lavorazione API normale creata!":"❌ Errore API normale: ".concat(a.error),data:a,timestamp:new Date().toISOString()},...t])}catch(e){o(a=>[{success:!1,message:"❌ Errore API normale: ".concat(e instanceof Error?e.message:"Sconosciuto"),timestamp:new Date().toISOString()},...a])}a(!1)},disabled:e,className:"w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded font-medium disabled:opacity-50",children:"\uD83D\uDCCB Test API Lavorazioni Normale"}),(0,s.jsx)("button",{onClick:l,disabled:e,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded font-medium disabled:opacity-50",children:"\uD83D\uDD14 Test API Notifiche Diretto"}),(0,s.jsx)("button",{onClick:()=>o([]),className:"w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded disabled:opacity-50",children:"\uD83D\uDDD1️ Pulisci Risultati"}),e&&(0,s.jsx)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 p-4",children:(0,s.jsx)("p",{className:"text-yellow-700",children:"⏳ Test in corso..."})})]})]}),(0,s.jsxs)("div",{className:"mt-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCCA Risultati Test"}),0===t.length&&(0,s.jsx)("div",{className:"text-center text-gray-500 py-8 bg-gray-50 rounded-lg",children:"Nessun test eseguito ancora. Clicca sui pulsanti sopra per iniziare."}),(0,s.jsx)("div",{className:"space-y-4",children:t.map((e,a)=>(0,s.jsxs)("div",{className:"border-l-4 p-4 rounded ".concat(e.success?"bg-green-100 border-green-500":"bg-red-100 border-red-500"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsx)("p",{className:"font-medium ".concat(e.success?"text-green-700":"text-red-700"),children:e.message}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString()})]}),e.data&&(0,s.jsxs)("details",{className:"mt-2",children:[(0,s.jsx)("summary",{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:"\uD83D\uDCCB Mostra dettagli risposta"}),(0,s.jsx)("pre",{className:"mt-2 text-xs bg-gray-100 p-3 rounded overflow-auto max-h-40",children:JSON.stringify(e.data,null,2)})]})]},a))})]})]})})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7639)}),_N_E=e.O()}]);