(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3210:function(e,t,s){Promise.resolve().then(s.bind(s,8761))},8761:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return T}});var a=s(7437),i=s(2265);let r=(0,i.createContext)(null);function l(e){let{children:t}=e,[s,l]=(0,i.useState)({isAuthenticated:!1,user:null,role:null});(0,i.useEffect)(()=>{let e=localStorage.getItem("verifiche_auth");if(e)try{let t=JSON.parse(e);l(t)}catch(e){console.error("Errore nel parsing auth:",e),localStorage.removeItem("verifiche_auth")}},[]),(0,i.useEffect)(()=>{s.isAuthenticated?localStorage.setItem("verifiche_auth",JSON.stringify(s)):localStorage.removeItem("verifiche_auth")},[s]);let n=async(e,t)=>{try{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),a=await s.json();if(a.success&&a.user)return l({isAuthenticated:!0,user:a.user,role:a.user.role}),!0;return!1}catch(e){return console.error("Errore durante il login:",e),!1}},o={...s,login:n,logout:()=>{l({isAuthenticated:!1,user:null,role:null})}};return(0,a.jsx)(r.Provider,{value:o,children:t})}function n(){let e=(0,i.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function o(e){let{onBack:t,onSuccess:s}=e,[r,l]=(0,i.useState)({username:"",email:"",password:"",confirmPassword:"",nome:"",cognome:"",telefono:""}),[n,o]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1),m=e=>{l(t=>({...t,[e.target.name]:e.target.value})),o("")},x=async e=>{if(e.preventDefault(),d(!0),o(""),r.password!==r.confirmPassword){o("Le password non coincidono"),d(!1);return}if(r.password.length<6){o("La password deve essere di almeno 6 caratteri"),d(!1);return}if(!r.email.includes("@")){o("Inserisci una email valida"),d(!1);return}try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r.username,email:r.email,password:r.password,nome:r.nome,cognome:r.cognome,telefono:r.telefono})}),t=await e.json();t.success?s():o(t.message||"Errore nella registrazione")}catch(e){console.error("Errore registrazione:",e),o("Errore durante la registrazione")}finally{d(!1)}};return(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC77"})}),(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Registrazione Sopralluoghista"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Crea il tuo account per accedere al portale verifiche"})]}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:x,children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700",children:"Nome *"}),(0,a.jsx)("input",{id:"nome",name:"nome",type:"text",required:!0,value:r.nome,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Nome"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"cognome",className:"block text-sm font-medium text-gray-700",children:"Cognome *"}),(0,a.jsx)("input",{id:"cognome",name:"cognome",type:"text",required:!0,value:r.cognome,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Cognome"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username *"}),(0,a.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:r.username,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Username per il login"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email *"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:r.email,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"email@esempio.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"telefono",className:"block text-sm font-medium text-gray-700",children:"Telefono"}),(0,a.jsx)("input",{id:"telefono",name:"telefono",type:"tel",value:r.telefono,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"+39 123 456 7890"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password *"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",required:!0,value:r.password,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Minimo 6 caratteri"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Conferma Password *"}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:r.confirmPassword,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Ripeti la password"})]})]}),n&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsxs)("div",{className:"text-red-600 text-sm",children:["⚠️ ",n]})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"← Torna al Login"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Registrazione..."]}):"✨ Registrati"})]}),(0,a.jsx)("div",{className:"bg-blue-50 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("span",{className:"text-blue-400",children:"ℹ️"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Processo di Approvazione"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,a.jsx)("p",{children:"Dopo la registrazione, il tuo account sar\xe0 in attesa di approvazione da parte dell'amministratore. Riceverai una notifica via email quando potrai accedere al sistema."})})]})]})})]})]})}function c(){let[e,t]=(0,i.useState)({username:"",password:""}),[s,r]=(0,i.useState)(""),[l,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1),{login:h}=n(),g=async t=>{t.preventDefault(),c(!0),r("");try{await h(e.username,e.password)||r("Credenziali non valide. Controlla username e password.")}catch(e){r("Errore durante il login")}finally{c(!1)}},p=e=>{t(t=>({...t,[e.target.name]:e.target.value})),r("")};return d?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsx)(o,{onBack:()=>m(!1),onSuccess:()=>{u(!0),m(!1)}})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFE2"})}),(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Verifiche Condominiali"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Accedi al sistema di gestione verifiche"})]}),(0,a.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:g,children:[(0,a.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,a.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:e.username,onChange:p,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Username"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",required:!0,value:e.password,onChange:p,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),x&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:(0,a.jsx)("div",{className:"text-green-600 text-sm",children:"✅ Registrazione completata! Il tuo account \xe8 in attesa di approvazione."})}),s&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsxs)("div",{className:"text-red-600 text-sm",children:["⚠️ ",s]})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Accesso..."]}):(0,a.jsx)(a.Fragment,{children:" Accedi"})})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>m(!d),className:"text-sm text-blue-600 hover:text-blue-500",children:d?"Torna al login":"Non hai un account? Registrati"})}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Credenziali Test:"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,a.jsxs)("p",{children:["� ",(0,a.jsx)("strong",{children:"Admin:"})," ",(0,a.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"admin"})," / ",(0,a.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"admin123"})]}),(0,a.jsx)("p",{className:"text-gray-500 mt-1",children:"Gli altri account devono essere registrati"})]})]})]})]})})}let d="/api";class m{static async getAll(){try{let e=await fetch("".concat(d,"/condomini"));return await e.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async getById(e){try{let t=await fetch("".concat(d,"/condomini/").concat(e));return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async create(e){try{let t=await fetch("".concat(d,"/condomini"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async update(e,t){try{let s=await fetch("".concat(d,"/condomini/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await s.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async delete(e){try{let t=await fetch("".concat(d,"/condomini/").concat(e),{method:"DELETE"});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static validateCondominio(e){let t=[];return e.nome&&""!==e.nome.trim()||t.push("Il nome del condominio \xe8 obbligatorio"),e.nome&&e.nome.length<2&&t.push("Il nome deve essere di almeno 2 caratteri"),e.nome&&e.nome.length>100&&t.push("Il nome non pu\xf2 superare i 100 caratteri"),t}}function x(){let[e,t]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[r,l]=(0,i.useState)(null),n=async()=>{a(!0),l(null);let e=await m.getAll();e.success&&e.data?t(e.data):l(e.error||"Errore nel caricamento dei condomini"),a(!1)},o=async e=>{let s=m.validateCondominio(e);if(s.length>0)return l(s.join(", ")),!1;let a=await m.create(e);return a.success&&a.data?(t(e=>[...e,a.data]),l(null),!0):(l(a.error||"Errore nella creazione del condominio"),!1)},c=async(e,s)=>{let a=m.validateCondominio(s);if(a.length>0)return l(a.join(", ")),!1;let i=await m.update(e,s);return i.success&&i.data?(t(t=>t.map(t=>t.id===e?i.data:t)),l(null),!0):(l(i.error||"Errore nell'aggiornamento del condominio"),!1)},d=async e=>{let s=await m.delete(e);return s.success?(t(t=>t.filter(t=>t.id!==e)),l(null),!0):(l(s.error||"Errore nell'eliminazione del condominio"),!1)};return(0,i.useEffect)(()=>{n()},[]),{condomini:e,loading:s,error:r,loadCondomini:n,createCondominio:o,updateCondominio:c,deleteCondominio:d,getCondominio:t=>e.find(e=>e.id===t||e.token===t),clearError:()=>l(null)}}function u(e){let{onSubmit:t,onCancel:s,loading:r=!1,initialData:l,isEdit:n=!1}=e,[o,c]=(0,i.useState)({nome:(null==l?void 0:l.nome)||""}),[d,m]=(0,i.useState)([]),x=async e=>{e.preventDefault(),m([]);let s=[];if(o.nome.trim()?o.nome.length<2?s.push("Il nome deve essere di almeno 2 caratteri"):o.nome.length>100&&s.push("Il nome non pu\xf2 superare i 100 caratteri"):s.push("Il nome del condominio \xe8 obbligatorio"),s.length>0){m(s);return}await t(o)&&!n&&c({nome:""})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:n?"Modifica Condominio":"Nuovo Condominio"}),s&&(0,a.jsx)("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]}),d.length>0&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("div",{className:"text-red-600 text-sm",children:d.map((e,t)=>(0,a.jsxs)("div",{children:["• ",e]},t))})}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Condominio *"}),(0,a.jsx)("input",{type:"text",id:"nome",name:"nome",value:o.nome,onChange:e=>{let{name:t,value:s}=e.target;c(e=>({...e,[t]:s})),d.length>0&&m([])},placeholder:"Es: Condominio Via Roma 123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:r,maxLength:100}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[o.nome.length,"/100 caratteri"]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:r||!o.nome.trim(),className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:r?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),n?"Aggiornamento...":"Creazione..."]}):n?"Aggiorna Condominio":"Crea Condominio"}),s&&(0,a.jsx)("button",{type:"button",onClick:s,disabled:r,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"})]})]})]})}function h(e){let{condomini:t,loading:s=!1,onEdit:r,onDelete:l,onView:n}=e,[o,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(null),x=async e=>{c(e);let t=await l(e);c(null),t&&m(null)},u=e=>new Date(e).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),h=async e=>{try{await navigator.clipboard.writeText(e)}catch(e){console.error("Errore nel copiare il token:",e)}};return s?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento condomini..."})]})}):0===t.length?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83C\uDFE2"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun condominio trovato"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Inizia creando il tuo primo condominio"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Condomini (",t.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome Condominio"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Creazione"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ultima Modifica"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Azioni"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-blue-600 font-medium text-sm",children:e.nome.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.nome}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(e.data_inserimento)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(e.data_ultima_modifica)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[n&&(0,a.jsx)("button",{onClick:()=>n(e),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Visualizza dettagli",children:"\uD83D\uDC41️"}),(0,a.jsx)("button",{onClick:()=>h(e.token),className:"text-green-600 hover:text-green-900 transition-colors",title:"Copia Token",children:"\uD83D\uDD11"}),(0,a.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"Modifica",children:"✏️"}),(0,a.jsx)("button",{onClick:()=>m(e.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Elimina",children:"\uD83D\uDDD1️"})]})})]},e.id))})]})})]}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Conferma eliminazione"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Sei sicuro di voler eliminare questo condominio? Questa azione non pu\xf2 essere annullata."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>m(null),disabled:o===d,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"}),(0,a.jsx)("button",{onClick:()=>x(d),disabled:o===d,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors disabled:bg-red-300 disabled:cursor-not-allowed",children:o===d?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Eliminazione..."]}):"Elimina"})]})]})})]})}function g(){let{condomini:e,loading:t,error:s,createCondominio:r,updateCondominio:l,deleteCondominio:n,clearError:o}=x(),[c,d]=(0,i.useState)(!1),[m,g]=(0,i.useState)(null),[p,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(j){let e=setTimeout(()=>v(null),5e3);return()=>clearTimeout(e)}},[j]),(0,i.useEffect)(()=>{if(s){let e=setTimeout(()=>o(),8e3);return()=>clearTimeout(e)}},[s,o]);let f=async e=>{b(!0);let t=await r(e);return b(!1),t&&(d(!1),v("Condominio creato con successo!")),t},y=async e=>{if(!m)return!1;b(!0);let t=await l(m.id,e);return b(!1),t&&(g(null),v("Condominio aggiornato con successo!")),t},N=async e=>{let t=await n(e);return t&&v("Condominio eliminato con successo!"),t},w={totale:e.length,recenti:e.filter(e=>{let t=new Date(e.data_inserimento),s=new Date;return s.setDate(s.getDate()-7),t>=s}).length};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Gestione Condomini"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestisci l'anagrafica dei condomini e i relativi token di accesso"})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 px-4 py-3 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:w.totale}),(0,a.jsx)("div",{className:"text-sm text-blue-800",children:"Totale"})]}),(0,a.jsxs)("div",{className:"bg-green-50 px-4 py-3 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:w.recenti}),(0,a.jsx)("div",{className:"text-sm text-green-800",children:"Ultimi 7gg"})]})]})]}),s&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-red-400 mr-3",children:"❌"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-red-800 font-medium",children:"Errore"}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:s})]}),(0,a.jsx)("button",{onClick:o,className:"ml-auto text-red-400 hover:text-red-600",children:"✕"})]})}),j&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-green-400 mr-3",children:"✅"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-green-800 font-medium",children:"Successo"}),(0,a.jsx)("p",{className:"text-green-700 text-sm mt-1",children:j})]}),(0,a.jsx)("button",{onClick:()=>v(null),className:"ml-auto text-green-400 hover:text-green-600",children:"✕"})]})}),(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{d(!0),g(null)},className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"➕"}),"Nuovo Condominio"]}),(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]})]})}),c&&(0,a.jsx)(u,{onSubmit:f,onCancel:()=>d(!1),loading:p}),m&&(0,a.jsx)(u,{onSubmit:y,onCancel:()=>{g(null)},loading:p,initialData:{nome:m.nome},isEdit:!0}),(0,a.jsx)(h,{condomini:e,loading:t,onEdit:e=>{g(e),d(!1)},onDelete:N})]})}class p{static async getAll(){try{let e=await fetch(this.API_BASE);return await e.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async getById(e){try{let t=await fetch("".concat(this.API_BASE,"/").concat(e));return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async create(e){try{let t=await fetch(this.API_BASE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async update(e,t){try{let s=await fetch("".concat(this.API_BASE,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await s.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async delete(e){try{let t=await fetch("".concat(this.API_BASE,"/").concat(e),{method:"DELETE"});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static validate(e){let t=[];return e.nome&&""!==e.nome.trim()||t.push("Il nome della tipologia \xe8 obbligatorio"),e.nome&&e.nome.length<2&&t.push("Il nome deve essere di almeno 2 caratteri"),t}}function b(){let[e,t]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[r,l]=(0,i.useState)(null),n=async()=>{a(!0),l(null);let e=await p.getAll();e.success&&e.data?t(e.data):l(e.error||"Errore nel caricamento delle tipologie"),a(!1)},o=async e=>{let s=p.validate(e);if(s.length>0)return l(s.join(", ")),!1;let a=await p.create(e);return a.success&&a.data?(t(e=>[...e,a.data]),l(null),!0):(l(a.error||"Errore nella creazione della tipologia"),!1)},c=async(e,s)=>{let a=p.validate(s);if(a.length>0)return l(a.join(", ")),!1;let i=await p.update(e,s);return i.success&&i.data?(t(t=>t.map(t=>t.id===e?i.data:t)),l(null),!0):(l(i.error||"Errore nell'aggiornamento della tipologia"),!1)},d=async e=>{let s=await p.delete(e);return s.success?(t(t=>t.filter(t=>t.id!==e)),l(null),!0):(l(s.error||"Errore nell'eliminazione della tipologia"),!1)};return(0,i.useEffect)(()=>{n()},[]),{tipologie:e,loading:s,error:r,loadTipologie:n,createTipologia:o,updateTipologia:c,deleteTipologia:d,getTipologia:t=>e.find(e=>e.id===t),getTipologieAttive:()=>e.filter(e=>e.attiva),clearError:()=>l(null)}}function j(e){let{onSubmit:t,onCancel:s,loading:r=!1,initialData:l,isEdit:n=!1}=e,[o,c]=(0,i.useState)({nome:(null==l?void 0:l.nome)||"",descrizione:(null==l?void 0:l.descrizione)||"",campi_personalizzati:(null==l?void 0:l.campi_personalizzati)||[]}),[d,m]=(0,i.useState)([]),x=[{value:"testo",label:"Testo"},{value:"numero",label:"Numero"},{value:"data",label:"Data"},{value:"checkbox",label:"Checkbox"},{value:"select",label:"Lista selezione"},{value:"textarea",label:"Testo lungo"},{value:"foto",label:"\uD83D\uDCF7 Caricamento Foto"}],u=async e=>{e.preventDefault(),m([]);let s=[];if(o.nome.trim()||s.push("Il nome della tipologia \xe8 obbligatorio"),s.length>0){m(s);return}await t(o)&&!n&&c({nome:"",descrizione:"",campi_personalizzati:[]})},h=e=>{let{name:t,value:s}=e.target;c(e=>({...e,[t]:s})),d.length>0&&m([])},g=e=>{c(t=>({...t,campi_personalizzati:t.campi_personalizzati.filter((t,s)=>s!==e)}))},p=(e,t)=>{c(s=>({...s,campi_personalizzati:s.campi_personalizzati.map((s,a)=>a===e?{...s,...t}:s)}))};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:n?"Modifica Tipologia":"Nuova Tipologia"}),s&&(0,a.jsx)("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]}),d.length>0&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("div",{className:"text-red-600 text-sm",children:d.map((e,t)=>(0,a.jsxs)("div",{children:["• ",e]},t))})}),(0,a.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Tipologia *"}),(0,a.jsx)("input",{type:"text",name:"nome",value:o.nome,onChange:h,placeholder:"Es: Verifica Antincendio",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrizione"}),(0,a.jsx)("textarea",{name:"descrizione",value:o.descrizione,onChange:h,placeholder:"Descrivi brevemente questa tipologia di verifica...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-800",children:"Campi Personalizzati"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e={nome:"",tipo:"testo",obbligatorio:!1};c(t=>({...t,campi_personalizzati:[...t.campi_personalizzati,e]}))},disabled:r,className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors",children:"+ Aggiungi Campo"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[o.campi_personalizzati.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"border border-gray-200 p-4 rounded-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("h5",{className:"font-medium text-gray-700",children:["Campo #",t+1]}),(0,a.jsx)("button",{type:"button",onClick:()=>g(t),className:"text-red-500 hover:text-red-700",children:"\uD83D\uDDD1️"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Nome Campo"}),(0,a.jsx)("input",{type:"text",value:e.nome,onChange:e=>p(t,{nome:e.target.value}),placeholder:"Es: Numero estintori",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Tipo"}),(0,a.jsx)("select",{value:e.tipo,onChange:e=>p(t,{tipo:e.target.value}),title:"Tipo di campo",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm",children:x.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Placeholder"}),(0,a.jsx)("input",{type:"text",value:e.placeholder||"",onChange:e=>p(t,{placeholder:e.target.value}),placeholder:"Testo di aiuto...",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.obbligatorio,onChange:e=>p(t,{obbligatorio:e.target.checked}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Campo obbligatorio"})]})}),"select"===e.tipo&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Opzioni (una per riga)"}),(0,a.jsx)("textarea",{value:(null===(s=e.opzioni)||void 0===s?void 0:s.join("\n"))||"",onChange:e=>p(t,{opzioni:e.target.value.split("\n").filter(e=>""!==e.trim())}),placeholder:"Opzione 1\\nOpzione 2\\nOpzione 3",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),"foto"===e.tipo&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Massimo foto consentite"}),(0,a.jsx)("input",{type:"number",min:"1",max:"10",value:e.maxFoto||5,onChange:e=>p(t,{maxFoto:parseInt(e.target.value)||5}),placeholder:"5",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Numero massimo di foto che gli utenti possono caricare (1-10)"})]})]})]},t)}),0===o.campi_personalizzati.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,a.jsx)("p",{children:"Nessun campo personalizzato configurato"}),(0,a.jsxs)("p",{className:"text-sm",children:["                ",(0,a.jsx)("p",{children:'Clicca su "Aggiungi Campo" per iniziare'})]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:r||!o.nome.trim(),className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:r?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),n?"Aggiornamento...":"Creazione..."]}):n?"Aggiorna Tipologia":"Crea Tipologia"}),s&&(0,a.jsx)("button",{type:"button",onClick:s,disabled:r,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"})]})]})]})}function v(e){let{tipologie:t,loading:s=!1,onEdit:r,onDelete:l,onToggleActive:n}=e,[o,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(null),x=async e=>{c(e);let t=await l(e);c(null),t&&m(null)},u=e=>new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"});return s?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento tipologie..."})]})}):0===t.length?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDCCB"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna tipologia trovata"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Inizia creando la tua prima tipologia di verifica"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Tipologie Verifiche (",t.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipologia"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campi Configurati"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stato"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Creazione"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Azioni"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-purple-600 font-medium",children:e.nome.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.nome}),(0,a.jsx)("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:e.descrizione||"Nessuna descrizione"})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.campi_personalizzati.length}),(0,a.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"campi"}),e.campi_personalizzati.some(e=>e.obbligatorio)&&(0,a.jsx)("span",{className:"ml-2 text-xs bg-red-100 text-red-600 px-2 py-1 rounded",children:"obbligatori"})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.attiva?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.attiva?"✓ Attiva":"○ Disattiva"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(e.data_creazione)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[n&&(0,a.jsx)("button",{onClick:()=>n(e.id,!e.attiva),className:"text-sm px-2 py-1 rounded transition-colors ".concat(e.attiva?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"),title:e.attiva?"Disattiva":"Attiva",children:e.attiva?"⏸️":"▶️"}),(0,a.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"Modifica",children:"✏️"}),(0,a.jsx)("button",{onClick:()=>m(e.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Elimina",children:"\uD83D\uDDD1️"})]})})]},e.id))})]})})]}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Conferma eliminazione"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Sei sicuro di voler eliminare questa tipologia? Questa azione non pu\xf2 essere annullata."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>m(null),disabled:o===d,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"}),(0,a.jsx)("button",{onClick:()=>x(d),disabled:o===d,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors disabled:bg-red-300 disabled:cursor-not-allowed",children:o===d?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Eliminazione..."]}):"Elimina"})]})]})})]})}function f(){let{tipologie:e,loading:t,error:s,createTipologia:r,updateTipologia:l,deleteTipologia:n,clearError:o}=b(),[c,d]=(0,i.useState)(!1),[m,x]=(0,i.useState)(null),[u,h]=(0,i.useState)(!1),[g,p]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(g){let e=setTimeout(()=>p(null),5e3);return()=>clearTimeout(e)}},[g]),(0,i.useEffect)(()=>{if(s){let e=setTimeout(()=>o(),8e3);return()=>clearTimeout(e)}},[s,o]);let f=async e=>{h(!0);let t=await r(e);return h(!1),t&&(d(!1),p("Tipologia creata con successo!")),t},y=async e=>{if(!m)return!1;let t={...e,attiva:m.attiva};h(!0);let s=await l(m.id,t);return h(!1),s&&(x(null),p("Tipologia aggiornata con successo!")),s},N=async e=>{let t=await n(e);return t&&p("Tipologia eliminata con successo!"),t},w=async(t,s)=>{let a=e.find(e=>e.id===t);if(!a)return!1;let i={nome:a.nome,descrizione:a.descrizione,campi_personalizzati:a.campi_personalizzati,attiva:s},r=await l(t,i);return r&&p("Tipologia ".concat(s?"attivata":"disattivata"," con successo!")),r},C={totale:e.length,attive:e.filter(e=>e.attiva).length,conCampi:e.filter(e=>e.campi_personalizzati.length>0).length};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Tipologie Verifiche"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Configura le diverse tipologie di verifiche e i relativi campi personalizzati"})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"bg-purple-50 px-4 py-3 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:C.totale}),(0,a.jsx)("div",{className:"text-sm text-purple-800",children:"Totale"})]}),(0,a.jsxs)("div",{className:"bg-green-50 px-4 py-3 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:C.attive}),(0,a.jsx)("div",{className:"text-sm text-green-800",children:"Attive"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 px-4 py-3 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:C.conCampi}),(0,a.jsx)("div",{className:"text-sm text-blue-800",children:"Con Campi"})]})]})]}),s&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-red-400 mr-3",children:"❌"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-red-800 font-medium",children:"Errore"}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:s})]}),(0,a.jsx)("button",{onClick:o,className:"ml-auto text-red-400 hover:text-red-600",children:"✕"})]})}),g&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-green-400 mr-3",children:"✅"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-green-800 font-medium",children:"Successo"}),(0,a.jsx)("p",{className:"text-green-700 text-sm mt-1",children:g})]}),(0,a.jsx)("button",{onClick:()=>p(null),className:"ml-auto text-green-400 hover:text-green-600",children:"✕"})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{d(!0),x(null)},className:"bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"➕"}),"Nuova Tipologia"]}),(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\uD83D\uDCA1 Le tipologie disattive non appariranno nel wizard verifiche"})]}),c&&(0,a.jsx)(j,{onSubmit:f,onCancel:()=>d(!1),loading:u}),m&&(0,a.jsx)(j,{onSubmit:y,onCancel:()=>{x(null)},loading:u,initialData:{nome:m.nome,descrizione:m.descrizione,campi_personalizzati:m.campi_personalizzati,attiva:m.attiva},isEdit:!0}),(0,a.jsx)(v,{tipologie:e,loading:t,onEdit:e=>{x(e),d(!1)},onDelete:N,onToggleActive:w})]})}function y(e){let{value:t=[],onChange:s,maxFoto:r=5,required:l=!1,nome:n}=e,[o,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)(null),x=(0,i.useRef)(null),u=async e=>{let a=e.target.files;if(a){if(t.length+a.length>r){m("Puoi caricare al massimo ".concat(r," foto"));return}c(!0),m(null);try{let e=[];for(let t=0;t<a.length;t++){let s=a[t];if(!s.type.startsWith("image/")){m("Sono accettati solo file immagine");continue}if(s.size>5242880){m("Le immagini non possono superare i 5MB");continue}let i=await h(s),r=await g(i,1920);e.push(r)}e.length>0&&s([...t,...e])}catch(e){m("Errore durante il caricamento delle foto"),console.error("Error uploading photos:",e)}finally{c(!1),x.current&&(x.current.value="")}}},h=e=>new Promise((t,s)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)}),g=(e,t)=>new Promise(s=>{let a=new Image;a.onload=()=>{let e=document.createElement("canvas"),i=e.getContext("2d"),{width:r,height:l}=a;r>t&&(l=l*t/r,r=t),e.width=r,e.height=l,i.drawImage(a,0,0,r,l),s(e.toDataURL("image/jpeg",.85))},a.src=e}),p=e=>{s(t.filter((t,s)=>s!==e))},b=e=>{let s=window.open("","_blank");s&&(s.document.write("\n        <html>\n          <head><title>Foto ".concat(e+1," - ").concat(n,'</title></head>\n          <body style="margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh;">\n            <img src="').concat(t[e],'" style="max-width:100%;max-height:100%;object-fit:contain;" />\n          </body>\n        </html>\n      ')),s.document.close())};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[(0,a.jsx)("input",{ref:x,type:"file",multiple:!0,accept:"image/*",onChange:u,className:"hidden",id:"foto-upload-".concat(n)}),(0,a.jsx)("div",{className:"space-y-3",children:o?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-gray-600",children:"Caricamento..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-4xl text-gray-400",children:"\uD83D\uDCF7"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"foto-upload-".concat(n),className:"cursor-pointer inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"\uD83D\uDCC1 Seleziona Foto"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Clicca per selezionare o trascina le foto qui",(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-xs",children:["Massimo ",r," foto • JPG, PNG • Max 5MB ciascuna"]})]})]}),t.length<r&&(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:[t.length,"/",r," foto caricate"]})]})})]}),d&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsxs)("div",{className:"text-red-600 text-sm",children:["⚠️ ",d]})}),t.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-700",children:["Foto caricate (",t.length,")",l&&0===t.length&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200",children:(0,a.jsx)("img",{src:e,alt:"Foto ".concat(t+1),className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>b(t)})}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>b(t),className:"p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all",title:"Visualizza a schermo intero",children:"\uD83D\uDC41️"}),(0,a.jsx)("button",{onClick:()=>p(t),className:"p-2 bg-red-500 bg-opacity-90 text-white rounded-full hover:bg-opacity-100 transition-all",title:"Rimuovi foto",children:"\uD83D\uDDD1️"})]})}),(0,a.jsx)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:t+1})]},t))})]}),l&&0===t.length&&(0,a.jsx)("div",{className:"text-red-600 text-sm",children:"Almeno una foto \xe8 richiesta per questo campo"})]})}function N(e){let{selectedCondominio:t,selectedTipologia:s,onCondominioChange:i,onTipologiaChange:r,onNext:l,canProceed:n}=e,{condomini:o,loading:c}=x(),{tipologie:d,loading:m}=b(),u=d.filter(e=>e.attiva);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Step 1: Selezione Condominio e Tipologia"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Seleziona il condominio da verificare e il tipo di verifica da eseguire"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Seleziona Condominio *"}),c?(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsx)("div",{className:"h-12 bg-gray-200 rounded-md"})}):o.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("select",{value:(null==t?void 0:t.id)||"",onChange:e=>{let t=o.find(t=>t.id===e.target.value);t&&i(t)},title:"Seleziona un condominio",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 appearance-none cursor-pointer",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"\uD83C\uDFE2 Seleziona un condominio..."}),o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nome},e.id))]}),t&&(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:(0,a.jsx)("span",{className:"text-blue-600 font-bold text-lg",children:t.nome.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-900",children:t.nome}),(0,a.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:["Aggiunto il ",new Date(t.data_inserimento).toLocaleDateString("it-IT")]})]}),(0,a.jsx)("div",{className:"text-blue-500 text-2xl",children:"✓"})]})})]}):null,!c&&0===o.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFE2"}),(0,a.jsx)("p",{children:"Nessun condominio disponibile"}),(0,a.jsx)("p",{className:"text-sm",children:"Aggiungi prima un condominio nella sezione apposita"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Seleziona Tipologia Verifica *"}),m?(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsx)("div",{className:"h-10 bg-gray-200 rounded-md"})}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3",children:u.map(e=>(0,a.jsx)("button",{onClick:()=>r(e),className:"p-4 border-2 rounded-lg text-left transition-all ".concat((null==s?void 0:s.id)===e.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3 mt-1",children:(0,a.jsx)("span",{className:"text-green-600 font-medium",children:e.nome.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.nome}),(0,a.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.descrizione}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:[e.campi_personalizzati.length," campi configurati"]})]})]}),(null==s?void 0:s.id)===e.id&&(0,a.jsx)("div",{className:"text-green-500 text-xl",children:"✓"})]})},e.id))}),!m&&0===u.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,a.jsx)("p",{children:"Nessuna tipologia di verifica attiva"}),(0,a.jsx)("p",{className:"text-sm",children:"Configura prima le tipologie nella sezione apposita"})]})]}),t&&s&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Riepilogo Selezioni:"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Condominio:"})," ",t.nome]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Tipologia:"})," ",s.nome]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Campi da compilare:"})," ",s.campi_personalizzati.length]})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsxs)("button",{onClick:l,disabled:!n,className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:["Continua",(0,a.jsx)("span",{children:"→"})]})})]})}function w(e){let{tipologia:t,datiVerifica:s,onDatiChange:r,onNext:l,onPrevious:n,canProceed:o}=e,[c,d]=(0,i.useState)({}),m=(e,t)=>{if(r({...s,[e.nome]:t}),c[e.nome]){let t={...c};delete t[e.nome],d(t)}},x=()=>{let e={};return t.campi_personalizzati.forEach(t=>{if(t.obbligatorio){let a=s[t.nome];"foto"===t.tipo?a&&Array.isArray(a)&&0!==a.length||(e[t.nome]="Almeno una foto \xe8 richiesta"):a&&("string"!=typeof a||""!==a.trim())||(e[t.nome]="Questo campo \xe8 obbligatorio")}}),d(e),0===Object.keys(e).length},u=e=>{let t=s[e.nome]||"",i=c[e.nome];switch(e.tipo){case"testo":return(0,a.jsx)("input",{type:"text",value:t,onChange:t=>m(e,t.target.value),placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(i?"border-red-500":"border-gray-300")});case"numero":return(0,a.jsx)("input",{type:"number",value:t,onChange:t=>m(e,parseFloat(t.target.value)||""),placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(i?"border-red-500":"border-gray-300")});case"data":return(0,a.jsx)("input",{type:"date",value:t,onChange:t=>m(e,t.target.value),title:e.nome,placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(i?"border-red-500":"border-gray-300")});case"checkbox":return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:!0===t,onChange:t=>m(e,t.target.checked),title:e.nome,placeholder:e.placeholder,className:"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.placeholder||"Seleziona se applicabile"})]});case"select":var r;return(0,a.jsxs)("select",{value:t,onChange:t=>m(e,t.target.value),title:e.nome,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(i?"border-red-500":"border-gray-300"),children:[(0,a.jsx)("option",{value:"",children:"Seleziona..."}),null===(r=e.opzioni)||void 0===r?void 0:r.map((e,t)=>(0,a.jsx)("option",{value:e,children:e},t))]});case"textarea":return(0,a.jsx)("textarea",{value:t,onChange:t=>m(e,t.target.value),placeholder:e.placeholder,rows:4,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(i?"border-red-500":"border-gray-300")});case"foto":return(0,a.jsx)(y,{value:t||[],onChange:t=>m(e,t),maxFoto:e.maxFoto||5,required:e.obbligatorio,nome:e.nome});default:return null}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Step 2: Compilazione Dati Verifica"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["Compila i campi richiesti per la verifica: ",(0,a.jsx)("strong",{children:t.nome})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Campi obbligatori contrassegnati con *"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[t.campi_personalizzati.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.nome,e.obbligatorio&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),u(e),c[e.nome]&&(0,a.jsx)("div",{className:"text-red-500 text-sm mt-1",children:c[e.nome]})]},e.id)),0===t.campi_personalizzati.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,a.jsx)("p",{children:"Nessun campo configurato per questa tipologia"}),(0,a.jsx)("p",{className:"text-sm",children:"Puoi procedere direttamente al passo successivo"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,a.jsxs)("button",{onClick:n,className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"←"}),"Indietro"]}),(0,a.jsxs)("button",{onClick:()=>{x()&&l()},disabled:!o,className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:["Continua",(0,a.jsx)("span",{children:"→"})]})]})]})}function C(e){let{condominio:t,tipologia:s,datiVerifica:i,note:r,onNoteChange:l,onComplete:n,onPrevious:o,loading:c=!1}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Step 3: Riepilogo e Completamento"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Verifica i dati inseriti e completa la verifica"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Riepilogo Verifica"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium text-gray-700 mb-2",children:"Informazioni Generali"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Condominio:"})," ",t.nome]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Tipologia:"})," ",s.nome]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Data:"})," ",new Date().toLocaleDateString("it-IT")]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium text-gray-700 mb-2",children:"Dati Raccolti"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[Object.entries(i).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[t,":"]})," ","boolean"==typeof s?s?"S\xec":"No":String(s)]},t)}),0===Object.keys(i).length&&(0,a.jsx)("div",{className:"text-gray-500 italic",children:"Nessun dato raccolto"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note Aggiuntive"}),(0,a.jsx)("textarea",{value:r,onChange:e=>l(e.target.value),placeholder:"Inserisci eventuali note, osservazioni o commenti sulla verifica...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:c})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("h5",{className:"font-medium text-blue-800 mb-2",children:"Opzioni di Completamento"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-blue-700",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCE7"}),"Email di notifica sar\xe0 inviata automaticamente"]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCBE"}),"I dati verranno salvati nel sistema"]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCB"}),"La verifica sar\xe0 disponibile nel pannello amministratore"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,a.jsxs)("button",{onClick:o,disabled:c,className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"←"}),"Indietro"]}),(0,a.jsx)("button",{onClick:n,disabled:c,className:"bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:c?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Completamento..."]}):(0,a.jsx)(a.Fragment,{children:"✓ Completa Verifica"})})]})]})}function D(e){let{lavorazione:t,onLavorazioneComplete:s,onBack:r}=e,l=!!t,[n,o]=(0,i.useState)(l?2:1),[c,d]=(0,i.useState)(null),[m,x]=(0,i.useState)(null),[u,h]=(0,i.useState)({}),[g,p]=(0,i.useState)(""),[b,j]=(0,i.useState)(!1),[v,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{if(t&&t.verifica){let e=t.verifica;j(!0);try{if(e.condominio_id){let t=await fetch("/api/condomini/".concat(e.condominio_id));if(t.ok){let e=await t.json();e.success&&d(e.data)}}if(e.tipologia_id){let t=await fetch("/api/tipologie/".concat(e.tipologia_id));if(t.ok){let e=await t.json();e.success&&x(e.data)}}e.dati_verifica&&h(e.dati_verifica),e.note&&p(e.note)}catch(e){console.error("Errore nel caricamento dei dati della lavorazione:",e)}finally{j(!1)}}})()},[t]);let y=async()=>{if(l&&t&&"da_eseguire"===t.stato)try{await fetch("/api/lavorazioni/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"inizia",nota:"Verifica iniziata dal sopralluoghista"})})}catch(e){console.error("Errore nell'iniziare la lavorazione:",e)}o(3)},D=()=>{if(l&&2===n){r&&r();return}o(e=>e-1)},z=async()=>{if(c&&m){j(!0);try{if(l&&t){let e=await fetch("/api/lavorazioni/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"completa",dati_verifica:u,nota:g})}),a=await e.json();a.success?(f(!0),setTimeout(()=>{s&&s(t.id)},2e3)):alert("Errore nel completamento della lavorazione: "+a.error)}else{let e={condominio_id:c.id,tipologia_id:m.id,dati_verifica:u,note:g},t=await fetch("/api/verifiche",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();s.success?(f(!0),setTimeout(()=>{o(l?2:1),d(null),x(null),h({}),p(""),f(!1)},3e3)):alert("Errore nel completamento della verifica: "+s.error)}}catch(e){alert("Errore di connessione")}j(!1)}},S=!!(c&&m),k=!m||m.campi_personalizzati.filter(e=>e.obbligatorio).every(e=>u[e.nome]&&""!==u[e.nome]);return v?(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:l?"Lavorazione Completata!":"Verifica Completata con Successo!"}),(0,a.jsxs)("div",{className:"space-y-2 text-gray-600 mb-6",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Condominio:"})," ",null==c?void 0:c.nome]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Tipologia:"})," ",null==m?void 0:m.nome]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Data:"})," ",new Date().toLocaleDateString("it-IT")]}),l&&t&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Lavorazione:"})," #",t.id]})]}),(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-lg mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center text-green-700",children:[(0,a.jsx)("span",{className:"mr-2",children:l?"✅":"\uD83D\uDCE7"}),l?"Lavorazione aggiornata e notificata all'amministratore":"Email di notifica inviata con successo"]})}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Reindirizzamento automatico in corso..."})]})})}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:l?"Completa Lavorazione":"Wizard Verifiche"}),l&&t&&(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:[(0,a.jsxs)("strong",{children:["Lavorazione #",t.id,":"]})," ",t.descrizione]}),(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(l?[2,3]:[1,2,3]).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium ".concat(e<n?"bg-green-500 text-white":e===n?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"),children:e<n?"✓":e}),t<(l?[2,3]:[1,2,3]).length-1&&(0,a.jsx)("div",{className:"w-16 md:w-32 h-1 mx-2 ".concat(e<n?"bg-green-500":"bg-gray-200")})]},e))}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 ".concat(l?"justify-around":""),children:[!l&&(0,a.jsx)("span",{className:1===n?"font-medium text-blue-600":"",children:"Selezione"}),(0,a.jsx)("span",{className:2===n?"font-medium text-blue-600":"",children:"Compilazione"}),(0,a.jsx)("span",{className:3===n?"font-medium text-blue-600":"",children:"Riepilogo"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[1===n&&!l&&(0,a.jsx)(N,{selectedCondominio:c,selectedTipologia:m,onCondominioChange:d,onTipologiaChange:x,onNext:()=>{c&&m&&o(2)},canProceed:S}),2===n&&m&&(0,a.jsx)(w,{tipologia:m,datiVerifica:u,onDatiChange:h,onNext:y,onPrevious:D,canProceed:k}),3===n&&c&&m&&(0,a.jsx)(C,{condominio:c,tipologia:m,datiVerifica:u,note:g,onNoteChange:p,onComplete:z,onPrevious:D,loading:b})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-between",children:[(0,a.jsxs)("button",{onClick:()=>{o(1),d(null),x(null),h({}),p(""),f(!1)},className:"text-gray-600 hover:text-gray-800 text-sm flex items-center gap-1",children:[(0,a.jsx)("span",{children:"\uD83D\uDD04"}),"Ricomincia"]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\uD83D\uDCA1 I dati vengono salvati automaticamente ad ogni passaggio"})]})]})}function z(e){let{foto:t,nome:s}=e,[r,l]=(0,i.useState)(null);if(!t||0===t.length)return null;let n=e=>{l(e)},o=e=>{let a=document.createElement("a");a.href=t[e],a.download="".concat(s,"_foto_").concat(e+1,".jpg"),document.body.appendChild(a),a.click(),document.body.removeChild(a)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("h5",{className:"text-sm font-medium text-gray-700",children:["\uD83D\uDCF7 ",s," (",t.length," foto)"]})}),(0,a.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"relative group cursor-pointer",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-colors",children:(0,a.jsx)("img",{src:e,alt:"Foto ".concat(t+1," - ").concat(s),className:"w-full h-full object-cover hover:scale-105 transition-transform",onClick:()=>n(t)})}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-200 rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>n(t),className:"p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all",title:"Visualizza",children:"\uD83D\uDC41️"}),(0,a.jsx)("button",{onClick:()=>o(t),className:"p-2 bg-blue-500 bg-opacity-90 text-white rounded-full hover:bg-opacity-100 transition-all",title:"Scarica",children:"\uD83D\uDCBE"})]})}),(0,a.jsx)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:t+1})]},t))})]}),null!==r&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[(0,a.jsx)("img",{src:t[r],alt:"Foto ".concat(r+1," - ").concat(s),className:"max-w-full max-h-full object-contain"}),(0,a.jsx)("div",{className:"absolute top-4 left-4 text-white",children:(0,a.jsxs)("div",{className:"bg-black bg-opacity-75 px-4 py-2 rounded-lg",children:[(0,a.jsx)("div",{className:"font-medium",children:s}),(0,a.jsxs)("div",{className:"text-sm text-gray-300",children:["Foto ",r+1," di ",t.length]})]})}),r>0&&(0,a.jsx)("button",{onClick:()=>{null!==r&&r>0&&l(r-1)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-75 text-white p-4 rounded-full hover:bg-opacity-90 transition-all",title:"Foto precedente",children:"⬅️"}),r<t.length-1&&(0,a.jsx)("button",{onClick:()=>{null!==r&&r<t.length-1&&l(r+1)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-75 text-white p-4 rounded-full hover:bg-opacity-90 transition-all",title:"Foto successiva",children:"➡️"}),(0,a.jsxs)("div",{className:"absolute bottom-4 right-4 flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>o(r),className:"bg-blue-500 bg-opacity-90 text-white px-4 py-2 rounded-lg hover:bg-opacity-100 transition-all",title:"Scarica foto",children:"\uD83D\uDCBE Scarica"}),(0,a.jsx)("button",{onClick:()=>{l(null)},className:"bg-red-500 bg-opacity-90 text-white px-4 py-2 rounded-lg hover:bg-opacity-100 transition-all",title:"Chiudi",children:"❌ Chiudi"})]}),(0,a.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-black bg-opacity-75 p-3 rounded-lg max-w-xs overflow-x-auto",children:t.map((e,t)=>(0,a.jsx)("div",{onClick:()=>l(t),className:"cursor-pointer w-12 h-12 rounded overflow-hidden border-2 transition-all ".concat(r===t?"border-blue-400":"border-gray-600 hover:border-gray-400"),children:(0,a.jsx)("img",{src:e,alt:"Miniatura ".concat(t+1),className:"w-full h-full object-cover"})},t))})]})})]})}function S(){let[e,t]=(0,i.useState)([]),[s,r]=(0,i.useState)(!0),[l,n]=(0,i.useState)(null),o=async()=>{try{let e=await fetch("/api/users"),s=await e.json();s.success?t(s.data):n(s.error)}catch(e){n("Errore nel caricamento degli utenti")}finally{r(!1)}};(0,i.useEffect)(()=>{o()},[]);let c=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"approve"})}),s=await t.json();s.success?(await o(),alert("Utente approvato con successo!")):alert("Errore nell'approvazione: "+s.error)}catch(e){alert("Errore nell'approvazione dell'utente")}},d=async e=>{if(confirm("Sei sicuro di voler rifiutare questo utente? Verr\xe0 rimosso dalla lista di attesa."))try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"reject"})}),s=await t.json();s.success?(await o(),alert("Utente rifiutato e rimosso dalla lista di attesa")):alert("Errore nel rifiuto: "+s.error)}catch(e){alert("Errore nel rifiuto dell'utente")}},m=async e=>{if(confirm("Resettare la password? Verr\xe0 generata una password temporanea da comunicare all'utente."))try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"reset_password"})}),s=await t.json();s.success&&s.tempPassword?(alert("Password temporanea generata!\n\nUsername: ".concat(s.username,"\nPassword temporanea: ").concat(s.tempPassword,"\n\nComunica queste credenziali all'utente.\nAl primo accesso dovr\xe0 cambiare la password.")),navigator.clipboard&&navigator.clipboard.writeText("Username: ".concat(s.username,"\nPassword: ").concat(s.tempPassword)).then(()=>{console.log("Credenziali copiate negli appunti")})):alert("Errore nel reset password: "+(s.error||"Password temporanea non generata"))}catch(e){alert("Errore nel reset della password")}},x=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"activate"})}),s=await t.json();s.success?(await o(),alert("Utente riattivato")):alert("Errore nella riattivazione: "+s.error)}catch(e){alert("Errore nella riattivazione dell'utente")}},u=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"deactivate"})}),s=await t.json();s.success?(await o(),alert("Utente disattivato")):alert("Errore nella disattivazione: "+s.error)}catch(e){alert("Errore nella disattivazione dell'utente")}},h=e=>new Date(e).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),g=e.filter(e=>!e.approved_at&&!e.rejected_at&&"sopralluoghista"===e.role&&e.attivo),p=e.filter(e=>e.approved_at||"admin"===e.role);return s?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento utenti..."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\uD83D\uDC65 Gestione Utenti"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Approva nuovi sopralluoghisti e gestisci gli account"})]}),l&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"text-red-600",children:["❌ ",l]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:g.length}),(0,a.jsx)("div",{className:"text-yellow-800 text-sm",children:"Da Approvare"})]}),(0,a.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:p.length}),(0,a.jsx)("div",{className:"text-green-800 text-sm",children:"Approvati"})]}),(0,a.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:e.length}),(0,a.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,a.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDC65"})]})})]}),g.length>0&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["⏳ Utenti in Attesa di Approvazione (",g.length,")"]}),(0,a.jsx)("div",{className:"space-y-4",children:g.map(e=>(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[e.nome," ",e.cognome]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["@",e.username]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["Registrato: ",h(e.created_at)]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>c(e.id),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm",children:"✅ Approva"}),(0,a.jsx)("button",{onClick:()=>d(e.id),className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm",children:"❌ Rifiuta"})]})]})},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"p-6 border-b",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Tutti gli Utenti"})}),(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-4",children:(0,a.jsx)("span",{className:"text-gray-600 font-medium",children:e.nome?e.nome.charAt(0).toUpperCase():e.username.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[e.nome," ",e.cognome,(0,a.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-medium rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role.toUpperCase()})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["@",e.username," • ",e.email]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[e.approved_at?"Approvato: ".concat(h(e.approved_at)):e.rejected_at?"Rifiutato: ".concat(h(e.rejected_at)):"In attesa di approvazione",e.password_reset_required&&(0,a.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full",children:"\uD83D\uDD11 Reset Password Richiesto"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(e.attivo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.attivo?"Attivo":"Disattivo"}),e.approved_at?(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"✅ Approvato"}):e.rejected_at?(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"❌ Rifiutato"}):(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"⏳ Pending"})]}),"admin"!==e.role&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 ml-2",children:[(0,a.jsx)("button",{onClick:()=>m(e.id),className:"bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 transition-colors",children:"\uD83D\uDD11 Reset Password"}),e.attivo?(0,a.jsx)("button",{onClick:()=>u(e.id),className:"bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition-colors",children:"❌ Disattiva"}):(0,a.jsx)("button",{onClick:()=>x(e.id),className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600 transition-colors",children:"✅ Attiva"})]})]})]})},e.id))})]})]})}function k(){let[e,t]=(0,i.useState)("lavorazioni"),[s,r]=(0,i.useState)([]),[l,n]=(0,i.useState)(!0),[o,c]=(0,i.useState)(null),[d,m]=(0,i.useState)("tutte"),[x,u]=(0,i.useState)(null),[h,g]=(0,i.useState)(!1),[p,b]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),f=(0,i.useCallback)(async()=>{n(!0);try{let e="tutte"!==d?"/api/lavorazioni?stato=".concat(d):"/api/lavorazioni",t=await fetch(e),s=await t.json();s.success?r(s.data):c(s.error)}catch(e){c("Errore nel caricamento delle lavorazioni")}n(!1)},[d]);(0,i.useEffect)(()=>{f()},[f]);let y=async(e,t,s)=>{try{let a=await fetch("/api/lavorazioni/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:t,nota:s})}),i=await a.json();i.success?(f(),g(!1),b(""),u(null)):c(i.error)}catch(e){c("Errore nell'esecuzione dell'azione")}},N=(e,t)=>{u(e),v(t),g(!0)},w=e=>new Date(e).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),C=e=>{switch(e){case"da_eseguire":return"bg-blue-100 text-blue-800";case"in_corso":return"bg-yellow-100 text-yellow-800";case"completata":return"bg-green-100 text-green-800";case"riaperta":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},D=e=>{switch(e){case"da_eseguire":return"�";case"in_corso":return"⏳";case"completata":return"✅";case"riaperta":return"\uD83D\uDD04";default:return"❓"}},k={totali:s.length,da_eseguire:s.filter(e=>"da_eseguire"===e.stato).length,in_corso:s.filter(e=>"in_corso"===e.stato).length,completata:s.filter(e=>"completata"===e.stato).length,riaperte:s.filter(e=>"riaperta"===e.stato).length};return l?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento lavorazioni..."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Pannello Amministratore"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Gestisci lavorazioni, utenti e configurazioni del sistema"})]}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>t("lavorazioni"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("lavorazioni"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83D\uDD27 Lavorazioni"}),(0,a.jsx)("button",{onClick:()=>t("utenti"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("utenti"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83D\uDC65 Utenti"})]})}),"utenti"===e&&(0,a.jsx)(S,{}),"lavorazioni"===e&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:k.totali}),(0,a.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,a.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDCCA"})]})}),(0,a.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:k.da_eseguire}),(0,a.jsx)("div",{className:"text-yellow-800 text-sm",children:"Da Eseguire"})]}),(0,a.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:k.in_corso}),(0,a.jsx)("div",{className:"text-blue-800 text-sm",children:"In Corso"})]}),(0,a.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDD04"})]})}),(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:k.completata}),(0,a.jsx)("div",{className:"text-green-800 text-sm",children:"Completate"})]}),(0,a.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,a.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:k.riaperte}),(0,a.jsx)("div",{className:"text-orange-800 text-sm",children:"Riaperte"})]}),(0,a.jsx)("div",{className:"text-orange-400 text-2xl",children:"\uD83D\uDD04"})]})})]}),(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Filtra per stato:"}),(0,a.jsxs)("select",{value:d,onChange:e=>m(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Filtra lavorazioni per stato",children:[(0,a.jsx)("option",{value:"tutte",children:"Tutte le lavorazioni"}),(0,a.jsx)("option",{value:"aperta",children:"Solo aperte"}),(0,a.jsx)("option",{value:"chiusa",children:"Solo chiuse"}),(0,a.jsx)("option",{value:"riaperta",children:"Solo riaperte"})]}),(0,a.jsxs)("button",{onClick:f,className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]})]}),o&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"text-red-600",children:["❌ ",o]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:0===s.length?(0,a.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Nessuna lavorazione trovata"}),(0,a.jsx)("p",{children:"Non ci sono lavorazioni che corrispondono ai filtri selezionati"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:s.map(e=>{var t;return(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:D(e.stato)}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(C(e.stato)),children:e.stato.toUpperCase()}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e.descrizione}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Aperta:"})," ",w(e.data_apertura)]}),e.data_chiusura&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Chiusa:"})," ",w(e.data_chiusura)]}),e.data_riapertura&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Riaperta:"})," ",w(e.data_riapertura)]})]}),e.note.length>0&&(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md mb-3",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Note (",e.note.length,"):"]}),(0,a.jsx)("div",{className:"space-y-2",children:e.note.map((e,t)=>(0,a.jsxs)("div",{className:"text-sm text-gray-600 flex items-start",children:[(0,a.jsx)("span",{className:"text-blue-500 mr-2",children:"•"}),e]},t))})]}),(null===(t=e.verifica)||void 0===t?void 0:t.dati_verifica)&&Object.entries(e.verifica.dati_verifica).some(e=>{let[t,s]=e;return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0].startsWith("data:image")})&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"\uD83D\uDCF7 Foto Allegate"}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(e.verifica.dati_verifica).filter(e=>{let[t,s]=e;return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0].startsWith("data:image")}).map(e=>{let[t,s]=e;return(0,a.jsx)(z,{foto:s,nome:t},t)})})]})]}),(0,a.jsxs)("div",{className:"ml-4 flex flex-col gap-2",children:[(0,a.jsx)("button",{onClick:()=>N(e,"aggiungi_nota"),className:"text-blue-600 hover:text-blue-800 text-sm px-3 py-1 border border-blue-200 rounded",children:"\uD83D\uDCDD Aggiungi Nota"}),("da_eseguire"===e.stato||"in_corso"===e.stato)&&(0,a.jsx)("button",{onClick:()=>N(e,"completa"),className:"text-green-600 hover:text-green-800 text-sm px-3 py-1 border border-green-200 rounded",children:"✅ Completa"}),"completata"===e.stato&&(0,a.jsx)("button",{onClick:()=>N(e,"riapri"),className:"text-orange-600 hover:text-orange-800 text-sm px-3 py-1 border border-orange-200 rounded",children:"\uD83D\uDD04 Riapri"})]})]})},e.id)})})}),h&&x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["chiudi"===j&&"Chiudi Lavorazione","riapri"===j&&"Riapri Lavorazione","aggiungi_nota"===j&&"Aggiungi Nota"]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,a.jsx)("strong",{children:"Lavorazione:"})," ",x.descrizione]}),(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"aggiungi_nota"===j?"Nuova nota:":"Nota (opzionale):"}),(0,a.jsx)("textarea",{value:p,onChange:e=>b(e.target.value),placeholder:"Inserisci una nota...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Annulla"}),(0,a.jsx)("button",{onClick:()=>{x&&y(x.id,j,p)},className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Conferma"})]})]})})]})]})}function E(){let{user:e}=n(),[t,s]=(0,i.useState)([]),[r,l]=(0,i.useState)(!0),[o,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(null),[x,u]=(0,i.useState)(!1),h=(0,i.useCallback)(async()=>{if(null==e?void 0:e.id){l(!0);try{let t=await fetch("/api/lavorazioni?utente=".concat(e.id)),a=await t.json();if(a.success){let t=a.data.filter(t=>t.utente_assegnato===e.id||"da_eseguire"===t.stato||"riaperta"===t.stato);s(t)}else c(a.error)}catch(e){c("Errore nel caricamento delle lavorazioni")}l(!1)}},[null==e?void 0:e.id]);(0,i.useEffect)(()=>{h()},[h]);let g=e=>{m(e),u(!0)},p=e=>{switch(e){case"da_eseguire":return{icon:"\uD83D\uDCCB",color:"bg-blue-100 text-blue-800",label:"DA ESEGUIRE",description:"Nuova verifica da completare"};case"in_corso":return{icon:"⏳",color:"bg-yellow-100 text-yellow-800",label:"IN CORSO",description:"Verifica in fase di esecuzione"};case"riaperta":return{icon:"\uD83D\uDD04",color:"bg-orange-100 text-orange-800",label:"RIAPERTA",description:"Verifica da ricontrollare"};case"completata":return{icon:"✅",color:"bg-green-100 text-green-800",label:"COMPLETATA",description:"Verifica terminata con successo"};default:return{icon:"❓",color:"bg-gray-100 text-gray-800",label:"SCONOSCIUTO",description:"Stato non definito"}}},b=e=>new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),j={totali:t.length,da_eseguire:t.filter(e=>"da_eseguire"===e.stato).length,in_corso:t.filter(e=>"in_corso"===e.stato).length,completate:t.filter(e=>"completata"===e.stato).length,riaperte:t.filter(e=>"riaperta"===e.stato).length};return r?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento lavorazioni..."})]}):x&&d?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["Verifica: ",d.descrizione]}),(0,a.jsx)("button",{onClick:()=>{u(!1),m(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",children:"← Torna alle lavorazioni"})]}),(0,a.jsx)(D,{lavorazione:d,onLavorazioneComplete:e=>{h(),m(null),u(!1)},onBack:()=>{m(null),u(!1)}})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"\uD83D\uDC77 Pannello Sopralluoghista"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Benvenuto ",(0,a.jsxs)("strong",{children:[null==e?void 0:e.nome," ",null==e?void 0:e.cognome]}),"! Qui trovi tutte le verifiche assegnate da completare."]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:j.totali}),(0,a.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,a.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDCCA"})]})}),(0,a.jsx)("div",{className:"bg-indigo-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:j.da_eseguire}),(0,a.jsx)("div",{className:"text-indigo-800 text-sm",children:"Da Eseguire"})]}),(0,a.jsx)("div",{className:"text-indigo-400 text-2xl",children:"\uD83D\uDCCB"})]})}),(0,a.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:j.in_corso}),(0,a.jsx)("div",{className:"text-yellow-800 text-sm",children:"In Corso"})]}),(0,a.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,a.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:j.completate}),(0,a.jsx)("div",{className:"text-green-800 text-sm",children:"Completate"})]}),(0,a.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,a.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:j.riaperte}),(0,a.jsx)("div",{className:"text-orange-800 text-sm",children:"Riaperte"})]}),(0,a.jsx)("div",{className:"text-orange-400 text-2xl",children:"\uD83D\uDD04"})]})})]}),o&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"text-red-600",children:["❌ ",o]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:0===t.length?(0,a.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Nessuna lavorazione assegnata"}),(0,a.jsx)("p",{children:"Al momento non hai verifiche da completare."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Le nuove lavorazioni appariranno qui quando verranno assegnate dall'amministratore."})]}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Le tue Verifiche (",t.length,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{let t=p(e.stato);return(0,a.jsxs)("div",{className:"border rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>g(e),children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-3xl mr-3",children:t.icon}),(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.color),children:t.label})})]})}),(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:e.descrizione}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:t.description}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Assegnata:"})," ",e.data_assegnazione?b(e.data_assegnazione):b(e.data_apertura)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"ID:"})," ",e.id.substring(0,8),"..."]})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Clicca per ","completata"===e.stato?"visualizzare":"iniziare"]}),(0,a.jsx)("span",{className:"text-blue-500",children:"→"})]})})]},e.id)})})]})})]})}function _(e){let{onNavigate:t}=e,[s,r]=(0,i.useState)({condomini:{totali:0,attivi:0,inattivi:0},tipologie:{totali:0,attive:0,inattive:0},verifiche:{totali:0,verificheCompletate:0,inCorso:0,scadute:0},lavorazioni:{totali:0,da_eseguire:0,in_corso:0,completate:0}}),[l,n]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/dashboard/stats"),t=await e.json();t.success&&r({condomini:{totali:t.data.totali.condomini,attivi:t.data.totali.condomini,inattivi:0},tipologie:{totali:t.data.totali.tipologie,attive:t.data.totali.tipologie,inattive:0},verifiche:{totali:t.data.totali.verifiche,verificheCompletate:t.data.lavorazioni.completate||0,inCorso:t.data.lavorazioni.in_corso||0,scadute:0},lavorazioni:{totali:t.data.lavorazioni.totali,da_eseguire:t.data.lavorazioni.da_eseguire,in_corso:t.data.lavorazioni.in_corso,completate:t.data.lavorazioni.completate}})}catch(e){console.error("Errore nel caricamento delle statistiche:",e)}finally{n(!1)}})()},[]),l)?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento statistiche..."})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Dashboard"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-blue-50 p-6 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-blue-800",children:"Condomini Attivi"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:l?"...":s.condomini.attivi})]}),(0,a.jsx)("div",{className:"text-blue-400 text-3xl",children:"\uD83C\uDFE2"})]})}),(0,a.jsx)("div",{className:"bg-green-50 p-6 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-green-800",children:"Verifiche Completate"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-2",children:s.verifiche.verificheCompletate})]}),(0,a.jsx)("div",{className:"text-green-400 text-3xl",children:"✅"})]})}),(0,a.jsx)("div",{className:"bg-yellow-50 p-6 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"In Corso"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-yellow-600 mt-2",children:s.verifiche.inCorso})]}),(0,a.jsx)("div",{className:"text-yellow-400 text-3xl",children:"⏳"})]})}),(0,a.jsx)("div",{className:"bg-red-50 p-6 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Scadute"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600 mt-2",children:s.verifiche.scadute})]}),(0,a.jsx)("div",{className:"text-red-400 text-3xl",children:"⚠️"})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Condomini Recenti",(0,a.jsx)("span",{className:"ml-2 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:s.condomini.totali})]}),l?(0,a.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]}):s.condomini.totali>0?(0,a.jsxs)("div",{className:"p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s.condomini.totali}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"condomini registrati"})]}):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nessun condominio presente"})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Azioni Rapide"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("condomini"),className:"w-full text-left p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:"\uD83C\uDFE2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Nuovo Condominio"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Aggiungi un nuovo condominio al sistema"})]})]})}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("verifiche"),className:"w-full text-left p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:"✅"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Nuova Verifica"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Avvia il wizard per una nuova verifica"})]})]})}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("tipologie"),className:"w-full text-left p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:"\uD83D\uDCCB"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Tipologie Verifiche"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Gestisci le tipologie di verifica"})]})]})}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("admin"),className:"w-full text-left p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:"⚙️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Pannello Admin"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Gestisci lavorazioni e riapri verifiche"})]})]})})]})]})]})]})}function A(){var e;let{isAuthenticated:t,user:s,role:r,logout:l}=n(),[o,d]=(0,i.useState)("admin"===r?"dashboard":"lavorazioni"),m="admin"===r?[{id:"dashboard",name:"Dashboard",icon:"\uD83C\uDFE0"},{id:"condomini",name:"Condomini",icon:"\uD83C\uDFE2"},{id:"tipologie",name:"Tipologie",icon:"\uD83D\uDCCB"},{id:"verifiche",name:"Nuova Verifica",icon:"✅"},{id:"admin",name:"Gestione Lavorazioni",icon:"⚙️"}]:[{id:"lavorazioni",name:"Le Mie Lavorazioni",icon:"\uD83D\uDCCB"},{id:"completate",name:"Completate",icon:"✅"}];return t?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,a.jsxs)("nav",{className:"w-64 bg-white shadow-lg",children:[(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Verifiche Condominiali"})}),(0,a.jsx)("ul",{className:"mt-6",children:m.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>d(e.id),className:"w-full flex items-center px-6 py-3 text-left hover:bg-blue-50 transition-colors ".concat(o===e.id?"bg-blue-100 border-r-4 border-blue-500 text-blue-700":"text-gray-600"),children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:e.icon}),e.name]})},e.id))})]}),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:null===(e=m.find(e=>e.id===o))||void 0===e?void 0:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"admin"===r?"Pannello Amministratore":"Pannello Sopralluoghista"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-700",children:[null==s?void 0:s.nome," ",null==s?void 0:s.cognome]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"admin"===r?"\uD83D\uDC51 Amministratore":"\uD83D\uDC77 Sopralluoghista"})]}),(0,a.jsx)("button",{onClick:l,className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50 transition-colors",title:"Disconnetti",children:"\uD83D\uDEAA Esci"})]})]})}),(0,a.jsxs)("div",{className:"p-8",children:["admin"===r&&(0,a.jsxs)(a.Fragment,{children:["dashboard"===o&&(0,a.jsx)(_,{onNavigate:d}),"condomini"===o&&(0,a.jsx)(g,{}),"tipologie"===o&&(0,a.jsx)(f,{}),"verifiche"===o&&(0,a.jsx)(D,{}),"admin"===o&&(0,a.jsx)(k,{})]}),"sopralluoghista"===r&&(0,a.jsxs)(a.Fragment,{children:["lavorazioni"===o&&(0,a.jsx)(E,{}),"completate"===o&&(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"✅"}),(0,a.jsx)("h3",{className:"text-xl font-medium mb-2",children:"Lavorazioni Completate"}),(0,a.jsx)("p",{children:"Qui vedrai lo storico delle verifiche che hai completato."}),(0,a.jsx)("p",{className:"text-sm mt-2 text-gray-400",children:"Funzionalit\xe0 in sviluppo..."})]})})]})]})]})]}):(0,a.jsx)(c,{})}function T(){return(0,a.jsx)(l,{children:(0,a.jsx)(A,{})})}p.API_BASE="/api/tipologie"}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3210)}),_N_E=e.O()}]);