(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3210:function(e,t,a){Promise.resolve().then(a.bind(a,5086))},5086:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return er}});var i=a(7437),s=a(2265);let r=(0,s.createContext)(null);function n(e){let{children:t}=e,[a,n]=(0,s.useState)({isAuthenticated:!1,user:null,role:null});(0,s.useEffect)(()=>{let e=localStorage.getItem("verifiche_auth");if(e)try{let t=JSON.parse(e);n(t)}catch(e){console.error("Errore nel parsing auth:",e),localStorage.removeItem("verifiche_auth")}},[]),(0,s.useEffect)(()=>{a.isAuthenticated?localStorage.setItem("verifiche_auth",JSON.stringify(a)):localStorage.removeItem("verifiche_auth")},[a]);let l=async(e,t)=>{try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),i=await a.json();if(i.success&&i.user)return n({isAuthenticated:!0,user:i.user,role:i.user.role}),!0;return!1}catch(e){return console.error("Errore durante il login:",e),!1}},o={...a,login:l,logout:()=>{n({isAuthenticated:!1,user:null,role:null})}};return(0,i.jsx)(r.Provider,{value:o,children:t})}function l(){let e=(0,s.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function o(e){let{onBack:t,onSuccess:a}=e,[r,n]=(0,s.useState)({username:"",email:"",password:"",confirmPassword:"",nome:"",cognome:"",telefono:""}),[l,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),m=e=>{n(t=>({...t,[e.target.name]:e.target.value})),o("")},x=async e=>{if(e.preventDefault(),d(!0),o(""),r.password!==r.confirmPassword){o("Le password non coincidono"),d(!1);return}if(r.password.length<6){o("La password deve essere di almeno 6 caratteri"),d(!1);return}if(!r.email.includes("@")){o("Inserisci una email valida"),d(!1);return}try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r.username,email:r.email,password:r.password,nome:r.nome,cognome:r.cognome,telefono:r.telefono})}),t=await e.json();t.success?a():o(t.message||"Errore nella registrazione")}catch(e){console.error("Errore registrazione:",e),o("Errore durante la registrazione")}finally{d(!1)}};return(0,i.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100",children:(0,i.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC77"})}),(0,i.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Registrazione Sopralluoghista"}),(0,i.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Crea il tuo account per accedere al portale verifiche"})]}),(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:x,children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700",children:"Nome *"}),(0,i.jsx)("input",{id:"nome",name:"nome",type:"text",required:!0,value:r.nome,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Nome"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"cognome",className:"block text-sm font-medium text-gray-700",children:"Cognome *"}),(0,i.jsx)("input",{id:"cognome",name:"cognome",type:"text",required:!0,value:r.cognome,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Cognome"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username *"}),(0,i.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:r.username,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Username per il login"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email *"}),(0,i.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:r.email,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"email@esempio.com"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"telefono",className:"block text-sm font-medium text-gray-700",children:"Telefono"}),(0,i.jsx)("input",{id:"telefono",name:"telefono",type:"tel",value:r.telefono,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"+39 123 456 7890"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password *"}),(0,i.jsx)("input",{id:"password",name:"password",type:"password",required:!0,value:r.password,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Minimo 6 caratteri"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Conferma Password *"}),(0,i.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:r.confirmPassword,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Ripeti la password"})]})]}),l&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,i.jsxs)("div",{className:"text-red-600 text-sm",children:["⚠️ ",l]})}),(0,i.jsxs)("div",{className:"flex space-x-4",children:[(0,i.jsx)("button",{type:"button",onClick:t,className:"flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"← Torna al Login"}),(0,i.jsx)("button",{type:"submit",disabled:c,className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Registrazione..."]}):"✨ Registrati"})]}),(0,i.jsx)("div",{className:"bg-blue-50 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("span",{className:"text-blue-400",children:"ℹ️"})}),(0,i.jsxs)("div",{className:"ml-3",children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Processo di Approvazione"}),(0,i.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,i.jsx)("p",{children:"Dopo la registrazione, il tuo account sar\xe0 in attesa di approvazione da parte dell'amministratore. Riceverai una notifica via email quando potrai accedere al sistema."})})]})]})})]})]})}function c(){let[e,t]=(0,s.useState)({username:"",password:""}),[a,r]=(0,s.useState)(""),[n,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)(!1),{login:h}=l(),g=async t=>{t.preventDefault(),c(!0),r("");try{await h(e.username,e.password)||r("Credenziali non valide. Controlla username e password.")}catch(e){r("Errore durante il login")}finally{c(!1)}},p=e=>{t(t=>({...t,[e.target.name]:e.target.value})),r("")};return d?(0,i.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,i.jsx)(o,{onBack:()=>m(!1),onSuccess:()=>{u(!0),m(!1)}})}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100",children:(0,i.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFE2"})}),(0,i.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Verifiche Condominiali"}),(0,i.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Accedi al sistema di gestione verifiche"})]}),(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:g,children:[(0,i.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),(0,i.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:e.username,onChange:p,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Username"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,i.jsx)("input",{id:"password",name:"password",type:"password",required:!0,value:e.password,onChange:p,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),x&&(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:(0,i.jsx)("div",{className:"text-green-600 text-sm",children:"✅ Registrazione completata! Il tuo account \xe8 in attesa di approvazione."})}),a&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,i.jsxs)("div",{className:"text-red-600 text-sm",children:["⚠️ ",a]})}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",disabled:n,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Accesso..."]}):(0,i.jsx)(i.Fragment,{children:" Accedi"})})}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("button",{type:"button",onClick:()=>m(!d),className:"text-sm text-blue-600 hover:text-blue-500",children:d?"Torna al login":"Non hai un account? Registrati"})}),(0,i.jsxs)("div",{className:"bg-gray-50 rounded-md p-4",children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Credenziali Test:"}),(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,i.jsxs)("p",{children:["� ",(0,i.jsx)("strong",{children:"Admin:"})," ",(0,i.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"admin"})," / ",(0,i.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"admin123"})]}),(0,i.jsx)("p",{className:"text-gray-500 mt-1",children:"Gli altri account devono essere registrati"})]})]})]})]})})}let d="/api";class m{static async getAll(){try{let e=await fetch("".concat(d,"/condomini"));return await e.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async getById(e){try{let t=await fetch("".concat(d,"/condomini/").concat(e));return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async create(e){try{let t=await fetch("".concat(d,"/condomini"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async update(e,t){try{let a=await fetch("".concat(d,"/condomini/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async delete(e){try{let t=await fetch("".concat(d,"/condomini/").concat(e),{method:"DELETE"});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static validateCondominio(e){let t=[];return e.nome&&""!==e.nome.trim()||t.push("Il nome del condominio \xe8 obbligatorio"),e.nome&&e.nome.length<2&&t.push("Il nome deve essere di almeno 2 caratteri"),e.nome&&e.nome.length>100&&t.push("Il nome non pu\xf2 superare i 100 caratteri"),t}}function x(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),l=async()=>{i(!0),n(null);let e=await m.getAll();e.success&&e.data?t(e.data):n(e.error||"Errore nel caricamento dei condomini"),i(!1)},o=async e=>{let a=m.validateCondominio(e);if(a.length>0)return n(a.join(", ")),!1;let i=await m.create(e);return i.success&&i.data?(t(e=>[...e,i.data]),n(null),!0):(n(i.error||"Errore nella creazione del condominio"),!1)},c=async(e,a)=>{let i=m.validateCondominio(a);if(i.length>0)return n(i.join(", ")),!1;let s=await m.update(e,a);return s.success&&s.data?(t(t=>t.map(t=>t.id===e?s.data:t)),n(null),!0):(n(s.error||"Errore nell'aggiornamento del condominio"),!1)},d=async e=>{let a=await m.delete(e);return a.success?(t(t=>t.filter(t=>t.id!==e)),n(null),!0):(n(a.error||"Errore nell'eliminazione del condominio"),!1)};return(0,s.useEffect)(()=>{l()},[]),{condomini:e,loading:a,error:r,loadCondomini:l,createCondominio:o,updateCondominio:c,deleteCondominio:d,getCondominio:t=>e.find(e=>e.id===t||e.token===t),clearError:()=>n(null)}}function u(e){let{onSubmit:t,onCancel:a,loading:r=!1,initialData:n,isEdit:l=!1}=e,[o,c]=(0,s.useState)({nome:(null==n?void 0:n.nome)||""}),[d,m]=(0,s.useState)([]),x=async e=>{e.preventDefault(),m([]);let a=[];if(o.nome.trim()?o.nome.length<2?a.push("Il nome deve essere di almeno 2 caratteri"):o.nome.length>100&&a.push("Il nome non pu\xf2 superare i 100 caratteri"):a.push("Il nome del condominio \xe8 obbligatorio"),a.length>0){m(a);return}await t(o)&&!l&&c({nome:""})};return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:l?"Modifica Condominio":"Nuovo Condominio"}),a&&(0,i.jsx)("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]}),d.length>0&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,i.jsx)("div",{className:"text-red-600 text-sm",children:d.map((e,t)=>(0,i.jsxs)("div",{children:["• ",e]},t))})}),(0,i.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Condominio *"}),(0,i.jsx)("input",{type:"text",id:"nome",name:"nome",value:o.nome,onChange:e=>{let{name:t,value:a}=e.target;c(e=>({...e,[t]:a})),d.length>0&&m([])},placeholder:"Es: Condominio Via Roma 123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:r,maxLength:100}),(0,i.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[o.nome.length,"/100 caratteri"]})]}),(0,i.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,i.jsx)("button",{type:"submit",disabled:r||!o.nome.trim(),className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:r?(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),l?"Aggiornamento...":"Creazione..."]}):l?"Aggiorna Condominio":"Crea Condominio"}),a&&(0,i.jsx)("button",{type:"button",onClick:a,disabled:r,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"})]})]})]})}var h=a(166);let g=(0,h.default)(()=>a.e(83).then(a.bind(a,1083)),{loadableGenerated:{webpack:()=>[1083]},ssr:!1});function p(e){let{condomini:t,loading:a=!1,onEdit:r,onDelete:n,onView:l}=e,[o,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(null),[x,u]=(0,s.useState)(null),h=async e=>{c(e);let t=await n(e);c(null),t&&m(null)},p=e=>new Date(e).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),b=async e=>{try{await navigator.clipboard.writeText(e)}catch(e){console.error("Errore nel copiare il token:",e)}};return a?(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento condomini..."})]})}):0===t.length?(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83C\uDFE2"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun condominio trovato"}),(0,i.jsx)("p",{className:"text-gray-500",children:"Inizia creando il tuo primo condominio"})]})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,i.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Condomini (",t.length,")"]})}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome Condominio"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Creazione"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ultima Modifica"}),(0,i.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Azioni"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-blue-600 font-medium text-sm",children:e.nome.charAt(0).toUpperCase()})}),(0,i.jsxs)("div",{className:"ml-4",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.nome}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]})]})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p(e.data_inserimento)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p(e.data_ultima_modifica)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[e.qr_code&&(0,i.jsx)("button",{onClick:()=>u(e),className:"text-purple-600 hover:text-purple-900 transition-colors",title:"Mostra QR Code",children:"\uD83D\uDCF7"}),l&&(0,i.jsx)("button",{onClick:()=>l(e),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Visualizza dettagli",children:"\uD83D\uDC41️"}),(0,i.jsx)("button",{onClick:()=>b(e.token),className:"text-green-600 hover:text-green-900 transition-colors",title:"Copia Token",children:"\uD83D\uDD11"}),(0,i.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"Modifica",children:"✏️"}),(0,i.jsx)("button",{onClick:()=>m(e.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Elimina",children:"\uD83D\uDDD1️"})]})})]},e.id))})]})})]}),d&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Conferma eliminazione"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Sei sicuro di voler eliminare questo condominio? Questa azione non pu\xf2 essere annullata."}),(0,i.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,i.jsx)("button",{onClick:()=>m(null),disabled:o===d,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"}),(0,i.jsx)("button",{onClick:()=>h(d),disabled:o===d,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors disabled:bg-red-300 disabled:cursor-not-allowed",children:o===d?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Eliminazione..."]}):"Elimina"})]})]})}),x&&x.qr_code&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>u(null),children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"QR Code Condominio"}),(0,i.jsx)("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-gray-600 text-2xl leading-none",children:"\xd7"})]}),(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:(0,i.jsx)("strong",{children:x.nome})}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:x.indirizzo||"Indirizzo non specificato"}),(0,i.jsx)(g,{value:x.qr_code,size:250,level:"M",label:x.nome}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-4 font-mono",children:x.qr_code})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 bg-blue-50 border border-blue-200 rounded p-3",children:["\uD83D\uDCA1 ",(0,i.jsx)("strong",{children:"Come usare:"})," Stampa o scarica questo QR code. Durante la creazione di una verifica, usa il pulsante “\uD83D\uDCF7 Scansiona QR Code” per selezionare rapidamente questo condominio."]})]})})]})}let b=()=>{console.log("\uD83D\uDCCA Triggering dashboard stats refresh..."),window.dispatchEvent(new CustomEvent("refreshStats"))},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;setTimeout(()=>{b()},e)};function j(){let{condomini:e,loading:t,error:a,createCondominio:r,updateCondominio:n,deleteCondominio:l,clearError:o}=x(),[c,d]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),[g,b]=(0,s.useState)(!1),[j,f]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(j){let e=setTimeout(()=>f(null),5e3);return()=>clearTimeout(e)}},[j]),(0,s.useEffect)(()=>{if(a){let e=setTimeout(()=>o(),8e3);return()=>clearTimeout(e)}},[a,o]);let y=async e=>{b(!0);let t=await r(e);return b(!1),t&&(d(!1),f("Condominio creato con successo!")),t},N=async e=>{if(!m)return!1;b(!0);let t=await n(m.id,e);return b(!1),t&&(h(null),f("Condominio aggiornato con successo!")),t},w=async e=>{let t=await l(e);return t&&(f("Condominio eliminato con successo!"),v(1e3)),t},D={totale:e.length,recenti:e.filter(e=>{let t=new Date(e.data_inserimento),a=new Date;return a.setDate(a.getDate()-7),t>=a}).length};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Gestione Condomini"}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestisci l'anagrafica dei condomini e i relativi token di accesso"})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("div",{className:"bg-blue-50 px-4 py-3 rounded-lg text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:D.totale}),(0,i.jsx)("div",{className:"text-sm text-blue-800",children:"Totale"})]}),(0,i.jsxs)("div",{className:"bg-green-50 px-4 py-3 rounded-lg text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:D.recenti}),(0,i.jsx)("div",{className:"text-sm text-green-800",children:"Ultimi 7gg"})]})]})]}),a&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-red-400 mr-3",children:"❌"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-red-800 font-medium",children:"Errore"}),(0,i.jsx)("p",{className:"text-red-700 text-sm mt-1",children:a})]}),(0,i.jsx)("button",{onClick:o,className:"ml-auto text-red-400 hover:text-red-600",children:"✕"})]})}),j&&(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-green-400 mr-3",children:"✅"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-green-800 font-medium",children:"Successo"}),(0,i.jsx)("p",{className:"text-green-700 text-sm mt-1",children:j})]}),(0,i.jsx)("button",{onClick:()=>f(null),className:"ml-auto text-green-400 hover:text-green-600",children:"✕"})]})}),(0,i.jsx)("div",{className:"flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsxs)("button",{onClick:()=>{d(!0),h(null)},className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"➕"}),"Nuovo Condominio"]}),(0,i.jsxs)("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]})]})}),c&&(0,i.jsx)(u,{onSubmit:y,onCancel:()=>d(!1),loading:g}),m&&(0,i.jsx)(u,{onSubmit:N,onCancel:()=>{h(null)},loading:g,initialData:{nome:m.nome},isEdit:!0}),(0,i.jsx)(p,{condomini:e,loading:t,onEdit:e=>{h(e),d(!1)},onDelete:w})]})}class f{static async getAll(){try{let e=await fetch(this.API_BASE);return await e.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async getById(e){try{let t=await fetch("".concat(this.API_BASE,"/").concat(e));return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async create(e){try{let t=await fetch(this.API_BASE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async update(e,t){try{let a=await fetch("".concat(this.API_BASE,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static async delete(e){try{let t=await fetch("".concat(this.API_BASE,"/").concat(e),{method:"DELETE"});return await t.json()}catch(e){return{success:!1,error:"Errore di connessione"}}}static validate(e){let t=[];return e.nome&&""!==e.nome.trim()||t.push("Il nome della tipologia \xe8 obbligatorio"),e.nome&&e.nome.length<2&&t.push("Il nome deve essere di almeno 2 caratteri"),t}}function y(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),l=async()=>{i(!0),n(null);let e=await f.getAll();e.success&&e.data?t(e.data):n(e.error||"Errore nel caricamento delle tipologie"),i(!1)},o=async e=>{let a=f.validate(e);if(a.length>0)return n(a.join(", ")),!1;let i=await f.create(e);return i.success&&i.data?(t(e=>[...e,i.data]),n(null),!0):(n(i.error||"Errore nella creazione della tipologia"),!1)},c=async(e,a)=>{let i=f.validate(a);if(i.length>0)return n(i.join(", ")),!1;let s=await f.update(e,a);return s.success&&s.data?(t(t=>t.map(t=>t.id===e?s.data:t)),n(null),!0):(n(s.error||"Errore nell'aggiornamento della tipologia"),!1)},d=async e=>{let a=await f.delete(e);return a.success?(t(t=>t.filter(t=>t.id!==e)),n(null),!0):(n(a.error||"Errore nell'eliminazione della tipologia"),!1)};return(0,s.useEffect)(()=>{l()},[]),{tipologie:e,loading:a,error:r,loadTipologie:l,createTipologia:o,updateTipologia:c,deleteTipologia:d,getTipologia:t=>e.find(e=>e.id===t),getTipologieAttive:()=>e.filter(e=>e.attiva),clearError:()=>n(null)}}function N(e){let{onSubmit:t,onCancel:a,loading:r=!1,initialData:n,isEdit:l=!1}=e,[o,c]=(0,s.useState)({nome:(null==n?void 0:n.nome)||"",descrizione:(null==n?void 0:n.descrizione)||"",campi_richiesti:(null==n?void 0:n.campi_richiesti)||[]}),[d,m]=(0,s.useState)([]),x=[{value:"testo",label:"Testo"},{value:"numero",label:"Numero"},{value:"data",label:"Data"},{value:"checkbox",label:"Checkbox"},{value:"select",label:"Lista selezione"},{value:"textarea",label:"Testo lungo"},{value:"foto",label:"\uD83D\uDCF7 Caricamento Foto"}],u=async e=>{e.preventDefault(),m([]);let a=[];if(o.nome.trim()||a.push("Il nome della tipologia \xe8 obbligatorio"),a.length>0){m(a);return}await t(o)&&!l&&c({nome:"",descrizione:"",campi_richiesti:[]})},h=e=>{let{name:t,value:a}=e.target;c(e=>({...e,[t]:a})),d.length>0&&m([])},g=e=>{c(t=>({...t,campi_richiesti:t.campi_richiesti.filter((t,a)=>a!==e)}))},p=(e,t)=>{c(a=>({...a,campi_richiesti:a.campi_richiesti.map((a,i)=>i===e?{...a,...t}:a)}))};return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:l?"Modifica Tipologia":"Nuova Tipologia"}),a&&(0,i.jsx)("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]}),d.length>0&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,i.jsx)("div",{className:"text-red-600 text-sm",children:d.map((e,t)=>(0,i.jsxs)("div",{children:["• ",e]},t))})}),(0,i.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Tipologia *"}),(0,i.jsx)("input",{type:"text",name:"nome",value:o.nome,onChange:h,placeholder:"Es: Verifica Antincendio",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrizione"}),(0,i.jsx)("textarea",{name:"descrizione",value:o.descrizione,onChange:h,placeholder:"Descrivi brevemente questa tipologia di verifica...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h4",{className:"text-md font-medium text-gray-800",children:"Campi Personalizzati"}),(0,i.jsx)("button",{type:"button",onClick:()=>{let e={nome:"",tipo:"testo",obbligatorio:!1};c(t=>({...t,campi_richiesti:[...t.campi_richiesti,e]}))},disabled:r,className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors",children:"+ Aggiungi Campo"})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[o.campi_richiesti.map((e,t)=>{var a;return(0,i.jsxs)("div",{className:"border border-gray-200 p-4 rounded-md",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,i.jsxs)("h5",{className:"font-medium text-gray-700",children:["Campo #",t+1]}),(0,i.jsx)("button",{type:"button",onClick:()=>g(t),className:"text-red-500 hover:text-red-700",children:"\uD83D\uDDD1️"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Nome Campo"}),(0,i.jsx)("input",{type:"text",value:e.nome,onChange:e=>p(t,{nome:e.target.value}),placeholder:"Es: Numero estintori",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Tipo"}),(0,i.jsx)("select",{value:e.tipo,onChange:e=>p(t,{tipo:e.target.value}),title:"Tipo di campo",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm",children:x.map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Placeholder"}),(0,i.jsx)("input",{type:"text",value:e.placeholder||"",onChange:e=>p(t,{placeholder:e.target.value}),placeholder:"Testo di aiuto...",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",checked:e.obbligatorio,onChange:e=>p(t,{obbligatorio:e.target.checked}),className:"mr-2"}),(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"Campo obbligatorio"})]})}),"select"===e.tipo&&(0,i.jsxs)("div",{className:"md:col-span-2",children:[(0,i.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Opzioni (una per riga)"}),(0,i.jsx)("textarea",{value:(null===(a=e.opzioni)||void 0===a?void 0:a.join("\n"))||"",onChange:e=>p(t,{opzioni:e.target.value.split("\n").filter(e=>""!==e.trim())}),placeholder:"Opzione 1\\nOpzione 2\\nOpzione 3",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"})]}),"foto"===e.tipo&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Massimo foto consentite"}),(0,i.jsx)("input",{type:"number",min:"1",max:"10",value:e.maxFoto||5,onChange:e=>p(t,{maxFoto:parseInt(e.target.value)||5}),placeholder:"5",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Numero massimo di foto che gli utenti possono caricare (1-10)"})]})]})]},t)}),0===o.campi_richiesti.length&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,i.jsx)("p",{children:"Nessun campo personalizzato configurato"}),(0,i.jsxs)("p",{className:"text-sm",children:["                ",(0,i.jsx)("p",{children:'Clicca su "Aggiungi Campo" per iniziare'})]})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,i.jsx)("button",{type:"submit",disabled:r||!o.nome.trim(),className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:r?(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),l?"Aggiornamento...":"Creazione..."]}):l?"Aggiorna Tipologia":"Crea Tipologia"}),a&&(0,i.jsx)("button",{type:"button",onClick:a,disabled:r,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"})]})]})]})}function w(e){let{tipologie:t,loading:a=!1,onEdit:r,onDelete:n,onToggleActive:l}=e,[o,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(null),x=async e=>{c(e);let t=await n(e);c(null),t&&m(null)},u=e=>new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"});return a?(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento tipologie..."})]})}):0===t.length?(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\uD83D\uDCCB"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna tipologia trovata"}),(0,i.jsx)("p",{className:"text-gray-500",children:"Inizia creando la tua prima tipologia di verifica"})]})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,i.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:["Tipologie Verifiche (",t.length,")"]})}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipologia"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campi Configurati"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stato"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Creazione"}),(0,i.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Azioni"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{var t,a;return(0,i.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"px-6 py-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-purple-600 font-medium",children:e.nome.charAt(0).toUpperCase()})}),(0,i.jsxs)("div",{className:"ml-4",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.nome}),(0,i.jsx)("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:e.descrizione||"Nessuna descrizione"})]})]})}),(0,i.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,i.jsx)("div",{className:"flex items-center gap-2",children:(null===(t=e.campi_richiesti)||void 0===t?void 0:t.length)||0}),(null===(a=e.campi_richiesti)||void 0===a?void 0:a.some(e=>e.obbligatorio))&&(0,i.jsx)("span",{className:"text-red-500 text-xs",children:"*"})]}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.attiva?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.attiva?"✓ Attiva":"○ Disattiva"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(e.data_creazione)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[l&&(0,i.jsx)("button",{onClick:()=>l(e.id,!e.attiva),className:"text-sm px-2 py-1 rounded transition-colors ".concat(e.attiva?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"),title:e.attiva?"Disattiva":"Attiva",children:e.attiva?"⏸️":"▶️"}),(0,i.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"Modifica",children:"✏️"}),(0,i.jsx)("button",{onClick:()=>m(e.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Elimina",children:"\uD83D\uDDD1️"})]})})]},e.id)})})]})})]}),d&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Conferma eliminazione"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Sei sicuro di voler eliminare questa tipologia? Questa azione non pu\xf2 essere annullata."}),(0,i.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,i.jsx)("button",{onClick:()=>m(null),disabled:o===d,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Annulla"}),(0,i.jsx)("button",{onClick:()=>x(d),disabled:o===d,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors disabled:bg-red-300 disabled:cursor-not-allowed",children:o===d?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Eliminazione..."]}):"Elimina"})]})]})})]})}function D(){let{tipologie:e,loading:t,error:a,createTipologia:r,updateTipologia:n,deleteTipologia:l,clearError:o}=y(),[c,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),[u,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(g){let e=setTimeout(()=>p(null),5e3);return()=>clearTimeout(e)}},[g]),(0,s.useEffect)(()=>{if(a){let e=setTimeout(()=>o(),8e3);return()=>clearTimeout(e)}},[a,o]);let b=async e=>{h(!0);let t=await r(e);return h(!1),t&&(d(!1),p("Tipologia creata con successo!")),t},v=async e=>{if(!m)return!1;let t={...e,attiva:m.attiva};h(!0);let a=await n(m.id,t);return h(!1),a&&(x(null),p("Tipologia aggiornata con successo!")),a},j=async e=>{let t=await l(e);return t&&p("Tipologia eliminata con successo!"),t},f=async(t,a)=>{let i=e.find(e=>e.id===t);if(!i)return!1;let s={nome:i.nome,descrizione:i.descrizione,campi_richiesti:i.campi_richiesti||[],attiva:a},r=await n(t,s);return r&&p("Tipologia ".concat(a?"attivata":"disattivata"," con successo!")),r},D={totale:e.length,attive:e.filter(e=>e.attiva).length,conCampi:e.filter(e=>{var t;return(null===(t=e.campi_richiesti)||void 0===t?void 0:t.length)>0}).length};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Tipologie Verifiche"}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Configura le diverse tipologie di verifiche e i relativi campi personalizzati"})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("div",{className:"bg-purple-50 px-4 py-3 rounded-lg text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:D.totale}),(0,i.jsx)("div",{className:"text-sm text-purple-800",children:"Totale"})]}),(0,i.jsxs)("div",{className:"bg-green-50 px-4 py-3 rounded-lg text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:D.attive}),(0,i.jsx)("div",{className:"text-sm text-green-800",children:"Attive"})]}),(0,i.jsxs)("div",{className:"bg-blue-50 px-4 py-3 rounded-lg text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:D.conCampi}),(0,i.jsx)("div",{className:"text-sm text-blue-800",children:"Con Campi"})]})]})]}),a&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-red-400 mr-3",children:"❌"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-red-800 font-medium",children:"Errore"}),(0,i.jsx)("p",{className:"text-red-700 text-sm mt-1",children:a})]}),(0,i.jsx)("button",{onClick:o,className:"ml-auto text-red-400 hover:text-red-600",children:"✕"})]})}),g&&(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-green-400 mr-3",children:"✅"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-green-800 font-medium",children:"Successo"}),(0,i.jsx)("p",{className:"text-green-700 text-sm mt-1",children:g})]}),(0,i.jsx)("button",{onClick:()=>p(null),className:"ml-auto text-green-400 hover:text-green-600",children:"✕"})]})}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsxs)("button",{onClick:()=>{d(!0),x(null)},className:"bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"➕"}),"Nuova Tipologia"]}),(0,i.jsxs)("button",{onClick:()=>window.location.reload(),className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]})]}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"\uD83D\uDCA1 Le tipologie disattive non appariranno nel wizard verifiche"})]}),c&&(0,i.jsx)(N,{onSubmit:b,onCancel:()=>d(!1),loading:u}),m&&(0,i.jsx)(N,{onSubmit:v,onCancel:()=>{x(null)},loading:u,initialData:{nome:m.nome,descrizione:m.descrizione,campi_richiesti:m.campi_richiesti||[],attiva:m.attiva},isEdit:!0}),(0,i.jsx)(w,{tipologie:e,loading:t,onEdit:e=>{x(e),d(!1)},onDelete:j,onToggleActive:f})]})}f.API_BASE="/api/tipologie";var C=a(3145);async function z(){try{if(!navigator.geolocation)return console.warn("Geolocation API non supportata"),null;return new Promise(e=>{navigator.geolocation.getCurrentPosition(t=>{let a={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:t.timestamp};console.log("\uD83D\uDCCD Posizione GPS catturata:",a),e(a)},t=>{console.warn("❌ Errore geolocalizzazione:",t.message),e(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})}catch(e){return console.error("Errore durante richiesta GPS:",e),null}}function S(e){let{value:t=[],onChange:a,lavorazioneId:r,maxFoto:n=5,required:l=!1,nome:o="Foto"}=e,[c,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),u=(0,s.useRef)(null),h=async e=>{let i=Array.from(e.target.files||[]);if(0!==i.length){if(t.length+i.length>n){x("Puoi caricare massimo ".concat(n," foto"));return}if(i.filter(e=>!e.type.startsWith("image/")).length>0){x("Sono ammessi solo file immagine");return}if(i.filter(e=>e.size>10485760).length>0){x("Le foto devono essere inferiori a 10 MB");return}x(null),d(!0);try{console.log("\uD83D\uDCCD Richiedendo posizione GPS...");let e=await z();e?console.log("✅ GPS catturato:",e):console.warn("⚠️ GPS non disponibile, foto senza geolocalizzazione");let s=i.map(e=>new Promise((t,a)=>{let i=new FileReader;i.onload=()=>{let e=i.result;g(e,1920).then(t).catch(a)},i.onerror=a,i.readAsDataURL(e)})),n=await Promise.all(s);console.log("\uD83D\uDCE4 Uploading foto to Vercel Blob...",{lavorazioneId:r,count:n.length,hasGeo:!!e});let l=await fetch("/api/upload-foto-vercel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({foto:n,lavorazioneId:r,geo:e})});if(!l.ok)throw Error("Errore durante upload foto");let o=await l.json();if(o.success){console.log("✅ Foto uploaded successfully to Vercel Blob:",o.foto);let e=o.foto.map(e=>e.url);a([...t,...e]),o.errori&&o.errori.length>0&&x("".concat(o.errori.length," foto non caricate correttamente"))}else throw Error(o.error||"Errore upload")}catch(e){console.error("❌ Errore upload foto:",e),x(e instanceof Error?e.message:"Errore durante upload")}finally{d(!1),u.current&&(u.current.value="")}}},g=(e,t)=>new Promise(a=>{let i=document.createElement("img");i.onload=()=>{let e=document.createElement("canvas"),s=i.width,r=i.height;s>t&&(r=r*t/s,s=t),e.width=s,e.height=r;let n=e.getContext("2d");null==n||n.drawImage(i,0,0,s,r),a(e.toDataURL("image/jpeg",.9))},i.src=e}),p=e=>{a(t.filter((t,a)=>a!==e))};return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[o," ",l&&(0,i.jsx)("span",{className:"text-red-500",children:"*"}),(0,i.jsxs)("span",{className:"text-gray-500 ml-2",children:["(",t.length,"/",n,")"]})]}),t.length<n&&(0,i.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.click()},disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:c?"⏳ Caricamento...":"\uD83D\uDCF7 Aggiungi Foto"})]}),(0,i.jsx)("input",{ref:u,type:"file",accept:"image/*",multiple:!0,onChange:h,className:"hidden","aria-label":"Seleziona foto da caricare"}),m&&(0,i.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:m}),t.length>0&&(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((e,t)=>(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsxs)("div",{className:"aspect-square relative rounded-lg overflow-hidden border-2 border-gray-200",children:[(0,i.jsx)(C.default,{src:e,alt:"Foto ".concat(t+1),fill:!0,className:"object-cover"}),(0,i.jsxs)("div",{className:"absolute top-2 right-2 bg-blue-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1",children:[(0,i.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,i.jsx)("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),"Vercel"]})]}),(0,i.jsx)("button",{type:"button",onClick:()=>p(t),title:"Rimuovi foto","aria-label":"Rimuovi foto",className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600",children:(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),0===t.length&&!c&&(0,i.jsxs)("div",{onClick:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[(0,i.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,i.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Clicca per caricare foto"}),(0,i.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Massimo ",n," foto, fino a 10 MB ciascuna"]})]})]})}function E(e){let{value:t,onChange:a,placeholder:r="Scrivi o parla...",className:n=""}=e,[l,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null);return(0,s.useEffect)(()=>{{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e){d(!0);let i=new e;i.continuous=!0,i.interimResults=!0,i.lang="it-IT",i.maxAlternatives=1,i.onresult=e=>{let i="";for(let t=e.resultIndex;t<e.results.length;t++){let a=e.results[t];a.isFinal&&(i+=a[0].transcript+" ")}i&&a(t?"".concat(t," ").concat(i).trim():i.trim())},i.onerror=e=>{console.error("Speech recognition error:",e.error),o(!1),"not-allowed"===e.error?alert("⚠️ Permesso microfono negato. Abilita il microfono nelle impostazioni del browser."):"no-speech"===e.error&&console.log("No speech detected, continue listening...")},i.onend=()=>{if(l)try{i.start()}catch(e){console.log("Recognition already started")}else o(!1)},x(i)}else console.warn("Web Speech API not supported")}return()=>{if(m)try{m.stop()}catch(e){}}},[]),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("textarea",{value:t,onChange:e=>a(e.target.value),placeholder:r,className:"".concat(n," ").concat(c?"pr-14":""),rows:4}),c&&(0,i.jsx)("button",{type:"button",onClick:()=>{if(m){if(l)m.stop(),o(!1);else try{m.start(),o(!0)}catch(e){console.error("Error starting recognition:",e)}}},className:"absolute right-3 top-3 p-2 rounded-full transition-all ".concat(l?"bg-red-500 text-white animate-pulse shadow-lg":"bg-gray-200 hover:bg-gray-300 text-gray-700"),title:l?"Ferma registrazione":"Inizia registrazione vocale",children:l?(0,i.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,i.jsx)("path",{d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z"})}):(0,i.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})})}),!c&&(0,i.jsx)("div",{className:"absolute right-3 top-3 text-gray-400 text-sm",children:"⚠️ Voice input not supported"})]})}let k=(0,h.default)(()=>Promise.all([a.e(52),a.e(791),a.e(621)]).then(a.bind(a,1621)),{loadableGenerated:{webpack:()=>[1621]},ssr:!1});function _(e){var t;let{selectedCondominio:a,selectedTipologia:r,onCondominioChange:n,onTipologiaChange:l,onNext:o,canProceed:c}=e,{condomini:d,loading:m}=x(),{tipologie:u,loading:h}=y(),[g,p]=(0,s.useState)(!1),b=u.filter(e=>e.attiva);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Step 1: Selezione Condominio e Tipologia"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Seleziona il condominio da verificare e il tipo di verifica da eseguire"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Seleziona Condominio *"}),m?(0,i.jsx)("div",{className:"animate-pulse",children:(0,i.jsx)("div",{className:"h-12 bg-gray-200 rounded-md"})}):d.length>0?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("button",{type:"button",onClick:()=>p(!0),className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 font-medium",children:[(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"\uD83D\uDCF7 Scansiona QR Code"]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,i.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,i.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,i.jsx)("span",{className:"px-2 bg-gray-50 text-gray-500",children:"oppure"})})]}),(0,i.jsxs)("select",{value:(null==a?void 0:a.id)||"",onChange:e=>{let t=d.find(t=>t.id===e.target.value);t&&n(t)},title:"Seleziona un condominio",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 appearance-none cursor-pointer",children:[(0,i.jsx)("option",{value:"",disabled:!0,children:"\uD83C\uDFE2 Seleziona manualmente..."}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.nome},e.id))]}),a&&(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:(0,i.jsx)("span",{className:"text-blue-600 font-bold text-lg",children:a.nome.charAt(0).toUpperCase()})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h4",{className:"font-semibold text-blue-900",children:a.nome}),(0,i.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:["Aggiunto il ",new Date(a.data_inserimento).toLocaleDateString("it-IT")]})]}),(0,i.jsx)("div",{className:"text-blue-500 text-2xl",children:"✓"})]})})]}):null,!m&&0===d.length&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFE2"}),(0,i.jsx)("p",{children:"Nessun condominio disponibile"}),(0,i.jsx)("p",{className:"text-sm",children:"Aggiungi prima un condominio nella sezione apposita"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Seleziona Tipologia Verifica *"}),h?(0,i.jsx)("div",{className:"animate-pulse",children:(0,i.jsx)("div",{className:"h-10 bg-gray-200 rounded-md"})}):(0,i.jsx)("div",{className:"grid grid-cols-1 gap-3",children:b.map(e=>{var t;return(0,i.jsx)("button",{onClick:()=>l(e),className:"p-4 border-2 rounded-lg text-left transition-all ".concat((null==r?void 0:r.id)===e.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300"),children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex items-start",children:[(0,i.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3 mt-1",children:(0,i.jsx)("span",{className:"text-green-600 font-medium",children:e.nome.charAt(0).toUpperCase()})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e.nome}),(0,i.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.descrizione}),(0,i.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:[(null===(t=e.campi_richiesti)||void 0===t?void 0:t.length)||0," campi configurati"]})]})]}),(null==r?void 0:r.id)===e.id&&(0,i.jsx)("div",{className:"text-green-500 text-xl",children:"✓"})]})},e.id)})}),!h&&0===b.length&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,i.jsx)("p",{children:"Nessuna tipologia di verifica attiva"}),(0,i.jsx)("p",{className:"text-sm",children:"Configura prima le tipologie nella sezione apposita"})]})]}),a&&r&&(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Riepilogo Selezioni:"}),(0,i.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Condominio:"})," ",a.nome]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Tipologia:"})," ",r.nome]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Campi da compilare:"})," ",(null===(t=r.campi_richiesti)||void 0===t?void 0:t.length)||0]})]})]}),(0,i.jsx)("div",{className:"flex justify-end pt-4",children:(0,i.jsxs)("button",{onClick:o,disabled:!c,className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:["Continua",(0,i.jsx)("span",{children:"→"})]})}),g&&(0,i.jsx)(k,{onScan:e=>{console.log("\uD83D\uDCF7 QR Code scansionato:",e);let t=d.find(t=>t.qr_code===e);t?(n(t),p(!1)):alert("Condominio non trovato. Verifica il QR code.")},onError:e=>{console.error("Errore scanner:",e),alert("Errore scanner: ".concat(e))},onClose:()=>p(!1)})]})}function A(e){let{tipologia:t,datiVerifica:a,onDatiChange:r,onNext:n,onPrevious:l,canProceed:o,lavorazioneId:c}=e,[d,m]=(0,s.useState)({}),x=(e,t)=>{if(r({...a,[e.nome]:t}),d[e.nome]){let t={...d};delete t[e.nome],m(t)}},u=()=>{let e={};return t.campi_richiesti.forEach(t=>{if(t.obbligatorio){let i=a[t.nome];"foto"===t.tipo?i&&Array.isArray(i)&&0!==i.length||(e[t.nome]="Almeno una foto \xe8 richiesta"):i&&("string"!=typeof i||""!==i.trim())||(e[t.nome]="Questo campo \xe8 obbligatorio")}}),m(e),0===Object.keys(e).length},h=e=>{let t=a[e.nome]||"",s=d[e.nome];switch(e.tipo){case"testo":return(0,i.jsx)("input",{type:"text",value:t,onChange:t=>x(e,t.target.value),placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(s?"border-red-500":"border-gray-300")});case"numero":return(0,i.jsx)("input",{type:"number",value:t,onChange:t=>x(e,parseFloat(t.target.value)||""),placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(s?"border-red-500":"border-gray-300")});case"data":return(0,i.jsx)("input",{type:"date",value:t,onChange:t=>x(e,t.target.value),title:e.nome,placeholder:e.placeholder,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(s?"border-red-500":"border-gray-300")});case"checkbox":return(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",checked:!0===t,onChange:t=>x(e,t.target.checked),title:e.nome,placeholder:e.placeholder,className:"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,i.jsx)("span",{className:"text-sm text-gray-700",children:e.placeholder||"Seleziona se applicabile"})]});case"select":var r;return(0,i.jsxs)("select",{value:t,onChange:t=>x(e,t.target.value),title:e.nome,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(s?"border-red-500":"border-gray-300"),children:[(0,i.jsx)("option",{value:"",children:"Seleziona..."}),null===(r=e.opzioni)||void 0===r?void 0:r.map((e,t)=>(0,i.jsx)("option",{value:e,children:e},t))]});case"textarea":return(0,i.jsx)("textarea",{value:t,onChange:t=>x(e,t.target.value),placeholder:e.placeholder,rows:4,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(s?"border-red-500":"border-gray-300")});case"foto":return(0,i.jsx)(S,{value:t||[],onChange:t=>x(e,t),lavorazioneId:c||"temp-".concat(Date.now()),maxFoto:e.maxFoto||5,required:e.obbligatorio,nome:e.nome});default:return null}};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Step 2: Compilazione Dati Verifica"}),(0,i.jsxs)("p",{className:"text-gray-600 mb-4",children:["Compila i campi richiesti per la verifica: ",(0,i.jsx)("strong",{children:t.nome})]}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"Campi obbligatori contrassegnati con *"})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(t.campi_richiesti||[]).map(e=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.nome,e.obbligatorio&&(0,i.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),h(e),d[e.nome]&&(0,i.jsx)("div",{className:"text-red-500 text-sm mt-1",children:d[e.nome]})]},e.id)),(!t.campi_richiesti||0===t.campi_richiesti.length)&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,i.jsx)("p",{children:"Nessun campo configurato per questa tipologia"}),(0,i.jsx)("p",{className:"text-sm",children:"Puoi procedere direttamente al passo successivo"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,i.jsxs)("button",{onClick:l,className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"←"}),"Indietro"]}),(0,i.jsxs)("button",{onClick:()=>{u()&&n()},disabled:!o,className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:["Continua",(0,i.jsx)("span",{children:"→"})]})]})]})}function T(e){let{condominio:t,tipologia:a,datiVerifica:s,note:r,onNoteChange:n,onComplete:l,onPrevious:o,loading:c=!1}=e;return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Step 3: Riepilogo e Completamento"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Verifica i dati inseriti e completa la verifica"})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-gray-800 mb-4",children:"Riepilogo Verifica"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"font-medium text-gray-700 mb-2",children:"Informazioni Generali"}),(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Condominio:"})," ",t.nome]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Tipologia:"})," ",a.nome]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Data:"})," ",new Date().toLocaleDateString("it-IT")]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"font-medium text-gray-700 mb-2",children:"Dati Raccolti"}),(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[Object.entries(s).map(e=>{let[t,a]=e;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("strong",{children:[t,":"]})," ","boolean"==typeof a?a?"S\xec":"No":String(a)]},t)}),0===Object.keys(s).length&&(0,i.jsx)("div",{className:"text-gray-500 italic",children:"Nessun dato raccolto"})]})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note Aggiuntive \uD83C\uDFA4"}),(0,i.jsx)(E,{value:r,onChange:n,placeholder:"Scrivi o usa il microfono per dettare note, osservazioni o commenti sulla verifica...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),(0,i.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"\uD83D\uDCA1 Tocca il microfono per dettare le note a voce (funziona hands-free!)"})]}),(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("h5",{className:"font-medium text-blue-800 mb-2",children:"Opzioni di Completamento"}),(0,i.jsxs)("div",{className:"space-y-2 text-sm text-blue-700",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDCE7"}),"Email di notifica sar\xe0 inviata automaticamente"]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDCBE"}),"I dati verranno salvati nel sistema"]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCB"}),"La verifica sar\xe0 disponibile nel pannello amministratore"]})]})]}),(0,i.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,i.jsxs)("button",{onClick:o,disabled:c,className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50 flex items-center gap-2",children:[(0,i.jsx)("span",{children:"←"}),"Indietro"]}),(0,i.jsx)("button",{onClick:l,disabled:c,className:"bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:c?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Completamento..."]}):(0,i.jsx)(i.Fragment,{children:"✓ Completa Verifica"})})]})]})}function P(e){let{lavorazione:t,onLavorazioneComplete:a,onBack:r}=e,n=!!t,[l,o]=(0,s.useState)(n?2:1),[c,d]=(0,s.useState)(null),[m,x]=(0,s.useState)(null),[u,h]=(0,s.useState)({}),[g,p]=(0,s.useState)(""),[b,v]=(0,s.useState)(!1),[j,f]=(0,s.useState)(!1),[y,N]=(0,s.useState)(null),[w]=(0,s.useState)((null==t?void 0:t.id)||"temp-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)));(0,s.useEffect)(()=>{(async()=>{if(t){v(!0);try{if(t.condominio_id){console.log("Caricando lavorazione nuovo schema:",t);let e=await fetch("/api/condomini/".concat(t.condominio_id));if(e.ok){let t=await e.json();t.success&&d(t.data)}if(t.allegati)try{let e=JSON.parse(t.allegati);if(e.tipologia_verifica_id){let t=await fetch("/api/tipologie/".concat(e.tipologia_verifica_id));if(t.ok){let e=await t.json();e.success&&x(e.data)}}}catch(e){console.error("Errore parsing metadata:",e)}t.note&&p("string"==typeof t.note?t.note:Array.isArray(t.note)?t.note.join("\n"):"")}else if(t.verifica){console.log("Caricando lavorazione schema legacy:",t);let e=t.verifica;if(e.condominio_id){let t=await fetch("/api/condomini/".concat(e.condominio_id));if(t.ok){let e=await t.json();e.success&&d(e.data)}}if(e.tipologia_id){let t=await fetch("/api/tipologie/".concat(e.tipologia_id));if(t.ok){let e=await t.json();e.success&&x(e.data)}}e.dati_verifica&&h(e.dati_verifica),e.note&&p(e.note)}}catch(e){console.error("Errore nel caricamento dei dati della lavorazione:",e)}finally{v(!1)}}})()},[t]);let D=async()=>{if(n&&t&&"aperta"===t.stato)try{await fetch("/api/lavorazioni/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"inizia",nota:"Verifica iniziata dal sopralluoghista"})})}catch(e){console.error("Errore nell'iniziare la lavorazione:",e)}o(3)},C=()=>{if(n&&2===l){r&&r();return}o(e=>e-1)},z=async()=>{if(c&&m){v(!0);try{if(n&&t){let e={},i=0;Object.entries(u).forEach(t=>{let[a,s]=t;Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0].includes("blob.vercel-storage.com")&&(e[a]=s,i+=s.length)}),console.log("\uD83D\uDCF8 Completamento lavorazione - Foto per sezione:",e),console.log("\uD83D\uDCF8 Totale foto trovate:",i);let s=await fetch("/api/lavorazioni/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"completa",dati:{dati_verifica:u,foto:e,note:g}})}),r=await s.json();r.success?(f(!0),setTimeout(()=>{a&&a(t.id)},2e3)):N("Errore nel completamento della lavorazione: "+r.error)}else{let e={condominio_id:c.id,tipologia_id:m.id,dati_verifica:u,note:g},t=await fetch("/api/verifiche",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();a.success?(f(!0),setTimeout(()=>{o(n?2:1),d(null),x(null),h({}),p(""),f(!1)},3e3)):N("Errore nel completamento della verifica: "+a.error)}}catch(e){alert("Errore di connessione")}v(!1)}},S=!!(c&&m),E=!m||(m.campi_richiesti||[]).filter(e=>e.obbligatorio).every(e=>u[e.nome]&&""!==u[e.nome]);return j?(0,i.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:n?"Lavorazione Completata!":"Verifica Completata con Successo!"}),(0,i.jsxs)("div",{className:"space-y-2 text-gray-600 mb-6",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Condominio:"})," ",null==c?void 0:c.nome]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Tipologia:"})," ",null==m?void 0:m.nome]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Data:"})," ",new Date().toLocaleDateString("it-IT")]}),n&&t&&(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Lavorazione:"})," #",t.id]})]}),(0,i.jsx)("div",{className:"bg-green-50 p-4 rounded-lg mb-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-center text-green-700",children:[(0,i.jsx)("span",{className:"mr-2",children:n?"✅":"\uD83D\uDCE7"}),n?"Lavorazione aggiornata e notificata all'amministratore":"Email di notifica inviata con successo"]})}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Reindirizzamento automatico in corso..."})]})})}):(0,i.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:n?"Completa Lavorazione":"Wizard Verifiche"}),n&&t&&(0,i.jsxs)("p",{className:"text-gray-600 mb-4",children:[(0,i.jsxs)("strong",{children:["Lavorazione #",t.id,":"]})," ",t.descrizione]}),(0,i.jsx)("div",{className:"flex items-center justify-between mb-6",children:(n?[2,3]:[1,2,3]).map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium ".concat(e<l?"bg-green-500 text-white":e===l?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"),children:e<l?"✓":e}),t<(n?[2,3]:[1,2,3]).length-1&&(0,i.jsx)("div",{className:"w-16 md:w-32 h-1 mx-2 ".concat(e<l?"bg-green-500":"bg-gray-200")})]},e))}),(0,i.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 ".concat(n?"justify-around":""),children:[!n&&(0,i.jsx)("span",{className:1===l?"font-medium text-blue-600":"",children:"Selezione"}),(0,i.jsx)("span",{className:2===l?"font-medium text-blue-600":"",children:"Compilazione"}),(0,i.jsx)("span",{className:3===l?"font-medium text-blue-600":"",children:"Riepilogo"})]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[1===l&&!n&&(0,i.jsx)(_,{selectedCondominio:c,selectedTipologia:m,onCondominioChange:d,onTipologiaChange:x,onNext:()=>{c&&m&&o(2)},canProceed:S}),2===l&&m&&(0,i.jsx)(A,{tipologia:m,datiVerifica:u,onDatiChange:h,onNext:D,onPrevious:C,canProceed:E,lavorazioneId:w}),3===l&&c&&m&&(0,i.jsx)(T,{condominio:c,tipologia:m,datiVerifica:u,note:g,onNoteChange:p,onComplete:z,onPrevious:C,loading:b})]}),(0,i.jsxs)("div",{className:"mt-6 flex justify-between",children:[(0,i.jsxs)("button",{onClick:()=>{o(1),d(null),x(null),h({}),p(""),f(!1)},className:"text-gray-600 hover:text-gray-800 text-sm flex items-center gap-1",children:[(0,i.jsx)("span",{children:"\uD83D\uDD04"}),"Ricomincia"]}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"\uD83D\uDCA1 I dati vengono salvati automaticamente ad ogni passaggio"})]}),y&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4",children:[(0,i.jsx)("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-t-xl",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"text-3xl mr-3",children:"❌"}),(0,i.jsx)("h2",{className:"text-xl font-bold",children:"Errore"})]})}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsx)("p",{className:"text-gray-700 mb-6",children:y}),(0,i.jsx)("div",{className:"flex justify-end space-x-3",children:(0,i.jsx)("button",{onClick:()=>N(null),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-md transition-colors duration-200",children:"Chiudi"})})]})]})})]})}function I(e){let{foto:t,nome:a}=e,[r,n]=(0,s.useState)(null);if(!t||0===t.length)return null;let l=e=>{n(e)},o=e=>{let i=document.createElement("a");i.href=t[e],i.download="".concat(a,"_foto_").concat(e+1,".jpg"),document.body.appendChild(i),i.click(),document.body.removeChild(i)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsxs)("h5",{className:"text-sm font-medium text-gray-700",children:["\uD83D\uDCF7 ",a," (",t.length," foto)"]})}),(0,i.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",children:t.map((e,t)=>(0,i.jsxs)("div",{className:"relative group cursor-pointer",children:[(0,i.jsx)("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-colors",children:(0,i.jsx)("img",{src:e,alt:"Foto ".concat(t+1," - ").concat(a),className:"w-full h-full object-cover hover:scale-105 transition-transform",onClick:()=>l(t)})}),(0,i.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-200 rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("button",{onClick:()=>l(t),className:"p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all",title:"Visualizza",children:"\uD83D\uDC41️"}),(0,i.jsx)("button",{onClick:()=>o(t),className:"p-2 bg-blue-500 bg-opacity-90 text-white rounded-full hover:bg-opacity-100 transition-all",title:"Scarica",children:"\uD83D\uDCBE"})]})}),(0,i.jsx)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded",children:t+1})]},t))})]}),null!==r&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[(0,i.jsx)("img",{src:t[r],alt:"Foto ".concat(r+1," - ").concat(a),className:"max-w-full max-h-full object-contain"}),(0,i.jsx)("div",{className:"absolute top-4 left-4 text-white",children:(0,i.jsxs)("div",{className:"bg-black bg-opacity-75 px-4 py-2 rounded-lg",children:[(0,i.jsx)("div",{className:"font-medium",children:a}),(0,i.jsxs)("div",{className:"text-sm text-gray-300",children:["Foto ",r+1," di ",t.length]})]})}),r>0&&(0,i.jsx)("button",{onClick:()=>{null!==r&&r>0&&n(r-1)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-75 text-white p-4 rounded-full hover:bg-opacity-90 transition-all",title:"Foto precedente",children:"⬅️"}),r<t.length-1&&(0,i.jsx)("button",{onClick:()=>{null!==r&&r<t.length-1&&n(r+1)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-75 text-white p-4 rounded-full hover:bg-opacity-90 transition-all",title:"Foto successiva",children:"➡️"}),(0,i.jsxs)("div",{className:"absolute bottom-4 right-4 flex space-x-3",children:[(0,i.jsx)("button",{onClick:()=>o(r),className:"bg-blue-500 bg-opacity-90 text-white px-4 py-2 rounded-lg hover:bg-opacity-100 transition-all",title:"Scarica foto",children:"\uD83D\uDCBE Scarica"}),(0,i.jsx)("button",{onClick:()=>{n(null)},className:"bg-red-500 bg-opacity-90 text-white px-4 py-2 rounded-lg hover:bg-opacity-100 transition-all",title:"Chiudi",children:"❌ Chiudi"})]}),(0,i.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-black bg-opacity-75 p-3 rounded-lg max-w-xs overflow-x-auto",children:t.map((e,t)=>(0,i.jsx)("div",{onClick:()=>n(t),className:"cursor-pointer w-12 h-12 rounded overflow-hidden border-2 transition-all ".concat(r===t?"border-blue-400":"border-gray-600 hover:border-gray-400"),children:(0,i.jsx)("img",{src:e,alt:"Miniatura ".concat(t+1),className:"w-full h-full object-cover"})},t))})]})})]})}function O(){let[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0),[n,l]=(0,s.useState)(null),o=async()=>{try{let e=await fetch("/api/users"),a=await e.json();a.success?t(a.data):l(a.error)}catch(e){l("Errore nel caricamento degli utenti")}finally{r(!1)}};(0,s.useEffect)(()=>{o()},[]);let c=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"approve"})}),a=await t.json();a.success?(await o(),alert("Utente approvato con successo!")):alert("Errore nell'approvazione: "+a.error)}catch(e){alert("Errore nell'approvazione dell'utente")}},d=async e=>{if(confirm("Sei sicuro di voler rifiutare questo utente? Verr\xe0 rimosso dalla lista di attesa."))try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"reject"})}),a=await t.json();a.success?(await o(),alert("Utente rifiutato e rimosso dalla lista di attesa")):alert("Errore nel rifiuto: "+a.error)}catch(e){alert("Errore nel rifiuto dell'utente")}},m=async e=>{if(confirm("Resettare la password? Verr\xe0 generata una password temporanea da comunicare all'utente."))try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"reset_password"})}),a=await t.json();if(a.success&&a.tempPassword){let e="";if(navigator.clipboard)try{await navigator.clipboard.writeText(a.tempPassword),e="\n\n✅ Password temporanea copiata negli appunti!"}catch(t){e="\n\n⚠️ Copia manuale necessaria"}alert("\uD83D\uDD11 PASSWORD RESETTATA!\n\n"+"\uD83D\uDC64 Username: ".concat(a.username," (invariato)\n")+"\uD83D\uDDDD️ Nuova password temporanea: ".concat(a.tempPassword,"\n\n")+"\uD83D\uDCCB Comunica SOLO la nuova password all'utente.\n✅ L'username rimane lo stesso di prima.\n"+"\uD83D\uDD04 Al primo accesso dovr\xe0 cambiare la password.".concat(e)),await o()}else alert("Errore nel reset password: "+(a.error||"Password temporanea non generata"))}catch(e){alert("Errore nel reset della password")}},x=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"activate"})}),a=await t.json();a.success?(await o(),alert("Utente riattivato")):alert("Errore nella riattivazione: "+a.error)}catch(e){alert("Errore nella riattivazione dell'utente")}},u=async e=>{try{let t=await fetch("/api/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({azione:"deactivate"})}),a=await t.json();a.success?(await o(),alert("Utente disattivato")):alert("Errore nella disattivazione: "+a.error)}catch(e){alert("Errore nella disattivazione dell'utente")}},h=e=>new Date(e).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),g=e.filter(e=>!e.approved_at&&!e.rejected_at&&"sopralluoghista"===e.role&&e.attivo),p=e.filter(e=>e.approved_at||"admin"===e.role);return a?(0,i.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento utenti..."})]}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\uD83D\uDC65 Gestione Utenti"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Approva nuovi sopralluoghisti e gestisci gli account"})]}),n&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"text-red-600",children:["❌ ",n]})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:g.length}),(0,i.jsx)("div",{className:"text-yellow-800 text-sm",children:"Da Approvare"})]}),(0,i.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,i.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:p.length}),(0,i.jsx)("div",{className:"text-green-800 text-sm",children:"Approvati"})]}),(0,i.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:e.length}),(0,i.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,i.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDC65"})]})})]}),g.length>0&&(0,i.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["⏳ Utenti in Attesa di Approvazione (",g.length,")"]}),(0,i.jsx)("div",{className:"space-y-4",children:g.map(e=>(0,i.jsx)("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-medium text-gray-900",children:[e.nome," ",e.cognome]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["@",e.username]}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),(0,i.jsxs)("div",{className:"text-xs text-gray-400",children:["Registrato: ",h(e.created_at)]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>c(e.id),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm",children:"✅ Approva"}),(0,i.jsx)("button",{onClick:()=>d(e.id),className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm",children:"❌ Rifiuta"})]})]})},e.id))})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,i.jsx)("div",{className:"p-6 border-b",children:(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Tutti gli Utenti"})}),(0,i.jsx)("div",{className:"divide-y divide-gray-200",children:e.map(e=>(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-4",children:(0,i.jsx)("span",{className:"text-gray-600 font-medium",children:e.nome?e.nome.charAt(0).toUpperCase():e.username.charAt(0).toUpperCase()})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-medium text-gray-900",children:[e.nome," ",e.cognome,(0,i.jsx)("span",{className:"ml-2 px-2 py-1 text-xs font-medium rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role.toUpperCase()})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["@",e.username," • ",e.email]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:[e.approved_at?"Approvato: ".concat(h(e.approved_at)):e.rejected_at?"Rifiutato: ".concat(h(e.rejected_at)):"In attesa di approvazione",e.password_reset_required&&(0,i.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full",children:"\uD83D\uDD11 Reset Password Richiesto"})]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(e.attivo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.attivo?"Attivo":"Disattivo"}),e.approved_at?(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"✅ Approvato"}):e.rejected_at?(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"❌ Rifiutato"}):(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"⏳ Pending"})]}),"admin"!==e.role&&(0,i.jsxs)("div",{className:"flex flex-col gap-1 ml-2",children:[(0,i.jsx)("button",{onClick:()=>m(e.id),className:"bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 transition-colors",children:"\uD83D\uDD11 Reset Password"}),e.attivo?(0,i.jsx)("button",{onClick:()=>u(e.id),className:"bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition-colors",children:"❌ Disattiva"}):(0,i.jsx)("button",{onClick:()=>x(e.id),className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600 transition-colors",children:"✅ Attiva"})]})]})]})},e.id))})]})]})}function F(){let[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)([]),[n,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[d,m]=(0,s.useState)(new Set),[x,u]=(0,s.useState)("tutti"),[h,g]=(0,s.useState)("");(0,s.useEffect)(()=>{Promise.all([p(),b()]).finally(()=>c(!1))},[]),(0,s.useEffect)(()=>{e.length>0&&a.length>0&&v()},[e,a]);let p=async()=>{try{let e=await fetch("/api/condomini"),a=await e.json();a.success?t(a.data):alert("Errore nel caricamento condomini: "+a.error)}catch(e){alert("Errore nel caricamento condomini")}},b=async()=>{try{let e=await fetch("/api/users"),t=await e.json();if(t.success){let e=t.data.filter(e=>"sopralluoghista"===e.role&&e.attivo&&e.approved_at);r(e)}else alert("Errore nel caricamento sopralluoghisti: "+t.error)}catch(e){alert("Errore nel caricamento sopralluoghisti")}},v=()=>{let t=e.filter(e=>e.assigned_to).length,i=e.length-t,s=a.map(t=>({id:t.id,nome:t.nome||t.username,cognome:t.cognome||"",condominiumCount:e.filter(e=>e.assigned_to===t.id).length}));l({totaleCondomini:e.length,assegnati:t,nonAssegnati:i,sopralluoghisti:s})},j=e.filter(e=>"assegnati"===x?e.assigned_to:"non-assegnati"!==x||!e.assigned_to),f=e=>{let t=new Set(d);t.has(e)?t.delete(e):t.add(e),m(t)},y=()=>{m(new Set(j.map(e=>e.id)))},N=()=>{m(new Set)},w=async()=>{if(0===d.size){alert("Seleziona almeno un condominio");return}if(h||confirm("Vuoi rimuovere tutte le assegnazioni selezionate?"))try{var e;c(!0);let t=await fetch("/api/condomini/assign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({condomini_ids:Array.from(d),sopralluoghista_id:h||null})}),a=await t.json();a.success||(null===(e=a.summary)||void 0===e?void 0:e.success)>0?(alert(a.message),m(new Set),await p()):alert("Errore nell'assegnazione: "+a.error)}catch(e){alert("Errore nell'assegnazione batch")}finally{c(!1)}},D=async(e,t)=>{try{let a=await fetch("/api/condomini/assign",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({condominio_id:e,sopralluoghista_id:t})}),i=await a.json();i.success?await p():alert("Errore nell'assegnazione: "+i.error)}catch(e){alert("Errore nell'assegnazione")}},C=e=>{let t=a.find(t=>t.id===e);return t?"".concat(t.nome||t.username," ").concat(t.cognome||"").trim():"Utente non trovato"};return o?(0,i.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,i.jsx)("div",{className:"text-lg",children:"Caricamento assegnazioni..."})}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83C\uDFE2 Gestione Assegnazioni Condomini"}),n&&(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:n.totaleCondomini}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Totale Condomini"})]}),(0,i.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:n.assegnati}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Assegnati"})]}),(0,i.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:n.nonAssegnati}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Non Assegnati"})]}),(0,i.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:a.length}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Sopralluoghisti"})]})]}),(null==n?void 0:n.sopralluoghisti)&&n.sopralluoghisti.length>0&&(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h3",{className:"font-medium mb-3",children:"Carico di lavoro per sopralluoghista:"}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:n.sopralluoghisti.map(e=>(0,i.jsxs)("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[(0,i.jsxs)("span",{className:"text-sm font-medium",children:[e.nome," ",e.cognome]}),(0,i.jsxs)("span",{className:"px-2 py-1 rounded text-xs ".concat(0===e.condominiumCount?"bg-gray-200":e.condominiumCount<=3?"bg-green-100 text-green-700":e.condominiumCount<=6?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:[e.condominiumCount," condomini"]})]},e.id))})]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h3",{className:"font-semibold mb-4",children:"Assegnazione Batch"}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 items-end",children:[(0,i.jsxs)("div",{className:"flex-1 min-w-48",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sopralluoghista per assegnazione"}),(0,i.jsxs)("select",{value:h,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Seleziona sopralluoghista per assegnazione",children:[(0,i.jsx)("option",{value:"",children:"-- Rimuovi assegnazione --"}),a.map(e=>(0,i.jsx)("option",{value:e.id,children:C(e.id)},e.id))]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:y,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"Seleziona Tutti"}),(0,i.jsx)("button",{onClick:N,className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"Deseleziona"}),(0,i.jsxs)("button",{onClick:w,disabled:0===d.size,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:["Assegna (",d.size,")"]})]})]})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,i.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"radio",name:"filtroAssegnazione",value:"tutti",checked:"tutti"===x,onChange:e=>u(e.target.value),className:"mr-2"}),"Tutti (",e.length,")"]}),(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"radio",name:"filtroAssegnazione",value:"assegnati",checked:"assegnati"===x,onChange:e=>u(e.target.value),className:"mr-2"}),"Assegnati (",(null==n?void 0:n.assegnati)||0,")"]}),(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"radio",name:"filtroAssegnazione",value:"non-assegnati",checked:"non-assegnati"===x,onChange:e=>u(e.target.value),className:"mr-2"}),"Non Assegnati (",(null==n?void 0:n.nonAssegnati)||0,")"]})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:[d.size," selezionati"]})]})}),(0,i.jsxs)("div",{className:"overflow-x-auto",children:[(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,i.jsx)("input",{type:"checkbox",onChange:e=>e.target.checked?y():N(),checked:d.size===j.length&&j.length>0,"aria-label":"Seleziona tutti i condomini"})}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Condominio"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sopralluoghista Assegnato"}),(0,i.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Azioni"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("input",{type:"checkbox",checked:d.has(e.id),onChange:()=>f(e.id),"aria-label":"Seleziona ".concat(e.nome)})}),(0,i.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:e.nome}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["Token: ",e.token]})]}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.assigned_to?(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-700 rounded-full",children:C(e.assigned_to)}):(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full",children:"Non assegnato"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,i.jsxs)("select",{value:e.assigned_to||"",onChange:t=>D(e.id,t.target.value||null),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500","aria-label":"Assegna ".concat(e.nome),children:[(0,i.jsx)("option",{value:"",children:"-- Non assegnato --"}),a.map(e=>(0,i.jsx)("option",{value:e.id,children:C(e.id)},e.id))]})})]},e.id))})]}),0===j.length&&(0,i.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Nessun condominio trovato con i filtri selezionati"})]})]})]})}var R=a(2700),L=a(3910);let V=[{id:"manutenzione",nome:"Manutenzione Ordinaria",descrizione:"Interventi di manutenzione preventiva e programmata"},{id:"riparazione",nome:"Riparazione Urgente",descrizione:"Interventi correttivi su guasti o malfunzionamenti"},{id:"verifica",nome:"Verifica Tecnica",descrizione:"Controlli e verifiche periodiche obbligatorie"},{id:"sicurezza",nome:"Sicurezza e Conformit\xe0",descrizione:"Interventi per sicurezza e adeguamento normativo"},{id:"pulizia",nome:"Pulizia Straordinaria",descrizione:"Interventi di pulizia e sanificazione"},{id:"altro",nome:"Altro",descrizione:"Altre tipologie di lavorazione"}];function M(e){var t,a,r,n,l;let{onClose:o,onComplete:c}=e,[d,m]=(0,s.useState)(1),[x,u]=(0,s.useState)([]),[h,g]=(0,s.useState)([]),[p,b]=(0,s.useState)([]),[v,j]=(0,s.useState)(!1),[f,y]=(0,s.useState)({condominio_id:"",tipologia:"",descrizione:"",priorita:"media"});(0,s.useEffect)(()=>{N()},[]);let N=async()=>{j(!0);try{let t=await fetch("/api/condomini");if(t.ok){let e=await t.json();u(e.data||[])}let a=await fetch("/api/users");if(a.ok){var e;let t=await a.json();g((null===(e=t.data)||void 0===e?void 0:e.filter(e=>"sopralluoghista"===e.role&&e.attivo))||[])}let i=await fetch("/api/tipologie");if(i.ok){let e=await i.json();b(e.data||[])}}catch(e){console.error("Errore caricamento dati:",e)}finally{j(!1)}},w=()=>"verifica"===f.tipologia?4:3,D=f.condominio_id&&f.tipologia,C="verifica"!==f.tipologia||void 0!==f.tipologia_verifica_id,z=""!==f.descrizione.trim();return v?(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-8 rounded-lg",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"Caricamento..."})]})}):(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,i.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-t-xl",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:"Crea Nuova Lavorazione"}),(0,i.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,i.jsx)("div",{className:"flex space-x-2",children:Array.from({length:w()},(e,t)=>t+1).map(e=>(0,i.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(e<=d?"bg-white text-blue-600":"bg-blue-500 text-white"),children:e},e))}),(0,i.jsx)("button",{onClick:o,className:"text-white hover:text-gray-200",children:"✕"})]})]}),(0,i.jsxs)("div",{className:"p-6",children:[1===d&&(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Seleziona Condominio e Tipologia"}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condominio *"}),(0,i.jsxs)("select",{value:f.condominio_id,onChange:e=>y({...f,condominio_id:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500","aria-label":"Seleziona condominio",children:[(0,i.jsx)("option",{value:"",children:"Seleziona un condominio..."}),x.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.nome," ",e.indirizzo&&"- ".concat(e.indirizzo)]},e.id))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipologia Lavorazione *"}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:V.map(e=>(0,i.jsxs)("div",{onClick:()=>y({...f,tipologia:e.id,tipologia_verifica_id:void 0}),className:"p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ".concat(f.tipologia===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800",children:e.nome}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.descrizione})]},e.id))})]})]})}),2===d&&"verifica"===f.tipologia&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Seleziona Tipologia di Verifica"}),(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:"Scegli quale tipo specifico di verifica tecnica deve essere eseguita:"}),(0,i.jsx)("div",{className:"grid grid-cols-1 gap-3 max-h-96 overflow-y-auto",children:p.filter(e=>e.attiva).map(e=>(0,i.jsx)("div",{onClick:()=>y({...f,tipologia_verifica_id:e.id}),className:"p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ".concat(f.tipologia_verifica_id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800",children:e.nome}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.descrizione}),e.campi_richiesti&&e.campi_richiesti.length>0&&(0,i.jsxs)("p",{className:"text-xs text-blue-600 mt-2",children:[e.campi_richiesti.length," campi da compilare"]})]}),f.tipologia_verifica_id===e.id&&(0,i.jsx)("div",{className:"text-blue-500 ml-2",children:"✓"})]})},e.id))}),0===p.filter(e=>e.attiva).length&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,i.jsx)("p",{children:"Nessuna tipologia di verifica attiva trovata."}),(0,i.jsx)("p",{className:"text-sm",children:"Crea delle tipologie di verifica prima di procedere."})]})]}),(2===d&&"verifica"!==f.tipologia||3===d&&"verifica"===f.tipologia)&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Dettagli della Lavorazione"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descrizione *"}),(0,i.jsx)("textarea",{value:f.descrizione,onChange:e=>y({...f,descrizione:e.target.value}),placeholder:"Descrivi dettagliatamente la lavorazione da eseguire...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priorit\xe0"}),(0,i.jsx)("div",{className:"flex space-x-3",children:[{value:"bassa",label:"Bassa",color:"green"},{value:"media",label:"Media",color:"yellow"},{value:"alta",label:"Alta",color:"orange"},{value:"urgente",label:"Urgente",color:"red"}].map(e=>(0,i.jsx)("button",{onClick:()=>y({...f,priorita:e.value}),className:"px-4 py-2 rounded-lg font-medium transition-all ".concat(f.priorita===e.value?"bg-".concat(e.color,"-500 text-white"):"bg-".concat(e.color,"-100 text-").concat(e.color,"-700 hover:bg-").concat(e.color,"-200")),children:e.label},e.value))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Scadenza (opzionale)"}),(0,i.jsx)("input",{type:"date",value:f.data_scadenza||"",onChange:e=>y({...f,data_scadenza:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500","aria-label":"Data scadenza lavorazione"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note aggiuntive (opzionale)"}),(0,i.jsx)("textarea",{value:f.note||"",onChange:e=>y({...f,note:e.target.value}),placeholder:"Note, istruzioni specifiche, contatti...",rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(3===d&&"verifica"!==f.tipologia||4===d&&"verifica"===f.tipologia)&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Assegnazione Sopralluoghista"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assegna a (opzionale)"}),(0,i.jsxs)("select",{value:f.assegnato_a||"",onChange:e=>y({...f,assegnato_a:e.target.value||void 0}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500","aria-label":"Assegna sopralluoghista",children:[(0,i.jsx)("option",{value:"",children:"Non assegnato (da assegnare dopo)"}),h.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.nome," ",e.cognome," (",e.username,")"]},e.id))]}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Puoi lasciare non assegnato e assegnare in seguito dalla lista lavorazioni"})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-800 mb-2",children:"Riepilogo Lavorazione"}),(0,i.jsxs)("div",{className:"text-sm space-y-1",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Condominio:"})," ",null===(t=x.find(e=>e.id===f.condominio_id))||void 0===t?void 0:t.nome]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Tipologia:"})," ",null===(a=V.find(e=>e.id===f.tipologia))||void 0===a?void 0:a.nome]}),"verifica"===f.tipologia&&f.tipologia_verifica_id&&(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Verifica specifica:"})," ",null===(r=p.find(e=>e.id===f.tipologia_verifica_id))||void 0===r?void 0:r.nome]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Priorit\xe0:"})," ",f.priorita]}),f.assegnato_a&&(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Assegnato a:"})," ",null===(n=h.find(e=>e.id===f.assegnato_a))||void 0===n?void 0:n.nome," ",null===(l=h.find(e=>e.id===f.assegnato_a))||void 0===l?void 0:l.cognome]})]})]})]}),(0,i.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,i.jsxs)("button",{onClick:()=>{d>1&&m(d-1)},disabled:1===d,className:"flex items-center px-4 py-2 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,i.jsx)(R.Z,{className:"h-5 w-5 mr-1"}),"Indietro"]}),(0,i.jsxs)("div",{className:"flex space-x-3",children:[(0,i.jsx)("button",{onClick:o,className:"px-6 py-2 text-gray-600 hover:text-gray-800",children:"Annulla"}),d<w()?(0,i.jsxs)("button",{onClick:()=>{d<w()&&m(d+1)},disabled:1===d&&!D||2===d&&!C||3===d&&!z,className:"flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["Avanti",(0,i.jsx)(L.Z,{className:"h-5 w-5 ml-1"})]}):(0,i.jsx)("button",{onClick:()=>{c(f)},disabled:!(D&&C&&z),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Crea Lavorazione"})]})]})]})]})})}var U=a(3375);class B{addTitle(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:18;this.doc.setFontSize(t),this.doc.setFont("helvetica","bold"),this.doc.text(e,this.margin,this.currentY),this.currentY+=.7*t}addSubtitle(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;this.doc.setFontSize(t),this.doc.setFont("helvetica","bold"),this.doc.text(e,this.margin,this.currentY),this.currentY+=.6*t}addText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:11,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";this.doc.setFontSize(t),this.doc.setFont("helvetica",a);let i=this.pageWidth-2*this.margin;for(let a of this.doc.splitTextToSize(e,i))this.currentY>this.pageHeight-this.margin-20&&this.addNewPage(),this.doc.text(a,this.margin,this.currentY),this.currentY+=.6*t}addKeyValue(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:11;this.doc.setFontSize(a),this.doc.setFont("helvetica","bold");let i=this.doc.getTextWidth(e+": ");this.doc.text(e+":",this.margin,this.currentY),this.doc.setFont("helvetica","normal");let s=this.pageWidth-this.margin-i-10,r=this.doc.splitTextToSize(t,s),n=!0;for(let e of r){this.currentY>this.pageHeight-this.margin-20&&(this.addNewPage(),n=!0);let t=n?this.margin+i+5:this.margin;this.doc.text(e,t,this.currentY),this.currentY+=.6*a,n=!1}}addSeparator(){this.currentY+=5,this.doc.setDrawColor(200,200,200),this.doc.line(this.margin,this.currentY,this.pageWidth-this.margin,this.currentY),this.currentY+=8}addNewPage(){this.doc.addPage(),this.currentY=this.margin}async addImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:150;try{let i=await fetch(e),s=await i.blob(),r=await new Promise((e,t)=>{let a=new FileReader;a.onloadend=()=>e(a.result),a.onerror=t,a.readAsDataURL(s)}),n=e.includes(".png")?"PNG":"JPEG",l=new Image;l.src=r,await new Promise(e=>l.onload=e);let o=l.width/l.height,c=t,d=t/o;return d>a&&(d=a,c=a*o),this.currentY+d>this.pageHeight-this.margin-20&&this.addNewPage(),this.doc.addImage(r,n,this.margin,this.currentY,c,d),this.currentY+=d+10,!0}catch(e){return console.error("❌ Errore aggiunta immagine al PDF:",e),!1}}addHeader(){this.doc.setFillColor(59,130,246),this.doc.rect(0,0,this.pageWidth,15,"F"),this.doc.setTextColor(255,255,255),this.doc.setFontSize(12),this.doc.setFont("helvetica","bold"),this.doc.text("VERIFICHE CONDOMINIALI - REPORT LAVORAZIONE",this.margin,10),this.doc.setTextColor(0,0,0),this.currentY=25}addFooter(){let e=this.doc.getNumberOfPages();for(let t=1;t<=e;t++){this.doc.setPage(t);let a=new Date().toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});this.doc.setFontSize(8),this.doc.setFont("helvetica","normal"),this.doc.setTextColor(100,100,100);let i="Report generato il ".concat(a);this.doc.text(i,this.margin,this.pageHeight-15);let s="Pagina ".concat(t," di ").concat(e),r=this.doc.getTextWidth(s);this.doc.text(s,this.pageWidth-this.margin-r,this.pageHeight-15),this.doc.setDrawColor(200,200,200),this.doc.line(this.margin,this.pageHeight-20,this.pageWidth-this.margin,this.pageHeight-20)}this.doc.setTextColor(0,0,0)}getStatoLabel(e){switch(e){case"da_eseguire":return"DA ESEGUIRE";case"in_corso":return"IN CORSO";case"completata":return"COMPLETATA";case"riaperta":return"RIAPERTA";case"archiviata":return"ARCHIVIATA";default:return e.toUpperCase()}}getPrioritaLabel(e){switch(e){case"bassa":return"BASSA";case"media":return"MEDIA";case"alta":return"ALTA";default:return e.toUpperCase()}}generateLavorazionePDF(e){return this._generatePDF(e)}async _generatePDF(e){if(this.addHeader(),this.addTitle("REPORT LAVORAZIONE"),this.currentY+=5,this.addKeyValue("ID Lavorazione",e.id.substring(0,8)+"..."),this.addKeyValue("Titolo",e.titolo||e.descrizione),this.addSeparator(),this.addSubtitle("INFORMAZIONI GENERALI"),this.addKeyValue("Descrizione",e.descrizione),this.addKeyValue("Stato",this.getStatoLabel(e.stato)),this.addKeyValue("Priorit\xe0",this.getPrioritaLabel(e.priorita)),this.addSeparator(),e.condominio&&(this.addSubtitle("CONDOMINIO"),this.addKeyValue("Nome",e.condominio.nome),e.condominio.indirizzo&&this.addKeyValue("Indirizzo",e.condominio.indirizzo),this.addSeparator()),e.utente&&(this.addSubtitle("SOPRALLUOGHISTA ASSEGNATO"),this.addKeyValue("Nome","".concat(e.utente.nome," ").concat(e.utente.cognome)),this.addKeyValue("Email",e.utente.email),this.addSeparator()),this.addSubtitle("TIMELINE"),this.addKeyValue("Data Apertura",new Date(e.data_apertura).toLocaleString("it-IT")),e.data_completamento&&this.addKeyValue("Data Completamento",new Date(e.data_completamento).toLocaleString("it-IT")),this.addSeparator(),e.allegati)try{let t=JSON.parse(e.allegati);this.addSubtitle("TIPOLOGIA VERIFICA");let a="Altro";if("manutenzione"===t.tipologia?a="Manutenzione Ordinaria":"riparazione"===t.tipologia?a="Riparazione Urgente":"verifica"===t.tipologia?a="Verifica Tecnica":"sicurezza"===t.tipologia?a="Sicurezza e Conformit\xe0":"pulizia"===t.tipologia&&(a="Pulizia Straordinaria"),this.addKeyValue("Tipo Verifica",a),t.dati_verifica_completamento){this.addSubtitle("RISULTATI VERIFICA");let e=t.dati_verifica_completamento;Object.entries(e).forEach(e=>{let[t,a]=e;Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0].includes("blob.vercel-storage.com")||("boolean"==typeof a?this.addKeyValue(t,a?"✓ Conforme":"✗ Non conforme"):this.addKeyValue(t,String(a)))})}if(t.foto){if("object"!=typeof t.foto||Array.isArray(t.foto)){if(Array.isArray(t.foto)&&t.foto.length>0)for(let e of(this.addSubtitle("DOCUMENTAZIONE FOTOGRAFICA"),t.foto)){let t="string"==typeof e?e:e.url;t&&(console.log("\uD83D\uDCF8 Aggiungendo foto al PDF (legacy):",t),await this.addImage(t,140,140)||console.error("❌ Impossibile aggiungere foto"))}}else for(let[e,a]of(this.addSubtitle("DOCUMENTAZIONE FOTOGRAFICA"),Object.entries(t.foto)))if(Array.isArray(a)&&a.length>0){let t=e.replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");for(let e of(this.doc.setFontSize(11),this.doc.setFont("helvetica","bold"),this.doc.setTextColor(0,102,204),this.doc.text(t,this.margin,this.currentY),this.currentY+=8,this.doc.setTextColor(0,0,0),this.doc.setFont("helvetica","normal"),a))"string"!=typeof e||(console.log("\uD83D\uDCF8 Aggiungendo foto al PDF (".concat(t,"):"),e),await this.addImage(e,140,140)||console.error("❌ Impossibile aggiungere foto da ".concat(t)));this.currentY+=5}}this.addSeparator()}catch(e){}return e.note&&e.note.trim()&&(this.addSubtitle("NOTE"),this.addText(e.note),this.addSeparator()),this.addSubtitle("VALIDAZIONE"),this.addText("Questo documento \xe8 stato generato automaticamente dal sistema di gestione verifiche condominiali."),this.addText("Data generazione: ".concat(new Date().toLocaleString("it-IT"))),"completata"===e.stato&&this.addText("✓ Verifica completata e validata dal sopralluoghista assegnato"),this.addFooter(),this.doc.output("blob")}async downloadPDF(e,t){let a=await this.generateLavorazionePDF(e),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=t||"lavorazione-".concat(e.id.substring(0,8),"-").concat(new Date().toISOString().split("T")[0],".pdf"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}constructor(){this.doc=new U.ZP,this.pageWidth=this.doc.internal.pageSize.getWidth(),this.pageHeight=this.doc.internal.pageSize.getHeight(),this.margin=20,this.currentY=this.margin}}var q=a(5526);class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}async creaNotifica(e){try{let t={...e,letta:!1,data_creazione:new Date().toISOString()};console.log("\uD83D\uDCE2 Creando notifica:",t);let{data:a,error:i}=await q.O.from("notifiche").insert([t]).select().single();if(i)return console.error("❌ Errore creazione notifica:",i),null;return console.log("✅ Notifica creata:",a.id),this.inviaNotificaRealTime(a),this.inviaPushNotification(a).catch(e=>{console.warn("⚠️ Errore invio push notification:",e)}),a}catch(e){return console.error("❌ Errore critico creazione notifica:",e),null}}async notificaScadenzaImminente(e,t){let a=new Date(e.data_scadenza),i=new Date;return i.setDate(i.getDate()+t),await this.creaNotifica({tipo:"scadenza_imminente",titolo:"⏰ Scadenza lavorazione tra ".concat(t," giorni"),messaggio:'La lavorazione "'.concat(e.titolo,'" nel condominio scade il ').concat(a.toLocaleDateString("it-IT")),utente_id:e.user_id,lavorazione_id:e.id,condominio_id:e.condominio_id,priorita:t<=1?"urgente":t<=3?"alta":"media",data_scadenza:e.data_scadenza})}async notificaNuovaAssegnazione(e,t){return await this.creaNotifica({tipo:"nuova_assegnazione",titolo:"\uD83D\uDCCB Nuova lavorazione assegnata",messaggio:'Ti \xe8 stata assegnata la lavorazione "'.concat(e.titolo,'" con priorit\xe0 ').concat(e.priorita),utente_id:t,lavorazione_id:e.id,condominio_id:e.condominio_id,priorita:"urgente"===e.priorita?"urgente":"alta"})}async notificaLavorazioneCompletata(e,t){let a=[];for(let i of t){let t=await this.creaNotifica({tipo:"lavorazione_completata",titolo:"✅ Lavorazione completata",messaggio:'La lavorazione "'.concat(e.titolo,'" \xe8 stata completata dal sopralluoghista'),utente_id:i,lavorazione_id:e.id,condominio_id:e.condominio_id,priorita:"media"});t&&a.push(t)}return a}async creaReminderPersonalizzato(e,t){return await this.creaNotifica({tipo:"reminder_personalizzato",titolo:"\uD83D\uDD14 ".concat(e.nome),messaggio:t,utente_id:e.utente_id,priorita:"media"})}async getNotificheNonLette(e){try{let{data:t,error:a}=await q.O.from("notifiche").select("*").eq("utente_id",e).eq("letta",!1).order("data_creazione",{ascending:!1}).limit(50);if(a)return console.error("❌ Errore recupero notifiche:",a),[];return t||[]}catch(e){return console.error("❌ Errore critico recupero notifiche:",e),[]}}async marcaComeLetta(e){try{console.log("\uD83D\uDCDD Marcando notifica come letta: ".concat(e));let{data:t,error:a}=await q.O.from("notifiche").update({letta:!0,data_aggiornamento:new Date().toISOString()}).eq("id",e).select();if(a)return console.error("❌ Errore DB marca come letta:",a),!1;return console.log("✅ Notifica ".concat(e," aggiornata:"),t),!0}catch(e){return console.error("❌ Errore critico marca come letta:",e),!1}}async marcaTutteComeLette(e){try{console.log("\uD83D\uDCDD Marcando tutte le notifiche come lette per utente: ".concat(e));let{data:t,error:a}=await q.O.from("notifiche").update({letta:!0,data_aggiornamento:new Date().toISOString()}).eq("utente_id",e).eq("letta",!1).select();if(a)return console.error("❌ Errore DB marca tutte come lette:",a),!1;return console.log("✅ ".concat((null==t?void 0:t.length)||0," notifiche marcate come lette per utente ").concat(e)),!0}catch(e){return console.error("❌ Errore critico marca tutte come lette:",e),!1}}subscribe(e,t){return this.subscribers.set(e,t),()=>{this.subscribers.delete(e)}}inviaNotificaRealTime(e){let t=this.subscribers.get(e.utente_id);t&&t(e)}async inviaPushNotification(e){try{console.log("\uD83D\uDCF2 Tentativo invio push per notifica ".concat(e.id," a utente ").concat(e.utente_id));let t=await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({utenteIds:[e.utente_id],title:e.titolo,message:e.messaggio,url:"/",priorita:e.priorita,notificaId:e.id,lavorazioneId:e.lavorazione_id,condominioId:e.condominio_id})});if(!t.ok)throw Error("HTTP ".concat(t.status));let a=await t.json();console.log("✅ Push inviato: ".concat(a.sent,"/").concat(a.total))}catch(t){console.warn("⚠️ Push notification non inviato per ".concat(e.id,":"),t)}}constructor(){this.subscribers=new Map}}function G(){var e,t;let a=function(){let[e,t]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{t(!0)},[]),e}(),[r,n]=(0,s.useState)("lavorazioni"),[l,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[u,h]=(0,s.useState)("tutte"),[g,p]=(0,s.useState)(null),[b,j]=(0,s.useState)(!1),[f,y]=(0,s.useState)(""),[N,w]=(0,s.useState)(""),[D,C]=(0,s.useState)(!1),[z,S]=(0,s.useState)(!1),[E,k]=(0,s.useState)(null),[_,A]=(0,s.useState)(!1),[T,P]=(0,s.useState)(null),[R]=(0,s.useState)(()=>J.getInstance()),L=(0,s.useCallback)(async()=>{d(!0);try{let e="tutte"!==u?"/api/lavorazioni?stato=".concat(u):"/api/lavorazioni",t=await fetch(e),a=await t.json();a.success?o(a.data):x(a.error)}catch(e){x("Errore nel caricamento delle lavorazioni")}d(!1)},[u]),V=async e=>{try{console.log("Creando lavorazione:",e);let t={condominio_id:e.condominio_id,tipologia:e.tipologia,tipologia_verifica_id:e.tipologia_verifica_id,descrizione:e.descrizione,priorita:e.priorita,assegnato_a:e.assegnato_a,data_scadenza:e.data_scadenza,note:e.note},a=await fetch("/api/lavorazioni",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw Error(e.error||"Errore nella creazione della lavorazione")}let i=await a.json();if(i.success)console.log("Lavorazione creata con successo:",i.data),k({...i.data,...t}),C(!1),S(!0),await L(),v(1e3);else throw Error(i.error||"Errore nella creazione della lavorazione")}catch(e){console.error("Errore creazione lavorazione:",e),alert("Errore nella creazione della lavorazione: ".concat(e instanceof Error?e.message:"Errore sconosciuto"))}};(0,s.useEffect)(()=>{L()},[L]);let U=async(e,t,a)=>{console.log("\uD83D\uDD04 Eseguo azione:",{lavorazioneId:e,tipoAzione:t,nota:a});try{let i={azione:t,dati:{nota:a,motivo:a}};console.log("\uD83D\uDCE4 Request body:",i);let s=await fetch("/api/lavorazioni/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});console.log("\uD83D\uDCE5 Response status:",s.status);let r=await s.json();if(console.log("\uD83D\uDCCB Response result:",r),r.success){if(L(),j(!1),y(""),g)try{let e="",i="";switch(t){case"completa":e="✅ Lavorazione Completata",i='La lavorazione "'.concat(g.titolo,"\" \xe8 stata completata dall'amministratore.");break;case"riapri":e="\uD83D\uDD04 Lavorazione Riaperta",i='La lavorazione "'.concat(g.titolo,'" \xe8 stata riaperta. Motivo: ').concat(a||"Non specificato");break;case"annulla":e="❌ Lavorazione Annullata",i='La lavorazione "'.concat(g.titolo,'" \xe8 stata annullata. Motivo: ').concat(a||"Non specificato");break;default:e="\uD83D\uDCCB Aggiornamento Lavorazione",i='La lavorazione "'.concat(g.titolo,"\" \xe8 stata aggiornata dall'amministratore.")}await R.creaNotifica({utente_id:g.user_id,tipo:"completa"===t?"lavorazione_completata":"nuova_assegnazione",titolo:e,messaggio:i,lavorazione_id:g.id,priorita:"annulla"===t?"alta":"media"}),console.log("✅ Notifica creata per azione:",t)}catch(e){console.error("⚠️ Errore creazione notifica:",e)}p(null),v(1e3)}else x(r.error)}catch(e){x("Errore nell'esecuzione dell'azione")}},q=(e,t)=>{p(e),w(t),j(!0)},G=e=>{try{let t=new Date(e),a=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),r=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return"".concat(a,"/").concat(i,"/").concat(s," ").concat(r,":").concat(n)}catch(t){return e}},Y=e=>"\uD83D\uDD34",H=e=>{switch(e){case"da_eseguire":return"\uD83D\uDD34";case"in_corso":return"⏳";case"completata":return"✅";default:return"�"}},W=e=>{alert("Modifica lavorazione: ".concat(e.descrizione,"\nID: ").concat(e.id))},Q=e=>{p(e),w("elimina"),j(!0)},K=e=>{P(e),A(!0)},Z=async()=>{if(g)try{let e=await fetch("/api/lavorazioni/".concat(g.id),{method:"DELETE"});if(!e.ok){let t=await e.json();throw Error(t.error||"Errore nella cancellazione")}let t=await e.json();if(t.success)j(!1),p(null),await L(),v(1e3),alert("Lavorazione eliminata con successo!");else throw Error(t.error||"Errore nella cancellazione")}catch(e){console.error("Errore cancellazione lavorazione:",e),alert("Errore nella cancellazione: ".concat(e instanceof Error?e.message:"Errore sconosciuto"))}},X={totali:l.length,da_eseguire:l.filter(e=>"da_eseguire"===e.stato).length,in_corso:l.filter(e=>"in_corso"===e.stato).length,completata:l.filter(e=>"completata"===e.stato).length,riaperte:l.filter(e=>"riaperta"===e.stato).length};return c?(0,i.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento lavorazioni..."})]}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Pannello Amministratore"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Gestisci lavorazioni, utenti e configurazioni del sistema"})]}),(0,i.jsx)("div",{className:"border-b border-gray-200",children:(0,i.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,i.jsx)("button",{onClick:()=>n("lavorazioni"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("lavorazioni"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83D\uDD27 Lavorazioni"}),(0,i.jsx)("button",{onClick:()=>n("utenti"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("utenti"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83D\uDC65 Utenti"}),(0,i.jsx)("button",{onClick:()=>n("assegnazioni"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("assegnazioni"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83C\uDFE2 Assegnazioni Condomini"}),(0,i.jsx)("button",{onClick:()=>n("notifiche"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("notifiche"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"\uD83D\uDD14 Sistema Notifiche"})]})}),"utenti"===r&&(0,i.jsx)(O,{}),"assegnazioni"===r&&(0,i.jsx)(F,{}),"notifiche"===r&&(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"\uD83D\uDD14 Sistema Notifiche Real-Time"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:"✅"}),(0,i.jsxs)("div",{className:"text-sm text-blue-800 mt-2",children:[(0,i.jsx)("div",{className:"font-medium",children:"Sistema Attivo"}),(0,i.jsx)("div",{className:"text-xs",children:"Server-Sent Events configurato"})]})]}),(0,i.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"\uD83D\uDCE1"}),(0,i.jsxs)("div",{className:"text-sm text-green-800 mt-2",children:[(0,i.jsx)("div",{className:"font-medium",children:"API Pronte"}),(0,i.jsx)("div",{className:"text-xs",children:"Scheduler e streaming attivi"})]})]}),(0,i.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:"\uD83D\uDD04"}),(0,i.jsxs)("div",{className:"text-sm text-purple-800 mt-2",children:[(0,i.jsx)("div",{className:"font-medium",children:"Automazione"}),(0,i.jsx)("div",{className:"text-xs",children:"Reminder e scadenze automatiche"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"\uD83C\uDF9B️ Controlli Sistema"}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,i.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/notifications/scheduler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"check-scadenze"})}),t=await e.json();alert(t.success?"Controllo scadenze eseguito!":"Errore: "+t.error)}catch(e){alert("Errore controllo scadenze")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"\uD83D\uDD0D Controlla Scadenze"}),(0,i.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/notifications/scheduler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"send-daily-reminders"})}),t=await e.json();alert(t.success?"Reminder inviati!":"Errore: "+t.error)}catch(e){alert("Errore invio reminder")}},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"\uD83D\uDCC5 Invia Reminder"}),(0,i.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/notifications/scheduler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"cleanup"})}),t=await e.json();alert(t.success?"Cleanup completato!":"Errore: "+t.error)}catch(e){alert("Errore cleanup")}},className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm",children:"\uD83E\uDDF9 Cleanup Notifiche"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"\uD83D\uDCCA Statistiche Sistema"}),(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded border text-sm space-y-2",children:[(0,i.jsxs)("div",{children:["• ",(0,i.jsx)("strong",{children:"Cloudinary:"})," Sistema foto cloud attivo (25GB gratuiti)"]}),(0,i.jsxs)("div",{children:["• ",(0,i.jsx)("strong",{children:"Database:"})," Tabelle notifiche e reminder_configs create"]}),(0,i.jsxs)("div",{children:["• ",(0,i.jsx)("strong",{children:"API:"})," /api/notifications/stream (SSE) e /api/notifications/scheduler"]}),(0,i.jsxs)("div",{children:["• ",(0,i.jsx)("strong",{children:"Automazione:"})," Controlli ogni 15 minuti, reminder giornalieri"]}),(0,i.jsxs)("div",{children:["• ",(0,i.jsx)("strong",{children:"Features:"})," NotificationCenter, ReminderSettings, migrazione Base64"]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"⚙️ Prossimi Passi"}),(0,i.jsxs)("div",{className:"bg-yellow-50 p-4 rounded border text-sm space-y-2",children:[(0,i.jsxs)("div",{children:["1. ",(0,i.jsx)("strong",{children:"Database:"})," Eseguire sql/setup-notifiche.sql su Supabase"]}),(0,i.jsxs)("div",{children:["2. ",(0,i.jsx)("strong",{children:"Cloudinary:"})," Configurare credenziali in .env.local"]}),(0,i.jsxs)("div",{children:["3. ",(0,i.jsx)("strong",{children:"UI:"})," Integrare NotificationCenter nel layout principale"]}),(0,i.jsxs)("div",{children:["4. ",(0,i.jsx)("strong",{children:"Automazione:"})," Configurare cron jobs in vercel.json"]}),(0,i.jsxs)("div",{children:["5. ",(0,i.jsx)("strong",{children:"Test:"})," Verificare migrazione foto e notifiche real-time"]})]})]})]})]})}),"lavorazioni"===r&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:X.totali}),(0,i.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,i.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDCCA"})]})}),(0,i.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:X.da_eseguire}),(0,i.jsx)("div",{className:"text-yellow-800 text-sm",children:"Da Eseguire"})]}),(0,i.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:X.in_corso}),(0,i.jsx)("div",{className:"text-blue-800 text-sm",children:"In Corso"})]}),(0,i.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDD04"})]})}),(0,i.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:X.completata}),(0,i.jsx)("div",{className:"text-green-800 text-sm",children:"Completate"})]}),(0,i.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,i.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:X.riaperte}),(0,i.jsx)("div",{className:"text-orange-800 text-sm",children:"Riaperte"})]}),(0,i.jsx)("div",{className:"text-orange-400 text-2xl",children:"\uD83D\uDD04"})]})})]}),(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Filtra per stato:"}),(0,i.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Filtra lavorazioni per stato",children:[(0,i.jsx)("option",{value:"tutte",children:"Tutte le lavorazioni"}),(0,i.jsx)("option",{value:"aperta",children:"Solo aperte"}),(0,i.jsx)("option",{value:"chiusa",children:"Solo chiuse"}),(0,i.jsx)("option",{value:"riaperta",children:"Solo riaperte"})]}),(0,i.jsxs)("button",{onClick:L,className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"\uD83D\uDD04"}),"Ricarica"]}),(0,i.jsxs)("button",{onClick:()=>C(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 ml-auto",children:[(0,i.jsx)("span",{children:"✨"}),"Nuova Lavorazione"]})]}),m&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"text-red-600",children:["❌ ",m]})}),(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:0===l.length?(0,i.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Nessuna lavorazione trovata"}),(0,i.jsx)("p",{children:"Non ci sono lavorazioni che corrispondono ai filtri selezionati"})]}):(0,i.jsx)("div",{className:"divide-y divide-gray-200",children:l.map(e=>{var t,s,r,n,l;return e&&e.id?(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,i.jsx)("span",{className:"text-2xl",children:H(e.stato)}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(Y(e.stato)),children:e.stato.toUpperCase()}),a&&(null==e?void 0:e.priorita)&&(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("alta"===e.priorita?"bg-red-100 text-red-800":"media"===e.priorita?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"alta"===e.priorita?"\uD83D\uDD34 ALTA":"media"===e.priorita?"\uD83D\uDFE1 MEDIA":"⚪ BASSA"})]}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e.descrizione}),a?(0,i.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[(null===(t=e.condomini)||void 0===t?void 0:t.nome)&&(0,i.jsxs)("div",{className:"bg-blue-50 p-2 rounded",children:[(0,i.jsx)("strong",{children:"\uD83C\uDFE2 Condominio:"})," ",e.condomini.nome,(null===(s=e.condomini)||void 0===s?void 0:s.indirizzo)&&(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["\uD83D\uDCCD ",e.condomini.indirizzo]})]}),(null===(r=e.users)||void 0===r?void 0:r.nome)&&(0,i.jsxs)("div",{className:"bg-green-50 p-2 rounded",children:[(0,i.jsx)("strong",{children:"\uD83D\uDC64 Assegnato a:"})," ",e.users.nome," ",e.users.cognome||"",(null===(n=e.users)||void 0===n?void 0:n.username)&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["@",e.users.username]})]}),e.tipologia&&(0,i.jsxs)("div",{className:"bg-yellow-50 p-2 rounded",children:[(0,i.jsx)("strong",{children:"\uD83D\uDD27 Tipo:"})," ","manutenzione"===e.tipologia?"Manutenzione Ordinaria":"riparazione"===e.tipologia?"Riparazione Urgente":"verifica"===e.tipologia?"Verifica Tecnica":"sicurezza"===e.tipologia?"Sicurezza e Conformit\xe0":"pulizia"===e.tipologia?"Pulizia Straordinaria":"Altro"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDCC5 Aperta:"})," ",G(e.data_apertura)]}),e.data_chiusura&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"✅ Chiusa:"})," ",G(e.data_chiusura)]}),e.data_riapertura&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDD04 Riaperta:"})," ",G(e.data_riapertura)]})]}):(0,i.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDCC5 Aperta:"})," ",e.data_apertura]}),(0,i.jsx)("div",{className:"text-gray-500",children:"Caricamento dettagli..."})]}),a&&e.note&&(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md mb-3",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Note:"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"string"==typeof e.note?e.note:Array.isArray(e.note)?e.note.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-start mb-1",children:[(0,i.jsx)("span",{className:"text-blue-500 mr-2",children:"•"}),e]},t)):"Nessuna nota disponibile"})]}),(null===(l=e.verifica)||void 0===l?void 0:l.dati_verifica)&&Object.entries(e.verifica.dati_verifica).some(e=>{let[t,a]=e;return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0].startsWith("data:image")})&&(0,i.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"\uD83D\uDCF7 Foto Allegate"}),(0,i.jsx)("div",{className:"space-y-4",children:Object.entries(e.verifica.dati_verifica).filter(e=>{let[t,a]=e;return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0].startsWith("data:image")}).map(e=>{let[t,a]=e;return(0,i.jsx)(I,{foto:a,nome:t},t)})})]})]}),(0,i.jsxs)("div",{className:"ml-4 flex flex-col gap-2",children:[(0,i.jsx)("button",{onClick:()=>q(e,"aggiungi_nota"),className:"text-blue-600 hover:text-blue-800 text-sm px-3 py-1 border border-blue-200 rounded",children:"\uD83D\uDCDD Aggiungi Nota"}),("da_eseguire"===e.stato||"in_corso"===e.stato)&&(0,i.jsx)("button",{onClick:()=>q(e,"completa"),className:"text-green-600 hover:text-green-800 text-sm px-3 py-1 border border-green-200 rounded",children:"✅ Completa"}),"completata"===e.stato&&(0,i.jsx)("button",{onClick:()=>q(e,"riapri"),className:"text-orange-600 hover:text-orange-800 text-sm px-3 py-1 border border-orange-200 rounded",children:"\uD83D\uDD04 Riapri"}),(0,i.jsx)("button",{onClick:()=>K(e),className:"text-indigo-600 hover:text-indigo-800 text-sm px-3 py-1 border border-indigo-200 rounded",children:"\uD83D\uDC41️ Dettagli"}),(0,i.jsx)("button",{onClick:()=>W(e),className:"text-blue-600 hover:text-blue-800 text-sm px-3 py-1 border border-blue-200 rounded",children:"✏️ Modifica"}),(0,i.jsx)("button",{onClick:()=>Q(e),className:"text-red-600 hover:text-red-800 text-sm px-3 py-1 border border-red-200 rounded",children:"\uD83D\uDDD1️ Elimina"})]})]})},e.id):null})})}),b&&g&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 mx-4",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["chiudi"===N&&"Chiudi Lavorazione","riapri"===N&&"Riapri Lavorazione","aggiungi_nota"===N&&"Aggiungi Nota","elimina"===N&&"\uD83D\uDDD1️ Elimina Lavorazione"]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,i.jsx)("strong",{children:"Lavorazione:"})," ",g.descrizione]}),"elimina"===N?(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,i.jsxs)("p",{className:"text-red-800 text-sm",children:["⚠️ ",(0,i.jsx)("strong",{children:"Attenzione:"})," Questa azione eliminer\xe0 definitivamente la lavorazione e non pu\xf2 essere annullata."]})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"aggiungi_nota"===N?"Nuova nota:":"Nota (opzionale):"}),(0,i.jsx)("textarea",{value:f,onChange:e=>y(e.target.value),placeholder:"Inserisci una nota...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,i.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,i.jsx)("button",{onClick:()=>j(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Annulla"}),(0,i.jsx)("button",{onClick:"elimina"===N?Z:()=>{g&&U(g.id,N,f)},className:"px-4 py-2 text-white rounded-md transition-colors ".concat("elimina"===N?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"),children:"elimina"===N?"\uD83D\uDDD1️ Elimina":"Conferma"})]})]})})]}),D&&(0,i.jsx)(M,{onClose:()=>C(!1),onComplete:V}),z&&E&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4",children:[(0,i.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-xl",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"text-3xl mr-3",children:"✅"}),(0,i.jsx)("h2",{className:"text-xl font-bold",children:"Lavorazione Creata con Successo!"})]})}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"Dettagli Lavorazione:"}),(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Condominio:"}),(0,i.jsx)("span",{className:"font-medium",children:l.length>0&&(null===(t=l.find(e=>e.condomini))||void 0===t?void 0:null===(e=t.condomini)||void 0===e?void 0:e.nome)||E.condominio_id})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Tipologia:"}),(0,i.jsx)("span",{className:"font-medium",children:"manutenzione"===E.tipologia?"Manutenzione Ordinaria":"riparazione"===E.tipologia?"Riparazione Urgente":"verifica"===E.tipologia?"Verifica Tecnica":"sicurezza"===E.tipologia?"Sicurezza e Conformit\xe0":"pulizia"===E.tipologia?"Pulizia Straordinaria":E.tipologia||"Altro"})]}),E.tipologia_verifica_nome&&(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Verifica Specifica:"}),(0,i.jsx)("span",{className:"font-medium text-blue-600",children:E.tipologia_verifica_nome})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Priorit\xe0:"}),(0,i.jsx)("span",{className:"font-medium px-2 py-1 rounded text-xs ".concat("urgente"===E.priorita?"bg-red-100 text-red-800":"alta"===E.priorita?"bg-orange-100 text-orange-800":"media"===E.priorita?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:E.priorita})]}),E.assegnato_a&&(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Assegnato a:"}),(0,i.jsx)("span",{className:"font-medium text-blue-600",children:E.assegnato_a})]})]})]}),(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400",children:(0,i.jsxs)("div",{className:"flex items-start",children:[(0,i.jsx)("div",{className:"text-blue-400 mr-2",children:"ℹ️"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-blue-800 font-medium",children:"Prossimi passi:"}),(0,i.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:E.assegnato_a?"Il sopralluoghista ricever\xe0 una notifica e potr\xe0 iniziare la lavorazione.":"Assegna la lavorazione a un sopralluoghista dalla lista lavorazioni."})]})]})})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,i.jsx)("button",{onClick:()=>{S(!1),k(null)},className:"px-6 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Chiudi"}),(0,i.jsx)("button",{onClick:()=>{S(!1),k(null),C(!0)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Crea Altra"})]})]})]})}),_&&T&&(0,i.jsx)(e=>{let{lavorazione:t}=e,a=e=>new Date(e).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=(e=>{switch(e){case"aperta":case"da_eseguire":return{icon:"\uD83D\uDD34",color:"bg-red-100 text-red-800",label:"DA ESEGUIRE"};case"in_corso":return{icon:"⏳",color:"bg-yellow-100 text-yellow-800",label:"IN CORSO"};case"completata":return{icon:"✅",color:"bg-green-100 text-green-800",label:"COMPLETATA"};case"riaperta":return{icon:"\uD83D\uDD04",color:"bg-orange-100 text-orange-800",label:"RIAPERTA"};default:return{icon:"\uD83D\uDCC4",color:"bg-gray-100 text-gray-800",label:"ALTRO"}}})(t.stato);return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,i.jsx)("div",{className:"bg-blue-600 text-white p-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-3xl mr-4",children:s.icon}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:t.titolo||t.descrizione}),(0,i.jsxs)("div",{className:"flex items-center mt-2",children:[(0,i.jsx)("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-white/20 text-white",children:s.label}),(0,i.jsxs)("span",{className:"ml-3 text-blue-100",children:["ID: ",t.id.substring(0,8),"..."]})]})]})]}),(0,i.jsx)("button",{onClick:()=>{A(!1),P(null)},className:"text-white hover:text-gray-200 text-2xl p-2",children:"✕"})]})}),(0,i.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-160px)]",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCCB Informazioni Principali"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsx)("span",{className:"font-medium text-gray-700",children:"Descrizione:"}),(0,i.jsx)("div",{className:"text-right max-w-sm",children:(0,i.jsx)("span",{className:"text-gray-900",children:t.descrizione})})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-medium text-gray-700",children:"Priorit\xe0:"}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs rounded-full font-medium ".concat("alta"===t.priorita?"bg-red-100 text-red-800":"media"===t.priorita?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:(t.priorita||"media").toUpperCase()})]})]})]}),t.condomini&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83C\uDFE2 Condominio"}),(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"font-semibold text-blue-900",children:t.condomini.nome}),t.condomini.indirizzo&&(0,i.jsxs)("div",{className:"text-blue-700 text-sm mt-1",children:["\uD83D\uDCCD ",t.condomini.indirizzo]})]})]}),t.users&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDC64 Assegnazione"}),(0,i.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,i.jsxs)("div",{className:"font-semibold text-green-900",children:[t.users.nome," ",t.users.cognome]}),(0,i.jsxs)("div",{className:"text-green-700 text-sm mt-1",children:["\uD83D\uDCE7 ",t.users.email]})]})]})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC5 Timeline"}),(0,i.jsxs)("div",{className:"space-y-3",children:[t.data_apertura&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Creazione"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:a(t.data_apertura)})]})]}),t.data_assegnazione&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Assegnazione"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:a(t.data_assegnazione)})]})]}),"completata"===t.stato&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Completamento"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Completata"})]})]})]})]}),t.allegati&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDD27 Tipologia"}),(0,i.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,i.jsx)("div",{className:"font-semibold text-yellow-900",children:(()=>{try{let e=JSON.parse(t.allegati);if("manutenzione"===e.tipologia||"riparazione"===e.tipologia||"verifica"===e.tipologia||"sicurezza"===e.tipologia||"pulizia"===e.tipologia)return"\uD83D\uDD34";return e.tipologia||"Altro"}catch(e){return"\uD83D\uDD34"}})()})})]}),t.note&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCDD Note"}),(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,i.jsx)("div",{className:"text-gray-800 whitespace-pre-wrap",children:"string"==typeof t.note?t.note:Array.isArray(t.note)?t.note.join("\n• "):"Nessuna nota disponibile"})})]}),"completata"===t.stato&&(0,i.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC4 Report"}),(0,i.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 text-center",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCCB"}),(0,i.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Report PDF Dettagliato"}),(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:"Scarica il report completo con tutti i dettagli della verifica"}),(0,i.jsx)("button",{onClick:()=>{let e=new B,a={id:t.id,titolo:t.titolo||t.descrizione,descrizione:t.descrizione,stato:t.stato,priorita:t.priorita||"media",data_apertura:t.data_apertura,data_completamento:t.data_completamento||void 0,condominio:t.condomini?{nome:t.condomini.nome,indirizzo:t.condomini.indirizzo||void 0}:void 0,utente:t.users?{nome:t.users.nome,cognome:t.users.cognome,email:t.users.email}:void 0,note:"string"==typeof t.note?t.note:Array.isArray(t.note)?t.note.join("\n"):void 0,allegati:t.allegati||void 0};e.downloadPDF(a)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\uD83D\uDCE5 Scarica Report PDF"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Report automatico con tutti i dettagli della verifica"})]})]})]})]})}),(0,i.jsx)("div",{className:"bg-gray-50 px-6 py-4 flex justify-end",children:(0,i.jsx)("button",{onClick:()=>{A(!1),P(null)},className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Chiudi"})})]})})},{lavorazione:T})]})}let Y=(0,h.default)(()=>Promise.all([a.e(52),a.e(791),a.e(621)]).then(a.bind(a,1621)),{loadableGenerated:{webpack:()=>[1621]},ssr:!1});function H(e){let{lavorazione:t,onClose:a}=e,s=e=>new Date(e).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),r=(e=>{switch(e){case"aperta":case"da_eseguire":return{icon:"\uD83D\uDD34",color:"bg-red-100 text-red-800",label:"DA ESEGUIRE",description:"Verifica da iniziare"};case"in_corso":return{icon:"⏳",color:"bg-yellow-100 text-yellow-800",label:"IN CORSO",description:"Verifica in fase di esecuzione"};case"riaperta":return{icon:"\uD83D\uDD04",color:"bg-orange-100 text-orange-800",label:"RIAPERTA",description:"Verifica da ricontrollare"};case"completata":return{icon:"✅",color:"bg-green-100 text-green-800",label:"COMPLETATA",description:"Verifica terminata con successo"};case"archiviata":return{icon:"\uD83D\uDCC1",color:"bg-gray-100 text-gray-800",label:"ARCHIVIATA",description:"Verifica archiviata"};default:return{icon:"\uD83D\uDCC4",color:"bg-gray-100 text-gray-800",label:"ALTRO",description:"Lavorazione generica"}}})(t.stato);return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,i.jsx)("div",{className:"bg-blue-600 text-white p-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-3xl mr-4",children:r.icon}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:t.titolo||t.descrizione}),(0,i.jsxs)("div",{className:"flex items-center mt-2",children:[(0,i.jsx)("span",{className:"px-3 py-1 text-sm font-medium rounded-full ".concat(r.color.replace("text-","text-white bg-").replace("bg-","bg-white/20 text-")),children:r.label}),(0,i.jsxs)("span",{className:"ml-3 text-blue-100",children:["ID: ",t.id.substring(0,8),"..."]})]})]})]}),(0,i.jsx)("button",{onClick:a,className:"text-white hover:text-gray-200 text-2xl p-2",children:"✕"})]})}),(0,i.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-160px)]",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCCB Informazioni Principali"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsx)("span",{className:"font-medium text-gray-700",children:"Descrizione:"}),(0,i.jsx)("div",{className:"text-right max-w-sm",children:(0,i.jsx)("span",{className:"text-gray-900",children:t.descrizione})})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-medium text-gray-700",children:"Stato:"}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(r.color),children:r.description})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-medium text-gray-700",children:"Priorit\xe0:"}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("alta"===t.priorita?"bg-red-100 text-red-800":"media"===t.priorita?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:(t.priorita||"media").toUpperCase()})]})]})]}),t.condomini&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83C\uDFE2 Condominio"}),(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("div",{className:"font-semibold text-blue-900",children:t.condomini.nome}),t.condomini.indirizzo&&(0,i.jsxs)("div",{className:"text-blue-700 text-sm mt-1",children:["\uD83D\uDCCD ",t.condomini.indirizzo]})]})]}),t.users&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDC64 Assegnazione"}),(0,i.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,i.jsxs)("div",{className:"font-semibold text-green-900",children:[t.users.nome," ",t.users.cognome]}),(0,i.jsxs)("div",{className:"text-green-700 text-sm mt-1",children:["\uD83D\uDCE7 ",t.users.email]})]})]})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC5 Timeline"}),(0,i.jsxs)("div",{className:"space-y-3",children:[t.data_apertura&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Creazione"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:s(t.data_apertura)})]})]}),t.data_assegnazione&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Assegnazione"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:s(t.data_assegnazione)})]})]}),"completata"===t.stato&&(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Completamento"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Completata"})]})]})]})]}),t.allegati&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDD27 Tipologia"}),(0,i.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,i.jsx)("div",{className:"font-semibold text-yellow-900",children:(()=>{try{let e=JSON.parse(t.allegati);if("manutenzione"===e.tipologia)return"Manutenzione Ordinaria";if("riparazione"===e.tipologia)return"Riparazione Urgente";if("verifica"===e.tipologia)return"Verifica Tecnica";if("sicurezza"===e.tipologia)return"Sicurezza e Conformit\xe0";if("pulizia"===e.tipologia)return"Pulizia Straordinaria";return e.tipologia||"Altro"}catch(e){return"Tipo non specificato"}})()})})]})]})]}),t.note&&(0,i.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCDD Note"}),(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,i.jsx)("div",{className:"text-gray-800 whitespace-pre-wrap",children:"string"==typeof t.note?t.note:Array.isArray(t.note)?t.note.join("\n• "):"Nessuna nota disponibile"})})]}),"completata"===t.stato&&(0,i.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC4 Report"}),(0,i.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 text-center",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCCB"}),(0,i.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Report PDF Dettagliato"}),(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:"Il report PDF con tutti i dettagli della verifica completata"}),(0,i.jsx)("button",{onClick:()=>{let e=new B,a={id:t.id,titolo:t.titolo||t.descrizione,descrizione:t.descrizione,stato:t.stato,priorita:t.priorita||"media",data_apertura:t.data_apertura,data_completamento:t.data_completamento||void 0,condominio:t.condomini?{nome:t.condomini.nome,indirizzo:t.condomini.indirizzo||void 0}:void 0,utente:t.users?{nome:t.users.nome,cognome:t.users.cognome,email:t.users.email}:void 0,note:"string"==typeof t.note?t.note:Array.isArray(t.note)?t.note.join("\n"):void 0,allegati:t.allegati||void 0};e.downloadPDF(a)},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\uD83D\uDCE5 Scarica Report PDF"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Report automatico con tutti i dettagli della verifica"})]})]})]}),(0,i.jsx)("div",{className:"bg-gray-50 px-6 py-4 flex justify-end",children:(0,i.jsx)("button",{onClick:a,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Chiudi"})})]})})}function W(){let{user:e}=l(),[t,a]=(0,s.useState)([]),[r,n]=(0,s.useState)(!0),[o,c]=(0,s.useState)(null),[d,m]=(0,s.useState)(null),[x,u]=(0,s.useState)(!1),[h,g]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),[v,j]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[N,w]=(0,s.useState)([]),[D,C]=(0,s.useState)(null),z=(0,s.useCallback)(async()=>{if(null==e?void 0:e.id){n(!0);try{let t=await fetch("/api/lavorazioni?utente=".concat(e.id)),i=await t.json();i.success?(console.log("Lavorazioni ricevute dall'API:",i.data.length),console.log("User ID corrente:",e.id),console.log("Prima lavorazione (sample):",i.data[0]),a(i.data)):c(i.error)}catch(e){c("Errore nel caricamento delle lavorazioni")}n(!1)}},[null==e?void 0:e.id]);(0,s.useEffect)(()=>{z()},[z]);let S=e=>{m(e),u(!0)},E=async e=>{try{let a=await fetch("/api/condomini"),i=await a.json();if(!i.success){alert("❌ Errore nel caricamento dei condomini");return}let s=i.data.find(t=>t.qr_code===e);if(!s){alert("❌ QR Code non riconosciuto. Assicurati di scansionare un QR code valido.");return}let r=t.filter(e=>e.condominio_id===s.id&&("aperta"===e.stato||"in_corso"===e.stato||"riaperta"===e.stato));if(0===r.length){alert('❌ Nessuna lavorazione aperta trovata per il condominio "'.concat(s.nome,'".\n\nVerifica che ti sia stata assegnata una lavorazione per questo condominio.'));return}j(!1),1===r.length?S(r[0]):(C(s),w(r),y(!0))}catch(e){console.error("Errore durante la ricerca della lavorazione:",e),alert("❌ Errore durante la ricerca della lavorazione")}},k=e=>{b(e),g(!0)},_=e=>{switch(e){case"aperta":case"da_eseguire":return{icon:"\uD83D\uDCCB",color:"bg-blue-100 text-blue-800",label:"DA ESEGUIRE",description:"Nuova verifica da completare"};case"in_corso":return{icon:"⏳",color:"bg-yellow-100 text-yellow-800",label:"IN CORSO",description:"Verifica in fase di esecuzione"};case"riaperta":return{icon:"\uD83D\uDD04",color:"bg-orange-100 text-orange-800",label:"RIAPERTA",description:"Verifica da ricontrollare"};case"completata":return{icon:"✅",color:"bg-green-100 text-green-800",label:"COMPLETATA",description:"Verifica terminata con successo"};case"archiviata":return{icon:"\uD83D\uDCC1",color:"bg-gray-100 text-gray-800",label:"ARCHIVIATA",description:"Verifica archiviata"};default:return{icon:"\uD83D\uDCC4",color:"bg-gray-100 text-gray-800",label:"ALTRO",description:"Lavorazione generica"}}},A=e=>new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),T=t.filter(e=>"aperta"===e.stato||"in_corso"===e.stato||"riaperta"===e.stato),I=t.filter(e=>"completata"===e.stato),O={totali:t.length,da_eseguire:t.filter(e=>"da_eseguire"===e.stato).length,in_corso:t.filter(e=>"in_corso"===e.stato).length,completate:t.filter(e=>"completata"===e.stato).length,riaperte:t.filter(e=>"riaperta"===e.stato).length};return r?(0,i.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento lavorazioni..."})]}):x&&d?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["Verifica: ",d.descrizione]}),(0,i.jsx)("button",{onClick:()=>{u(!1),m(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md",children:"← Torna alle lavorazioni"})]}),(0,i.jsx)(P,{lavorazione:d,onLavorazioneComplete:e=>{z(),m(null),u(!1)},onBack:()=>{m(null),u(!1)}})]}):(0,i.jsxs)("div",{className:"space-y-6",children:[v&&(0,i.jsx)(Y,{onScan:E,onClose:()=>j(!1)}),(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"\uD83D\uDC77 Pannello Sopralluoghista"}),(0,i.jsxs)("p",{className:"text-gray-600",children:["Benvenuto ",(0,i.jsxs)("strong",{children:[null==e?void 0:e.nome," ",null==e?void 0:e.cognome]}),"! Qui trovi tutte le verifiche assegnate da completare."]})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:()=>j(!0),className:"bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white px-6 py-2 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center gap-2 font-medium",title:"Scansiona QR Code per aprire verifica",children:"\uD83D\uDCF7 Scansiona QR"}),(0,i.jsx)("button",{onClick:async()=>{if(window.confirm("Sei sicuro di voler pulire tutte le notifiche lette? Questa azione non pu\xf2 essere annullata."))try{if((await fetch("/api/notifications/cleanup?userId=".concat(null==e?void 0:e.id),{method:"POST"})).ok)alert("✅ Notifiche pulite con successo!"),window.location.reload();else throw Error("Errore durante la pulizia")}catch(e){console.error("Errore pulizia notifiche:",e),alert("❌ Errore durante la pulizia delle notifiche")}},className:"bg-orange-100 hover:bg-orange-200 text-orange-800 px-4 py-2 rounded-lg transition-colors text-sm font-medium flex items-center gap-2",title:"Elimina tutte le notifiche lette",children:"\uD83E\uDDF9 Pulisci Notifiche"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:O.totali}),(0,i.jsx)("div",{className:"text-blue-800 text-sm",children:"Totali"})]}),(0,i.jsx)("div",{className:"text-blue-400 text-2xl",children:"\uD83D\uDCCA"})]})}),(0,i.jsx)("div",{className:"bg-indigo-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:O.da_eseguire}),(0,i.jsx)("div",{className:"text-indigo-800 text-sm",children:"Da Eseguire"})]}),(0,i.jsx)("div",{className:"text-indigo-400 text-2xl",children:"\uD83D\uDCCB"})]})}),(0,i.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:O.in_corso}),(0,i.jsx)("div",{className:"text-yellow-800 text-sm",children:"In Corso"})]}),(0,i.jsx)("div",{className:"text-yellow-400 text-2xl",children:"⏳"})]})}),(0,i.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-green-600",children:O.completate}),(0,i.jsx)("div",{className:"text-green-800 text-sm",children:"Completate"})]}),(0,i.jsx)("div",{className:"text-green-400 text-2xl",children:"✅"})]})}),(0,i.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:O.riaperte}),(0,i.jsx)("div",{className:"text-orange-800 text-sm",children:"Riaperte"})]}),(0,i.jsx)("div",{className:"text-orange-400 text-2xl",children:"\uD83D\uDD04"})]})})]}),o&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"text-red-600",children:["❌ ",o]})}),(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["\uD83D\uDD27 Le mie lavorazioni (",T.length,")"]}),0===T.length?(0,i.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Nessuna lavorazione da completare"}),(0,i.jsx)("p",{children:"Al momento non hai verifiche in sospeso."}),(0,i.jsx)("p",{className:"text-sm mt-2",children:"Le nuove lavorazioni appariranno qui quando verranno assegnate dall'amministratore."})]}):(0,i.jsx)("div",{className:"space-y-4",children:T.map(e=>{let t=_(e.stato);return(0,i.jsx)("div",{className:"bg-white border rounded-lg p-6 hover:shadow-md transition-shadow",children:(0,i.jsx)("div",{className:"flex items-start justify-between",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:t.icon}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.color),children:t.label})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.substring(0,8),"..."]})]}),(0,i.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.titolo||e.descrizione}),e.titolo&&e.descrizione&&e.titolo!==e.descrizione&&(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.descrizione}),e.condomini&&(0,i.jsxs)("div",{className:"bg-blue-50 p-2 rounded mb-3",children:[(0,i.jsx)("strong",{children:"\uD83C\uDFE2 Condominio:"})," ",e.condomini.nome,e.condomini.indirizzo&&(0,i.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["\uD83D\uDCCD ",e.condomini.indirizzo]})]}),e.users&&(0,i.jsxs)("div",{className:"bg-green-50 p-2 rounded mb-3",children:[(0,i.jsx)("strong",{children:"\uD83D\uDC64 Assegnato a:"})," ",e.users.nome," ",e.users.cognome,(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["\uD83D\uDCE7 ",e.users.email]})]}),e.allegati&&(0,i.jsxs)("div",{className:"bg-yellow-50 p-2 rounded mb-3",children:[(0,i.jsx)("strong",{children:"\uD83D\uDD27 Tipo:"})," ",(()=>{try{let t=JSON.parse(e.allegati);if("manutenzione"===t.tipologia)return"Manutenzione Ordinaria";if("riparazione"===t.tipologia)return"Riparazione Urgente";if("verifica"===t.tipologia)return"Verifica Tecnica";if("sicurezza"===t.tipologia)return"Sicurezza e Conformit\xe0";if("pulizia"===t.tipologia)return"Pulizia Straordinaria";return t.tipologia||"Altro"}catch(e){return"Altro"}})()]}),(0,i.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDCC5 Aperta:"})," ",A(e.data_apertura)]}),e.data_scadenza&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"⏰ Scadenza:"})," ",A(e.data_scadenza)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Assegnata:"})," ",e.data_assegnazione?A(e.data_assegnazione):A(e.data_apertura)]})]}),e.note&&(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md mb-3",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Note:"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"string"==typeof e.note?e.note:Array.isArray(e.note)?e.note.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-start mb-1",children:[(0,i.jsx)("span",{className:"text-blue-500 mr-2",children:"•"}),e]},t)):"Nessuna nota disponibile"})]}),(0,i.jsx)("div",{className:"pt-4 border-t border-gray-100",children:(0,i.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,i.jsx)("button",{onClick:()=>k(e),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium",children:"\uD83D\uDC41️ Dettagli"}),(0,i.jsx)("button",{onClick:()=>S(e),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"in_corso"===e.stato?"\uD83D\uDD04 Continua":"▶️ Inizia"})]})})]})})},e.id)})})]})}),(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["✅ Lavorazioni completate (",I.length,")"]}),0===I.length?(0,i.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"✅"}),(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Nessuna lavorazione completata"}),(0,i.jsx)("p",{children:"Le lavorazioni completate appariranno qui."})]}):(0,i.jsx)("div",{className:"space-y-4",children:I.map(e=>{let t=_(e.stato);return(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:(0,i.jsx)("div",{className:"flex items-start justify-between",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:t.icon}),(0,i.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.color),children:t.label})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.substring(0,8),"..."]})]}),(0,i.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.titolo||e.descrizione}),e.titolo&&e.descrizione&&e.titolo!==e.descrizione&&(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.descrizione}),e.condomini&&(0,i.jsxs)("div",{className:"bg-white p-2 rounded mb-3",children:[(0,i.jsx)("strong",{children:"\uD83C\uDFE2 Condominio:"})," ",e.condomini.nome,e.condomini.indirizzo&&(0,i.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["\uD83D\uDCCD ",e.condomini.indirizzo]})]}),e.note&&(0,i.jsxs)("div",{className:"bg-white p-2 rounded mb-3",children:[(0,i.jsx)("strong",{children:"\uD83D\uDCDD Note:"}),(0,i.jsx)("div",{className:"text-sm text-gray-600 mt-1 whitespace-pre-wrap",children:e.note})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 mb-4",children:[e.data_apertura&&(0,i.jsxs)("div",{children:["\uD83D\uDCC5 Aperta: ",A(e.data_apertura)]}),(0,i.jsx)("div",{children:"✅ Completata"})]}),(0,i.jsx)("div",{className:"pt-3 border-t border-green-200",children:(0,i.jsx)("button",{onClick:()=>k(e),className:"w-full px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium",children:"\uD83D\uDC41️ Visualizza Dettagli Completi"})})]})})},e.id)})})]})}),h&&p&&(0,i.jsx)(H,{lavorazione:p,onClose:()=>{g(!1),b(null)}}),f&&D&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[(0,i.jsx)("div",{className:"sticky top-0 bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-6 rounded-t-lg",children:(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-2xl font-bold mb-2",children:["\uD83C\uDFE2 ",D.nome]}),(0,i.jsx)("p",{className:"text-purple-100 text-sm",children:D.indirizzo||"Indirizzo non specificato"}),(0,i.jsxs)("p",{className:"text-white mt-3 font-medium",children:["\uD83D\uDCCB ",N.length," lavorazion",1===N.length?"e":"i"," aperte"]})]}),(0,i.jsx)("button",{onClick:()=>{y(!1),w([]),C(null)},className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors",children:(0,i.jsx)("span",{className:"text-2xl leading-none",children:"\xd7"})})]})}),(0,i.jsxs)("div",{className:"p-6 space-y-4",children:[(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:"Seleziona la lavorazione da iniziare:"}),N.map(e=>{let t=_(e.stato);return(0,i.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-4 hover:border-indigo-500 hover:shadow-md transition-all cursor-pointer",onClick:()=>{y(!1),w([]),C(null),S(e)},children:[(0,i.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(t.color),children:[t.icon," ",t.label]}),e.priorita&&(0,i.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("alta"===e.priorita?"bg-red-100 text-red-700":"media"===e.priorita?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:"alta"===e.priorita?"\uD83D\uDD34 Alta":"media"===e.priorita?"\uD83D\uDFE1 Media":"⚪ Bassa"})]}),(0,i.jsx)("h4",{className:"font-semibold text-gray-900 mb-1",children:e.titolo||e.descrizione}),e.descrizione&&e.titolo!==e.descrizione&&(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.descrizione})]})}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500",children:[e.data_apertura&&(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{children:"\uD83D\uDCC5"}),(0,i.jsxs)("span",{children:["Aperta: ",A(e.data_apertura)]})]}),e.data_scadenza&&(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{children:"⏰"}),(0,i.jsxs)("span",{children:["Scadenza: ",new Date(e.data_scadenza).toLocaleDateString("it-IT")]})]})]}),(0,i.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,i.jsx)("button",{className:"text-indigo-600 hover:text-indigo-800 font-medium text-sm flex items-center gap-1",children:"▶️ Inizia Verifica"})})]},e.id)})]}),(0,i.jsx)("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 rounded-b-lg border-t border-gray-200",children:(0,i.jsx)("button",{onClick:()=>{y(!1),w([]),C(null)},className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Annulla"})})]})}),x&&d&&(0,i.jsx)(P,{lavorazione:d,onBack:()=>{u(!1),m(null)},onLavorazioneComplete:()=>{u(!1),m(null),z()}})]})}function Q(e){let{nota:t,isOpen:a,onClose:r,onSave:n,mode:o}=e,[c,d]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[u,h]=(0,s.useState)(!1),{user:g}=l();(0,s.useEffect)(()=>{t&&("edit"===o||"view"===o)?(d(t.titolo),x(t.contenuto)):"create"===o&&(d(""),x(""))},[t,o,a]);let p=async()=>{if(!c.trim()||!m.trim()){alert("Titolo e contenuto sono obbligatori");return}h(!0);try{let e="create"===o?"/api/note":"/api/note/".concat(null==t?void 0:t.id),a=await fetch(e,{method:"create"===o?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({utente_id:null==g?void 0:g.id,titolo:c.trim(),contenuto:m.trim()})}),i=await a.json();i.success?(n(),r()):alert(i.error||"Errore nel salvataggio della nota")}catch(e){console.error("Errore salvataggio nota:",e),alert("Errore nel salvataggio della nota")}finally{h(!1)}};if(!a)return null;let b="view"===o,v="create"===o;return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,i.jsx)("div",{className:"bg-blue-600 text-white p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("h2",{className:"text-xl font-bold flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDCDD"}),v?"Nuova Nota":b?"Visualizza Nota":"Modifica Nota"]}),(0,i.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200 text-xl",children:"✕"})]})}),(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titolo *"}),(0,i.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),disabled:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(b?"bg-gray-50":""),placeholder:"Inserisci un titolo per la nota...",maxLength:255})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contenuto *"}),(0,i.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),disabled:b,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(b?"bg-gray-50":""),rows:8,placeholder:"Scrivi qui il contenuto della nota..."})]}),t&&(0,i.jsxs)("div",{className:"text-sm text-gray-500 border-t pt-4",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Creata:"})," ",new Date(t.data_creazione).toLocaleString()]}),t.data_modifica!==t.data_creazione&&(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Modificata:"})," ",new Date(t.data_modifica).toLocaleString()]})]})]})}),(0,i.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:[(0,i.jsx)("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:b?"Chiudi":"Annulla"}),!b&&(0,i.jsx)("button",{onClick:p,disabled:u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvataggio..."]}):(0,i.jsx)(i.Fragment,{children:"\uD83D\uDCBE Salva"})})]})]})})}function K(){let{user:e}=l(),[t,a]=(0,s.useState)([]),[r,n]=(0,s.useState)(!0),[o,c]=(0,s.useState)({isOpen:!1,mode:"create"});(0,s.useEffect)(()=>{(null==e?void 0:e.id)&&d()},[null==e?void 0:e.id]);let d=async()=>{if(null==e?void 0:e.id){n(!0);try{let t=await fetch("/api/note?utente_id=".concat(e.id)),i=await t.json();i.success?a(i.data||[]):console.error("Errore caricamento note:",i.error)}catch(e){console.error("Errore caricamento note:",e)}finally{n(!1)}}},m=async t=>{if(confirm("Sei sicuro di voler eliminare questa nota?"))try{let a=await fetch("/api/note/".concat(t,"?utente_id=").concat(null==e?void 0:e.id),{method:"DELETE"}),i=await a.json();i.success?await d():alert(i.error||"Errore nell'eliminazione della nota")}catch(e){console.error("Errore eliminazione nota:",e),alert("Errore nell'eliminazione della nota")}},x=(e,t)=>{c({isOpen:!0,mode:e,nota:t})};return r?(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,i.jsxs)("div",{className:"p-8 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-500",children:"Caricamento note..."})]})}):(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,i.jsx)("div",{className:"border-b border-gray-200 p-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,i.jsx)("span",{className:"mr-3",children:"\uD83D\uDCDD"}),"Note Personali"]}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestisci le tue note personali e promemoria"})]}),(0,i.jsxs)("button",{onClick:()=>x("create"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"+"}),"Nuova Nota"]})]})}),(0,i.jsx)("div",{className:"p-6",children:0===t.length?(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCDD"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna nota personale"}),(0,i.jsx)("p",{className:"text-gray-500 mb-6",children:"Inizia creando la tua prima nota per tenere traccia di promemoria e informazioni importanti."}),(0,i.jsx)("button",{onClick:()=>x("create"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Crea Prima Nota"})]}):(0,i.jsx)("div",{className:"grid gap-4",children:t.map(e=>(0,i.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.titolo}),(0,i.jsx)("p",{className:"text-gray-600 mb-3 line-clamp-3",children:e.contenuto.length>150?"".concat(e.contenuto.substring(0,150),"..."):e.contenuto}),(0,i.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,i.jsxs)("span",{children:["\uD83D\uDCC5 ",new Date(e.data_creazione).toLocaleDateString()]}),e.data_modifica!==e.data_creazione&&(0,i.jsxs)("span",{className:"ml-4",children:["✏️ Modificata ",new Date(e.data_modifica).toLocaleDateString()]})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,i.jsx)("button",{onClick:()=>x("view",e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Visualizza",children:"\uD83D\uDC41️"}),(0,i.jsx)("button",{onClick:()=>x("edit",e),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded",title:"Modifica",children:"✏️"}),(0,i.jsx)("button",{onClick:()=>m(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Elimina",children:"\uD83D\uDDD1️"})]})]})},e.id))})}),(0,i.jsx)(Q,{nota:o.nota,isOpen:o.isOpen,onClose:()=>{c({isOpen:!1,mode:"create"})},onSave:d,mode:o.mode})]})}function Z(e){let{isOpen:t,onClose:a,onSuccess:r}=e,[n,o]=(0,s.useState)({vecchiaPassword:"",nuovaPassword:"",confermaPassword:""}),[c,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)([]),{user:u}=l(),h=()=>{o({vecchiaPassword:"",nuovaPassword:"",confermaPassword:""}),x([])},g=e=>{let t=[];return e.length<8&&t.push("La password deve essere di almeno 8 caratteri"),/(?=.*[a-z])/.test(e)||t.push("Deve contenere almeno una lettera minuscola"),/(?=.*[A-Z])/.test(e)||t.push("Deve contenere almeno una lettera maiuscola"),/(?=.*\d)/.test(e)||t.push("Deve contenere almeno un numero"),t},p=async e=>{e.preventDefault();let t=[];if(n.vecchiaPassword||t.push("La password attuale \xe8 obbligatoria"),n.nuovaPassword?t.push(...g(n.nuovaPassword)):t.push("La nuova password \xe8 obbligatoria"),n.nuovaPassword!==n.confermaPassword&&t.push("Le password non corrispondono"),n.vecchiaPassword===n.nuovaPassword&&t.push("La nuova password deve essere diversa da quella attuale"),t.length>0){x(t);return}d(!0);try{let e=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:null==u?void 0:u.id,vecchiaPassword:n.vecchiaPassword,nuovaPassword:n.nuovaPassword})}),t=await e.json();t.success?(h(),r(),a()):x([t.error||"Errore nel cambio password"])}catch(e){console.error("Errore cambio password:",e),x(["Errore di connessione"])}finally{d(!1)}},b=()=>{h(),a()};return t?(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,i.jsx)("div",{className:"bg-blue-600 text-white p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("h2",{className:"text-xl font-bold flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDD10"}),"Cambia Password"]}),(0,i.jsx)("button",{onClick:b,className:"text-white hover:text-gray-200 text-xl",children:"✕"})]})}),(0,i.jsxs)("form",{onSubmit:p,className:"p-6",children:[m.length>0&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,i.jsx)("div",{className:"text-red-800 text-sm",children:(0,i.jsx)("ul",{className:"list-disc list-inside space-y-1",children:m.map((e,t)=>(0,i.jsx)("li",{children:e},t))})})}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"vecchia-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password Attuale *"}),(0,i.jsx)("input",{id:"vecchia-password",type:"password",value:n.vecchiaPassword,onChange:e=>o(t=>({...t,vecchiaPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Inserisci la password attuale","aria-describedby":"vecchia-password-help",title:"Inserisci la tua password attuale"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"nuova-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nuova Password *"}),(0,i.jsx)("input",{id:"nuova-password",type:"password",value:n.nuovaPassword,onChange:e=>o(t=>({...t,nuovaPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Inserisci la nuova password","aria-describedby":"nuova-password-help",title:"Inserisci la nuova password (min 8 caratteri, maiuscole, minuscole e numeri)"}),(0,i.jsx)("div",{id:"nuova-password-help",className:"text-xs text-gray-500 mt-1",children:"Min 8 caratteri, maiuscole, minuscole e numeri"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"conferma-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Conferma Nuova Password *"}),(0,i.jsx)("input",{id:"conferma-password",type:"password",value:n.confermaPassword,onChange:e=>o(t=>({...t,confermaPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Conferma la nuova password",title:"Conferma inserendo nuovamente la nuova password"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,i.jsx)("button",{type:"button",onClick:b,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Annulla"}),(0,i.jsx)("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Aggiornando..."]}):(0,i.jsx)(i.Fragment,{children:"\uD83D\uDD10 Aggiorna Password"})})]})]})]})}):null}let X=e=>{if(!e)return"Data non disponibile";try{let t=new Date(e),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(s,"/").concat(i,"/").concat(a)}catch(e){return"Data non valida"}},$=e=>{if(!e)return"Data non disponibile";try{let t=new Date(e),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return"".concat(s,"/").concat(i,"/").concat(a," ").concat(r,":").concat(n)}catch(e){return"Data non valida"}};function ee(){let{user:e}=l(),[t,a]=(0,s.useState)(null),[r,n]=(0,s.useState)(!0),[o,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)(""),[x,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{u(!0)},[]),(0,s.useEffect)(()=>{x&&(null==e?void 0:e.id)&&h()},[x,null==e?void 0:e.id]);let h=async()=>{if(null==e?void 0:e.id){n(!0);try{let t=await fetch("/api/users/".concat(e.id)),i=await t.json();i.success?a(i.data):console.error("Errore caricamento utente:",i.error)}catch(e){console.error("Errore caricamento utente:",e)}finally{n(!1)}}};return x&&!r&&t?t.id&&t.username&&t.email?(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,i.jsx)("div",{className:"border-b border-gray-200 p-6",children:(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,i.jsx)("span",{className:"mr-3",children:"⚙️"}),"Impostazioni Account"]}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestisci le informazioni del tuo profilo"})]})})}),d&&(0,i.jsx)("div",{className:"m-6 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,i.jsxs)("div",{className:"text-green-800 text-sm flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"✅"}),d]})}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informazioni Personali"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-nome",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome"}),(0,i.jsx)("input",{id:"user-nome",type:"text",value:t.nome||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Nome dell'utente (sola lettura)",placeholder:"Nome non disponibile"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-cognome",className:"block text-sm font-medium text-gray-700 mb-2",children:"Cognome"}),(0,i.jsx)("input",{id:"user-cognome",type:"text",value:t.cognome||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Cognome dell'utente (sola lettura)",placeholder:"Cognome non disponibile"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,i.jsx)("input",{id:"user-email",type:"email",value:t.email||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Indirizzo email dell'utente (sola lettura)",placeholder:"Email non disponibile"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-telefono",className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefono"}),(0,i.jsx)("input",{id:"user-telefono",type:"tel",value:t.telefono||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Numero di telefono dell'utente (sola lettura)",placeholder:"Telefono non disponibile"})]})]})]})}),(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informazioni Account"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),(0,i.jsx)("input",{id:"user-username",type:"text",value:t.username||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Nome utente (sola lettura)",placeholder:"Username non disponibile"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-ruolo",className:"block text-sm font-medium text-gray-700 mb-2",children:"Ruolo"}),(0,i.jsx)("input",{id:"user-ruolo",type:"text",value:(e=>{switch(e){case"admin":return"Amministratore";case"sopralluoghista":return"Sopralluoghista";default:return e}})(t.role||""),readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Ruolo dell'utente nel sistema (sola lettura)",placeholder:"Ruolo non disponibile"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stato Account"}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)("span",{className:"px-3 py-1 rounded-full text-sm ".concat(t.attivo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.attivo?"\uD83D\uDFE2 Attivo":"\uD83D\uDD34 Disattivato"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-created",className:"block text-sm font-medium text-gray-700 mb-2",children:"Registrato il"}),(0,i.jsx)("input",{id:"user-created",type:"text",value:X(t.created_at||""),readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Data di registrazione dell'account (sola lettura)",placeholder:"Data non disponibile"})]}),t.last_login&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"user-last-login",className:"block text-sm font-medium text-gray-700 mb-2",children:"Ultimo accesso"}),(0,i.jsx)("input",{id:"user-last-login",type:"text",value:$(t.last_login),readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",title:"Data e ora dell'ultimo accesso (sola lettura)",placeholder:"Ultimo accesso non disponibile"})]})]})]})})]}),(0,i.jsxs)("div",{className:"border-t border-gray-200 pt-6 mt-8",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sicurezza"}),(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900",children:"Password"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"Cambia la password del tuo account per mantenere sicuro l'accesso"})]}),(0,i.jsxs)("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center",children:[(0,i.jsx)("span",{className:"mr-2",children:"\uD83D\uDD10"}),"Cambia Password"]})]})})]}),(0,i.jsx)("div",{className:"border-t border-gray-200 pt-6 mt-8",children:(0,i.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-start",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("span",{className:"text-2xl",children:"ℹ️"})}),(0,i.jsxs)("div",{className:"ml-3",children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-blue-900",children:"Informazioni sui dati"}),(0,i.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,i.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,i.jsx)("li",{children:"I dati personali possono essere modificati solo dall'amministratore"}),(0,i.jsx)("li",{children:"\xc8 possibile cambiare autonomamente solo la password"}),(0,i.jsx)("li",{children:"Per modifiche ai dati personali, contatta l'amministratore"})]})})]})]})})})]}),(0,i.jsx)(Z,{isOpen:o,onClose:()=>c(!1),onSuccess:()=>{m("Password aggiornata con successo!"),setTimeout(()=>m(""),5e3)}})]}):(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,i.jsxs)("div",{className:"p-8 text-center",children:[(0,i.jsx)("div",{className:"text-red-500 mb-2",children:"⚠️"}),(0,i.jsx)("p",{className:"text-gray-500",children:"Errore nel caricamento dei dati utente"})]})}):(0,i.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,i.jsxs)("div",{className:"p-8 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-500",children:"Caricamento impostazioni..."})]})})}function et(e){let{onNavigate:t}=e,[a,r]=(0,s.useState)({condomini:{totali:0,attivi:0,inattivi:0},tipologie:{totali:0,attive:0,inattive:0},verifiche:{totali:0,verificheCompletate:0,inCorso:0,scadute:0},lavorazioni:{totali:0,da_eseguire:0,in_corso:0,completate:0}}),[n,l]=(0,s.useState)(!0),[o,c]=(0,s.useState)(Date.now()),d=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&l(!0);try{let e=await fetch("/api/dashboard/stats?t=".concat(Date.now())),t=await e.json();t.success&&(r({condomini:{totali:t.data.totali.condomini,attivi:t.data.totali.condomini,inattivi:0},tipologie:{totali:t.data.totali.tipologie,attive:t.data.totali.tipologie,inattive:0},verifiche:{totali:t.data.totali.verifiche,verificheCompletate:t.data.lavorazioni.completate||0,inCorso:t.data.lavorazioni.in_corso||0,scadute:0},lavorazioni:{totali:t.data.lavorazioni.totali,da_eseguire:t.data.lavorazioni.da_eseguire,in_corso:t.data.lavorazioni.in_corso,completate:t.data.lavorazioni.completate}}),c(Date.now()))}catch(e){console.error("Errore nel caricamento delle statistiche:",e)}finally{l(!1)}};return((0,s.useEffect)(()=>{d(!0);let e=setInterval(()=>{d(!1)},3e4),t=()=>{console.log("\uD83D\uDD04 Dashboard: Refresh statistiche richiesto"),d(!1)};return window.addEventListener("refreshStats",t),window.addEventListener("focus",t),()=>{clearInterval(e),window.removeEventListener("refreshStats",t),window.removeEventListener("focus",t)}},[]),n)?(0,i.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,i.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"}),(0,i.jsx)("span",{className:"ml-3 text-gray-600",children:"Caricamento statistiche..."})]}):(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Dashboard"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,i.jsx)("div",{className:"bg-blue-50 p-6 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-blue-800",children:"Condomini Attivi"}),(0,i.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:n?"...":a.condomini.attivi})]}),(0,i.jsx)("div",{className:"text-blue-400 text-3xl",children:"\uD83C\uDFE2"})]})}),(0,i.jsx)("div",{className:"bg-green-50 p-6 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-green-800",children:"Verifiche Completate"}),(0,i.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-2",children:a.verifiche.verificheCompletate})]}),(0,i.jsx)("div",{className:"text-green-400 text-3xl",children:"✅"})]})}),(0,i.jsx)("div",{className:"bg-yellow-50 p-6 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-yellow-800",children:"In Corso"}),(0,i.jsx)("p",{className:"text-3xl font-bold text-yellow-600 mt-2",children:a.verifiche.inCorso})]}),(0,i.jsx)("div",{className:"text-yellow-400 text-3xl",children:"⏳"})]})}),(0,i.jsx)("div",{className:"bg-red-50 p-6 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Scadute"}),(0,i.jsx)("p",{className:"text-3xl font-bold text-red-600 mt-2",children:a.verifiche.scadute})]}),(0,i.jsx)("div",{className:"text-red-400 text-3xl",children:"⚠️"})]})})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Condomini Recenti",(0,i.jsx)("span",{className:"ml-2 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:a.condomini.totali})]}),n?(0,i.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,i.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,i.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,i.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]}):a.condomini.totali>0?(0,i.jsxs)("div",{className:"p-4 text-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a.condomini.totali}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"condomini registrati"})]}):(0,i.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Nessun condominio presente"})]}),(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Azioni Rapide"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("button",{onClick:()=>null==t?void 0:t("condomini"),className:"w-full text-left p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:"\uD83C\uDFE2"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:"Nuovo Condominio"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Aggiungi un nuovo condominio al sistema"})]})]})}),(0,i.jsx)("button",{onClick:()=>null==t?void 0:t("verifiche"),className:"w-full text-left p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:"✅"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:"Nuova Verifica"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Avvia il wizard per una nuova verifica"})]})]})}),(0,i.jsx)("button",{onClick:()=>null==t?void 0:t("tipologie"),className:"w-full text-left p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:"\uD83D\uDCCB"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:"Tipologie Verifiche"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Gestisci le tipologie di verifica"})]})]})}),(0,i.jsx)("button",{onClick:()=>null==t?void 0:t("admin"),className:"w-full text-left p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:"⚙️"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-gray-900",children:"Pannello Admin"}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Gestisci lavorazioni e riapri verifiche"})]})]})})]})]})]})]})}function ea(e){let{userId:t}=e,[a,r]=(0,s.useState)([]),[n,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),[d,m]=(0,s.useState)(!1),x=function(e){let[t,a]=(0,s.useState)({supported:!1,permission:null,subscription:null,loading:!1,error:null});(0,s.useEffect)(()=>{(async()=>{if(!("serviceWorker"in navigator)||!("PushManager"in window)){a(e=>({...e,supported:!1,error:"Push notifications non supportate in questo browser"}));return}a(e=>({...e,supported:!0})),"Notification"in window&&a(e=>({...e,permission:Notification.permission}));try{let e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();t&&a(e=>({...e,subscription:t,permission:Notification.permission}))}catch(e){console.error("❌ Errore verifica subscription esistente:",e)}})()},[]);let i=(0,s.useCallback)(async()=>{if(console.log("\uD83D\uDD14 Avvio richiesta permessi push..."),!t.supported)return a(e=>({...e,error:"Push notifications non supportate"})),!1;if(!e)return a(e=>({...e,error:"utenteId richiesto per registrazione"})),!1;a(e=>({...e,loading:!0,error:null}));try{console.log("\uD83D\uDCF1 Richiesta permesso notifiche...");let t=await Notification.requestPermission();if(console.log("✅ Permesso ricevuto:",t),a(e=>({...e,permission:t})),"granted"!==t)return a(e=>({...e,loading:!1,error:"Permesso negato dall'utente"})),!1;console.log("\uD83D\uDD27 Registrazione Service Worker...");let i=await navigator.serviceWorker.register("/sw.js");await navigator.serviceWorker.ready,console.log("✅ Service Worker registrato");let s="BEgt6QRk8jPs4Mqdn4rYSZrwrW9DjNItnlK11RUdptbAyPG069ciX-MyLS9PAbOkb1Li-6CcybHWAXst2Xz_66A";if(console.log("\uD83D\uDD11 VAPID Key presente:",!!s),!s)throw Error("VAPID public key non configurata - controlla variabili ambiente su Vercel");let r=function(e){let t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(a),s=new Uint8Array(i.length);for(let e=0;e<i.length;++e)s[e]=i.charCodeAt(e);return s}(s);console.log("\uD83D\uDCDD Creazione subscription...");let n=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r});console.log("✅ Push subscription creata:",n.endpoint),console.log("\uD83D\uDCBE Salvataggio subscription su DB...");let l=await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:n.toJSON(),utenteId:e})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error("Errore salvataggio subscription: ".concat(e.error||l.statusText))}let o=await l.json();return console.log("✅ Subscription salvata su DB:",o),a(e=>({...e,subscription:n,loading:!1,permission:"granted"})),!0}catch(e){return console.error("❌ Errore registrazione push notification:",e),a(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Errore sconosciuto"})),!1}},[t.supported,e]),r=(0,s.useCallback)(async()=>{if(!t.subscription)return!0;a(e=>({...e,loading:!0,error:null}));try{return await t.subscription.unsubscribe(),await fetch("/api/push/subscribe",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:t.subscription.endpoint})}),a(e=>({...e,subscription:null,loading:!1})),console.log("\uD83D\uDDD1️ Push subscription rimossa"),!0}catch(e){return console.error("❌ Errore rimozione subscription:",e),a(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Errore rimozione"})),!1}},[t.subscription]);return{...t,requestPermission:i,unsubscribe:r,isSubscribed:!!t.subscription&&"granted"===t.permission}}(t);(0,s.useEffect)(()=>{if(!t)return;console.log("\uD83D\uDD17 NotificationCenter: Avvio SSE per user ".concat(t));let e=new EventSource("/api/notifications/stream?userId=".concat(t));return e.onopen=()=>{console.log("✅ NotificationCenter: SSE connesso"),m(!0)},e.onmessage=e=>{try{let t=JSON.parse(e.data);if(console.log("\uD83D\uDCE8 NotificationCenter: Messaggio SSE ricevuto:",t.type),"notification"===t.type||"existing_notification"===t.type){let e=t.data.notifica;e.letta||r(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,...e,data_creazione:e.data_creazione,stato:"non_letta"}:t):[{id:e.id,titolo:e.titolo,messaggio:e.messaggio,tipo:e.tipo,priorita:e.priorita,data_creazione:e.data_creazione,stato:"non_letta"},...t])}}catch(e){console.error("❌ NotificationCenter: Errore parsing SSE:",e)}},e.onerror=e=>{console.error("❌ NotificationCenter: Errore SSE:",e),m(!1)},()=>{console.log("\uD83D\uDD0C NotificationCenter: Chiudo SSE"),e.close(),m(!1)}},[t]);let u=async()=>{if(t)try{c(!0);let e=await fetch("/api/notifications?userId=".concat(t,"&onlyUnread=true"));if(e.ok){let t=await e.json();r(t.data||[])}else console.log("Nessuna notifica o errore caricamento"),r([])}catch(e){console.error("Errore caricamento notifiche:",e),r([{id:"1",titolo:"\uD83D\uDD14 Sistema Notifiche Attivo!",messaggio:"Il sistema di notifiche real-time \xe8 operativo. Tutte le funzionalit\xe0 sono disponibili.",tipo:"sistema",priorita:"normale",data_creazione:new Date().toISOString(),stato:"non_letta"},{id:"2",titolo:"⏰ Controllo Scadenze",messaggio:"Sistema di controllo scadenze lavorazioni attivato. Riceverai notifiche per scadenze imminenti.",tipo:"scadenza",priorita:"alta",data_creazione:new Date(Date.now()-18e5).toISOString(),stato:"non_letta"},{id:"3",titolo:"\uD83D\uDE80 PWA Installabile",messaggio:"L'app pu\xf2 essere installata sul tuo dispositivo come app nativa. Usa il menu del browser.",tipo:"sistema",priorita:"bassa",data_creazione:new Date(Date.now()-36e5).toISOString(),stato:"non_letta"}])}finally{c(!1)}},h=a.filter(e=>"non_letta"===e.stato).length,g=async e=>{try{await fetch("/api/notifications/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({letta:!0})}),r(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Errore aggiornamento notifica:",e)}},p=e=>{let t=new Date,a=new Date(e),i=Math.floor((t.getTime()-a.getTime())/6e4);return i<1?"Ora":i<60?"".concat(i,"m fa"):i<1440?"".concat(Math.floor(i/60),"h fa"):a.toLocaleDateString("it-IT")},b=e=>{switch(e){case"scadenza":return"⏰";case"sistema":return"\uD83D\uDD14";case"lavorazione_completata":return"✅";case"nuova_assegnazione":return"\uD83D\uDCCB";case"nuova_verifica":return"\uD83D\uDCDD";default:return"\uD83D\uDCAC"}},v=e=>{switch(e){case"urgente":return"text-red-600";case"alta":return"text-orange-600";case"normale":default:return"text-blue-600";case"bassa":return"text-gray-600"}};return(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("button",{className:"relative p-2 transition-colors rounded-lg ".concat(d?"text-green-600 hover:text-blue-600 hover:bg-blue-50":"text-gray-600 hover:text-blue-600 hover:bg-blue-50"),title:d?"Notifiche (Real-time attivo)":"Notifiche (Connessione...)",onClick:()=>{l(!n),n||d||u()},children:[(0,i.jsx)("span",{className:"text-xl",children:"\uD83D\uDD14"}),h>0&&(0,i.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:h>9?"9+":h})]}),n&&(0,i.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:[(0,i.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Notifiche"}),(0,i.jsx)("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[h>0&&(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[h," non ",1===h?"letta":"lette"]}),(0,i.jsxs)("div",{className:"text-xs flex items-center ".concat(d?"text-green-600":"text-orange-600"),children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full mr-1 ".concat(d?"bg-green-500":"bg-orange-500")}),d?"Real-time":"Offline"]})]})]}),x.supported&&(0,i.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100 bg-gray-50",children:[x.isSubscribed?(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-green-600",children:[(0,i.jsx)("span",{children:"✅"}),(0,i.jsx)("span",{children:"Notifiche Android attive"})]}),(0,i.jsx)("button",{onClick:x.unsubscribe,className:"text-xs text-gray-500 hover:text-red-600",title:"Disattiva notifiche",children:"\uD83D\uDD15"})]}):(0,i.jsx)("button",{onClick:x.requestPermission,disabled:x.loading||"denied"===x.permission,className:"w-full px-3 py-2 text-xs rounded flex items-center justify-center space-x-2 ".concat("denied"===x.permission?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:x.loading?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,i.jsx)("span",{children:"Attivazione..."})]}):"denied"===x.permission?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:"\uD83D\uDD15"}),(0,i.jsx)("span",{children:"Notifiche bloccate"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:"\uD83D\uDD14"}),(0,i.jsx)("span",{children:"Attiva notifiche Android"})]})}),x.error&&(0,i.jsx)("p",{className:"text-xs text-red-600 mt-1",children:x.error})]}),o&&(0,i.jsxs)("div",{className:"px-4 py-8 text-center text-gray-500",children:[(0,i.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"}),"Caricamento..."]}),!o&&(0,i.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===a.length?(0,i.jsxs)("div",{className:"px-4 py-8 text-center text-gray-500",children:[(0,i.jsx)("span",{className:"text-2xl mb-2 block",children:"\uD83D\uDCED"}),(0,i.jsx)("p",{className:"text-sm",children:"Nessuna notifica"})]}):a.map(e=>(0,i.jsx)("div",{className:"px-4 py-3 border-b border-gray-50 hover:bg-gray-50 cursor-pointer ".concat("non_letta"===e.stato?"bg-blue-50":""),onClick:()=>g(e.id),children:(0,i.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,i.jsx)("span",{className:"text-lg mt-0.5",children:b(e.tipo)}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("p",{className:"text-sm font-medium truncate ".concat("non_letta"===e.stato?"text-gray-900":"text-gray-700"),children:e.titolo}),"non_letta"===e.stato&&(0,i.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full ml-2 flex-shrink-0"})]}),(0,i.jsx)("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:e.messaggio}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,i.jsx)("span",{className:"text-xs text-gray-400",children:p(e.data_creazione)}),(0,i.jsx)("span",{className:"text-xs font-medium ".concat(v(e.priorita)),children:e.priorita})]})]})]})},e.id))}),a.length>0&&(0,i.jsx)("div",{className:"px-4 py-3 border-t border-gray-100 text-center",children:(0,i.jsx)("button",{onClick:async()=>{try{await Promise.all(a.map(e=>fetch("/api/notifications/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({letta:!0})}))),r([])}catch(e){console.error("Errore marcatura notifiche:",e)}},className:"text-xs text-blue-600 hover:text-blue-800",children:"Marca tutte come lette"})})]}),n&&(0,i.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>l(!1)})]})}var ei=a(7648);function es(){var e;let{isAuthenticated:t,user:a,role:r,logout:n}=l(),[o,d]=(0,s.useState)("admin"===r?"dashboard":"lavorazioni"),m="admin"===r?[{id:"dashboard",name:"Dashboard",icon:"\uD83C\uDFE0"},{id:"condomini",name:"Condomini",icon:"\uD83C\uDFE2"},{id:"tipologie",name:"Tipologie",icon:"\uD83D\uDCCB"},{id:"verifiche",name:"Nuova Verifica",icon:"✅"},{id:"admin",name:"Gestione Lavorazioni",icon:"⚙️"},{id:"test-notifiche",name:"Test Notifiche",icon:"\uD83E\uDDEA"},{id:"test-lavorazioni",name:"Test Integrazione",icon:"\uD83D\uDD04"}]:[{id:"lavorazioni",name:"Le Mie Lavorazioni",icon:"\uD83D\uDCCB"},{id:"note",name:"Note Personali",icon:"\uD83D\uDCDD"},{id:"impostazioni",name:"Impostazioni",icon:"⚙️"}];return t?(0,i.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,i.jsxs)("nav",{className:"w-64 bg-white shadow-lg",children:[(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Verifiche Condominiali"})}),(0,i.jsx)("ul",{className:"mt-6",children:m.map(e=>(0,i.jsx)("li",{children:(0,i.jsxs)("button",{onClick:()=>d(e.id),className:"w-full flex items-center px-6 py-3 text-left hover:bg-blue-50 transition-colors ".concat(o===e.id?"bg-blue-100 border-r-4 border-blue-500 text-blue-700":"text-gray-600"),children:[(0,i.jsx)("span",{className:"text-2xl mr-3",children:e.icon}),e.name]})},e.id))})]}),(0,i.jsxs)("main",{className:"flex-1 overflow-y-auto",children:[(0,i.jsx)("div",{className:"bg-white border-b border-gray-200 px-8 py-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:null===(e=m.find(e=>e.id===o))||void 0===e?void 0:e.name}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"admin"===r?"Pannello Amministratore":"Pannello Sopralluoghista"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsxs)("div",{className:"text-sm font-medium text-gray-700",children:[null==a?void 0:a.nome," ",null==a?void 0:a.cognome]}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"admin"===r?"\uD83D\uDC51 Amministratore":"\uD83D\uDC77 Sopralluoghista"})]}),(0,i.jsx)(ea,{userId:(null==a?void 0:a.id)||""}),(0,i.jsx)("button",{onClick:n,className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded hover:bg-red-50 transition-colors",title:"Disconnetti",children:"\uD83D\uDEAA Esci"})]})]})}),(0,i.jsxs)("div",{className:"p-8",children:["admin"===r&&(0,i.jsxs)(i.Fragment,{children:["dashboard"===o&&(0,i.jsx)(et,{onNavigate:d}),"condomini"===o&&(0,i.jsx)(j,{}),"tipologie"===o&&(0,i.jsx)(D,{}),"verifiche"===o&&(0,i.jsx)(P,{}),"admin"===o&&(0,i.jsx)(G,{}),"test-notifiche"===o&&(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h3",{className:"text-xl font-bold mb-4",children:"\uD83E\uDDEA Test Sistema Notifiche"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Strumenti per testare il funzionamento del sistema di notifiche"}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,i.jsxs)(ei.default,{href:"/test-notifiche",className:"block bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center transition-colors",children:[(0,i.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDD0C"}),(0,i.jsx)("h4",{className:"font-semibold",children:"Test Database"}),(0,i.jsx)("p",{className:"text-sm opacity-90",children:"Test CRUD notifiche"})]}),(0,i.jsxs)(ei.default,{href:"/test-lavorazioni-notifiche",className:"block bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center transition-colors",children:[(0,i.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDD04"}),(0,i.jsx)("h4",{className:"font-semibold",children:"Test Integrazione"}),(0,i.jsx)("p",{className:"text-sm opacity-90",children:"Lavorazioni → Notifiche"})]})]})]}),"test-lavorazioni"===o&&(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("h3",{className:"text-xl font-bold mb-4",children:"\uD83D\uDD04 Test Integrazione Completa"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Test del flusso completo: Lavorazioni → Notifiche → Sopralluoghisti"}),(0,i.jsx)(ei.default,{href:"/test-lavorazioni-notifiche",className:"inline-block bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"\uD83D\uDE80 Avvia Test Completo"})]})]}),"sopralluoghista"===r&&(0,i.jsxs)(i.Fragment,{children:["lavorazioni"===o&&(0,i.jsx)(W,{}),"note"===o&&(0,i.jsx)(K,{}),"impostazioni"===o&&(0,i.jsx)(ee,{})]})]})]})]}):(0,i.jsx)(c,{})}function er(){return(0,i.jsx)(n,{children:(0,i.jsx)(es,{})})}},5526:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});let i=(0,a(3887).eI)("https://ygvlcikgzkoaxlrmwsnv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlndmxjaWtnemtvYXhscm13c252Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTgzMzgsImV4cCI6MjA3NDk3NDMzOH0.Zc6eihyJiTZy6WicV6MyIgZ1Oq7GwzRYR01zovQHFPs")}},function(e){e.O(0,[125,505,887,990,971,117,744],function(){return e(e.s=3210)}),_N_E=e.O()}]);